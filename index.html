<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#667eea"/>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¨Ù„ÙŠØª">
<link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
<title>Ø­Ø§Ø³Ø¨Ø© Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¨Ø«Ù‚ - Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…</title>
<link rel="manifest" href="manifest.json">

<!-- Ø¥Ø¶Ø§ÙØ© Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>

<style>
/* --- Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© --- */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;700&display=swap');

* {
    font-family: 'Noto Sans Arabic', 'Segoe UI', 'Arial', 'Tahoma', sans-serif !important;
}

body {
    font-family: 'Noto Sans Arabic', 'Segoe UI', sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

h1, h2, h3, h4, h5, h6 {
    font-family: 'Noto Sans Arabic', 'Segoe UI', sans-serif !important;
    font-weight: 700;
}

.container {
    font-family: 'Noto Sans Arabic', 'Segoe UI', sans-serif;
}

/* --- Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© --- */
* { 
    box-sizing: border-box; 
    margin: 0; 
    padding: 0; 
}

body {
    background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    margin:0;
    padding:10px;
    min-height:100vh;
    line-height:1.6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    position: relative;
    padding-bottom: 10px;
}

/* Ø¥Ø¬Ø¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø¸Ù‡ÙˆØ± Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© */
input, select, .calculation-info, .calculation-steps, 
.summary, .analysis-table, .billet-result, .bed-length-result,
.step, .bed-length-step, .analysis-table td, .analysis-table th {
    font-family: 'Arial', 'Segoe UI', sans-serif !important;
    font-feature-settings: "lnum";
    -moz-font-feature-settings: "lnum";
    -webkit-font-feature-settings: "lnum";
    font-variant-numeric: lining-nums;
}

/* Ø¥Ø¬Ø¨Ø§Ø± Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù„Ù„ÙŠØ³Ø§Ø± */
input[type="number"], input[type="text"] {
    direction: ltr;
    text-align: right;
}

/* Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù… ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„ÙŠØ³Ø§Ø± */
.calculation-info span, .billet-result span, .summary span,
.analysis-table td, .bed-length-value {
    direction: ltr;
    display: inline-block;
    text-align: right;
}

/* --- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù†Ù…Ø§Ø· --- */
.welcome-wrap {
    text-align: center;
    margin-bottom: 12px;
}
.welcome-banner {
    display: inline-block;
    padding: 8px 14px;
    border-radius: 10px;
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
    color: #fff;
    font-weight: 700;
    font-size: 16px;
    letter-spacing: 1px;
    text-shadow: 0 0 6px rgba(255,255,255,0.85);
    animation: bannerGlow 3s ease-in-out infinite alternate, bannerFloat 6s ease-in-out infinite;
    box-shadow: 0 4px 12px rgba(0,0,0,0.18);
    border: 1px solid rgba(255,255,255,0.08);
}
@keyframes bannerGlow {
    from { text-shadow: 0 0 6px rgba(255,255,255,0.6), 0 0 10px rgba(255,215,0,0.3); transform: translateZ(0) scale(1); }
    to   { text-shadow: 0 0 18px rgba(255,255,255,0.9), 0 0 26px rgba(255,140,0,0.25); transform: translateZ(0) scale(1.02); }
}
@keyframes bannerFloat {
    0% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
    100% { transform: translateY(0); }
}

.container {
    max-width:880px;
    margin:0 auto;
    background:#fff;
    padding:20px;
    border-radius:16px;
    box-shadow:0 12px 30px rgba(0,0,0,0.25);
}
h1{color:#2c3e50;text-align:center;margin-bottom:6px;font-size:24px}
.subtitle{text-align:center;color:#7f8c8d;margin-bottom:14px;font-size:14px}

.section-title{color:#2c3e50;margin:14px 0 10px 0;padding-bottom:6px;border-bottom:2px solid #ecf0f1;font-size:16px}

/* ---------- ØªØ­Ø³ÙŠÙ† Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ³Ø§ÙˆÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹ ---------- */
.form-grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap:12px;
    margin-bottom:14px;
    align-items: start;
}

.form-group{
    margin-bottom:0;
    display: flex;
    flex-direction: column;
    height: 100%;
}

label{
    display:block;
    margin-bottom:6px;
    font-weight:700;
    color:#34495e;
    font-size:13px;
    line-height: 1.3;
    min-height: 32px;
}

input,select,textarea,button{
    width:100%;
    padding:8px;
    border:1.8px solid #bdc3c7;
    border-radius:6px;
    font-size:13px;
    background:#f8f9fa;
    transition:all .18s;
    font-family: 'Arial', sans-serif !important;
    min-height: 38px;
    box-sizing: border-box;
}
input:focus,select:focus,textarea:focus{border-color:#3498db;outline:none;background:#fff;box-shadow:0 0 0 3px rgba(52,152,219,0.04)}

.small {
    font-size: 11px; 
    color: #7f8c8d; 
    margin-top: 6px;
    line-height: 1.3;
    min-height: 28px;
}

.buttons-group{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin:12px 0}
button{
    color:#fff;
    padding:10px;
    border:none;
    border-radius:8px;
    font-size:14px;
    font-weight:800;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    transition: all 0.3s ease;
}
.calculate-btn{background:linear-gradient(135deg,#27ae60,#2ecc71)}
.reset-btn{background:linear-gradient(135deg,#e74c3c,#c0392b)}
.print-btn{background:linear-gradient(135deg,#34495e,#2c3e50)}
button:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 12px rgba(0,0,0,0.15);
}
button:active{
    transform:translateY(0);
}

.result{margin-top:12px;padding:12px;background:linear-gradient(135deg,#ecf0f1,#dfe6e9);border-radius:10px;text-align:center;display:none;border:1.8px solid #3498db}
.calculation-info{background:#fff;padding:10px;border-radius:6px;margin:6px 0;text-align:right;box-shadow:0 4px 8px rgba(0,0,0,0.04)}
.billet-result{font-size:20px;color:#e74c3c;font-weight:900;margin:10px 0;padding:10px;background:#fff;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,0.06)}
.calculation-steps{background:#fff;padding:10px;border-radius:6px;margin:8px 0;text-align:right;font-size:13px;line-height:1.4;box-shadow:0 4px 8px rgba(0,0,0,0.03)}
.step{margin:6px 0;padding:6px;background:#f8f9fa;border-radius:5px;border-right:3px solid #3498db}

.summary{margin-top:8px;text-align:right;background:#fff;padding:8px;border-radius:6px;box-shadow:0 4px 12px rgba(0,0,0,0.04);font-size:13px}

.analysis-table{margin-top:10px;width:100%;background:#fff;border-radius:6px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.04);border:1px solid #d0e6ff}
.analysis-table table{width:100%;border-collapse:collapse;direction:rtl}
.analysis-table th,.analysis-table td{padding:8px 10px;text-align:right;font-size:13px;border-bottom:1px solid #eef6ff}
.analysis-table thead{background:linear-gradient(90deg,#e6f2ff,#f7fbff);color:#114b8a;font-weight:700}
.analysis-table .highlight{font-weight:900;color:#e74c3c}

.whatsapp-row {
    margin-top:12px;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
}

.whatsapp-btn {
    display:inline-flex;
    align-items:center;
    gap:8px;
    background:#25D366;
    color:white;
    padding:8px 12px;
    border-radius:20px;
    text-decoration:none;
    font-weight:800;
    box-shadow:0 6px 12px rgba(37,211,102,0.14);
    border: 2px solid rgba(0,0,0,0.03);
    font-size: 13px;
}
.whatsapp-btn svg { width:18px; height:18px; }

.mold-management {
    background: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    border: 1.6px solid #e9ecef;
}
.mold-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 6px;
    margin-top: 8px;
}
.mold-btn {
    padding: 8px;
    font-size: 12px;
    border-radius: 6px;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    transition: all 0.3s ease;
}
.mold-save { background: #27ae60; }
.mold-search { background: #3498db; }
.mold-show { background: #9b59b6; }
.mold-delete { background: #e74c3c; }
.mold-btn:hover { transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0,0,0,0.08); }

.auto-fill-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border: 2px solid #3498db;
    border-top: 2px solid transparent;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 4px;
    vertical-align: middle;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.auto-fill-notice {
    background: #e8f4fd;
    border: 1px solid #b6e0fe;
    border-radius: 5px;
    padding: 6px 10px;
    margin: 6px 0;
    font-size: 12px;
    color: #1e6fa8;
    display: none;
}

.bed-length-result {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    border: 1.6px solid #90caf9;
    text-align: center;
}
.bed-length-title {
    font-size: 16px;
    font-weight: 900;
    color: #1565c0;
    margin-bottom: 6px;
}
.bed-length-value {
    font-size: 18px;
    font-weight: 900;
    color: #e65100;
    margin: 6px 0;
}
.bed-length-details {
    background: #fff;
    padding: 8px;
    border-radius: 6px;
    margin: 8px 0;
    font-size: 13px;
    text-align: right;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
}
.bed-length-step {
    margin: 5px 0;
    padding: 6px;
    background: #f3f9ff;
    border-radius: 5px;
    border-right: 2px solid #42a5f5;
}

.install-btn {
    position: fixed;
    bottom: 15px;
    left: 15px;
    background: #e74c3c;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 3px 8px rgba(0,0,0,0.3);
    z-index: 1000;
    display: none;
    font-size: 13px;
}

.contact-phones {
    margin: 12px 0;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
}

.phone-contact-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 8px 12px;
    border-radius: 18px;
    text-decoration: none;
    font-weight: 700;
    box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    transition: all 0.25s ease;
    border: 1.5px solid rgba(255,255,255,0.2);
    min-width: 180px;
    justify-content: center;
    font-size: 13px;
}

.phone-contact-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    background: linear-gradient(135deg, #764ba2, #667eea);
}

.custom-length-section {
    background: #f8f9fa;
    padding: 8px;
    border-radius: 6px;
    margin: 6px 0;
    border: 1.4px solid #e9ecef;
}

.length-toggle {
    display: flex;
    gap: 6px;
    margin-bottom: 6px;
}

.toggle-btn {
    flex: 1;
    padding: 6px 8px;
    border: 1.5px solid #bdc3c7;
    background: #fff;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    font-size: 12px;
    transition: all 0.15s;
}
.toggle-btn.active {
    background: #3498db;
    color: white;
    border-color: #2980b9;
}

.custom-length-input {
    display: none;
}

.custom-length-input.active {
    display: block;
}

.custom-length-input input {
    margin-top: 4px;
    padding:6px;
}

/* ØªØµÙ…ÙŠÙ… Ø­Ù‚Ù„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù„Ø¨Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø³ÙŠØ± */
.box-calculator {
    background: #f0f8ff;
    padding: 10px;
    border-radius: 8px;
    margin: 10px 0;
    border: 1.6px solid #b6e0fe;
}

.profile-type-toggle {
    display: flex;
    gap: 6px;
    margin-bottom: 10px;
}

.profile-type-btn {
    flex: 1;
    padding: 8px 10px;
    border: 1.5px solid #bdc3c7;
    background: #fff;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.15s;
}
.profile-type-btn.active {
    background: #3498db;
    color: white;
    border-color: #2980b9;
}

.box-inputs, .pipe-inputs, .angle-inputs {
    display: none;
}

.box-inputs.active, .pipe-inputs.active, .angle-inputs.active {
    display: block;
}

.box-input-group, .pipe-input-group, .angle-input-group {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 8px;
    margin-bottom: 8px;
}

.box-result {
    background: #e6f7ff;
    padding: 8px;
    border-radius: 6px;
    text-align: center;
    font-weight: bold;
    color: #0066cc;
    margin-top: 8px;
}

.calculation-details {
    background: #f8f9fa;
    padding: 8px;
    border-radius: 6px;
    margin-top: 8px;
    font-size: 12px;
    text-align: right;
    direction: rtl;
}

.calculation-step {
    margin: 4px 0;
    padding: 4px;
    background: #fff;
    border-radius: 4px;
    border-right: 2px solid #3498db;
}

/* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…ÙŠØ¯ÙŠØ§: ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ù…Ø¹ Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ø®Ø·ÙˆØ· */
@media (max-width: 420px) {
    .container { padding:15px; }
    h1{font-size:22px}
    .form-grid { 
        grid-template-columns: repeat(2, 1fr); 
        gap:10px; 
    }
    input, select { 
        padding:10px; 
        font-size:16px;
        min-height: 44px;
    }
    label {
        font-size: 14px;
        min-height: 32px;
    }
    .small {
        font-size: 12px;
        min-height: 28px;
    }
    .buttons-group { 
        grid-template-columns: 1fr 1fr 1fr; 
        gap:8px; 
    }
    button {
        font-size: 15px;
        padding: 12px 8px;
    }
    .mold-buttons { grid-template-columns: 1fr 1fr; gap:8px; }
    .phone-contact-item { 
        min-width: 160px; 
        font-size:14px;
        padding:10px 12px; 
    }
    .welcome-banner { 
        font-size:15px;
        padding:8px 12px; 
    }
    .box-input-group, .pipe-input-group, .angle-input-group { grid-template-columns: 1fr; }
    .profile-type-toggle { flex-direction: column; }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    .billet-result {
        font-size: 18px;
        padding: 12px;
    }
    .calculation-info, .calculation-steps {
        font-size: 14px;
    }
    .step {
        padding: 8px;
        font-size: 14px;
    }
    .summary {
        font-size: 14px;
        padding: 10px;
    }
}

/* Ø¥Ø¬Ø¨Ø§Ø± Ø¹Ø§Ù… Ø¹Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… lining nums */
html, body, input, select, textarea, button, span, p, label, div, table, td, th {
    font-feature-settings: "lnum" 1;
    font-variant-numeric: lining-nums;
}

/* Ø¹Ù†Ø§ØµØ± ØªØ¸Ù‡Ø± Ø£Ø±Ù‚Ø§Ù…Ø§Ù‹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Øµ Ù†Ø·Ø¨Ù‚ Ø¹Ù„ÙŠÙ‡Ø§ Ø§ØªØ¬Ø§Ù‡ LTR Ù„ØªØ¶Ù…Ù† Ø£Ø±Ù‚Ø§Ù… Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© */
span.english-numbers, .calculation-info span, .analysis-table td, .analysis-table th, .bed-length-value {
    direction: ltr !important;
    text-align: right !important;
}

/* ØªØµØºÙŠØ± Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ù†Ø³Ø®Ø© */
.compact-group label {
    font-size: 11px !important;
    min-height: 26px !important;
}

.compact-group input {
    font-size: 11px !important;
    padding: 5px 6px !important;
    min-height: 34px !important;
}

.compact-group .small {
    font-size: 9px !important;
    min-height: 22px !important;
}

/* ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© */
.temperature-warning {
    padding: 6px;
    margin: 4px 0;
    border-radius: 4px;
    font-weight: bold;
    font-size: 11px;
    text-align: center;
    border: 1px solid;
}

.recommendations-box {
    background: #f3e5f5;
    padding: 10px;
    border-radius: 6px;
    margin: 10px 0;
    border: 1px solid #ba68c8;
}

/* Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ */
.box-calculator-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 10px;
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1.6px solid #90caf9;
}

.box-calculator-header h3 {
    margin: 0;
    color: #1565c0;
    font-size: 16px;
}

.box-calculator-toggle {
    background: none;
    border: none;
    font-size: 18px;
    color: #1565c0;
    cursor: pointer;
    transition: transform 0.3s;
    padding: 5px;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.box-calculator-toggle:hover {
    background-color: rgba(255, 255, 255, 0.5);
}

.box-calculator-toggle.rotated {
    transform: rotate(180deg);
}

.box-calculator-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.box-calculator-content.collapsed {
    display: none;
}

/* Ù‚Ø³Ù… ØªÙˆÙ‚Ø¹ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ */
.exit-temperature-prediction {
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    padding: 12px;
    border-radius: 8px;
    margin: 12px 0;
    border: 1.6px solid #ffb74d;
}

.exit-temperature-title {
    font-size: 16px;
    font-weight: 900;
    color: #e65100;
    margin-bottom: 8px;
    text-align: center;
}

.exit-temperature-value {
    font-size: 20px;
    font-weight: 900;
    color: #d84315;
    margin: 8px 0;
    text-align: center;
}

.exit-temperature-details {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    margin: 8px 0;
    font-size: 13px;
    text-align: right;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
}

.exit-temperature-step {
    margin: 6px 0;
    padding: 6px;
    background: #fff8e1;
    border-radius: 5px;
    border-right: 2px solid #ffa000;
}

.temperature-factor {
    display: flex;
    justify-content: space-between;
    margin: 4px 0;
    padding: 4px;
    background: #f5f5f5;
    border-radius: 4px;
}

.temperature-factor-value {
    font-weight: bold;
    color: #e65100;
}

.cooling-recommendation {
    background: #e3f2fd;
    padding: 8px;
    border-radius: 6px;
    margin: 8px 0;
    border: 1px solid #64b5f6;
    font-size: 12px;
}

/* Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© */
.temperature-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
    font-size: 12px;
    background: white;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
}

.temperature-table th, .temperature-table td {
    padding: 8px;
    text-align: center;
    border: 1px solid #e0e0e0;
}

.temperature-table th {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    color: #1565c0;
    font-weight: bold;
}

.temperature-table tr:nth-child(even) {
    background: #f5f5f5;
}

.temperature-table tr:hover {
    background: #fff8e1;
}

/* Ø²Ø± Ø¥Ø®ÙØ§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø±Ø§Ø±Ø§Øª */
.temperature-toggle-section {
    text-align: center;
    margin: 10px 0;
}

.temperature-toggle-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    font-size: 13px;
}

.temperature-toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 12px rgba(0,0,0,0.3);
}

.temperature-toggle-btn.hidden {
    background: linear-gradient(135deg, #95a5a6, #7f8c8d);
}

/* ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø«Ù‚ Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ */
.speed-with-type {
    display: flex;
    gap: 8px;
    align-items: stretch;
}

.speed-input {
    flex: 2;
}

.mold-type-select {
    flex: 1;
    min-width: 100px;
}

.mold-type-indicator {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 11px;
    margin-right: 6px;
}

.mold-type-hollow {
    background: #e3f2fd;
    color: #1565c0;
    border: 1px solid #90caf9;
}

.mold-type-solid {
    background: #e8f5e8;
    color: #2e7d32;
    border: 1px solid #81c784;
}

/* Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© */
.heat-treatment-section {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    padding: 12px;
    border-radius: 8px;
    margin: 12px 0;
    border: 1.6px solid #81c784;
}

.heat-treatment-title {
    font-size: 16px;
    font-weight: 900;
    color: #2e7d32;
    margin-bottom: 8px;
    text-align: center;
}

.heat-treatment-result {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    margin: 8px 0;
    font-size: 13px;
    text-align: right;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
    display: none;
}

.heat-treatment-step {
    margin: 6px 0;
    padding: 6px;
    background: #f1f8e9;
    border-radius: 5px;
    border-right: 2px solid #66bb6a;
}

/* Ø²Ø± Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© */
.heat-treatment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 10px;
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1.6px solid #81c784;
}

.heat-treatment-header h3 {
    margin: 0;
    color: #2e7d32;
    font-size: 16px;
}

.heat-treatment-toggle {
    background: none;
    border: none;
    font-size: 18px;
    color: #2e7d32;
    cursor: pointer;
    transition: transform 0.3s;
    padding: 5px;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.heat-treatment-toggle:hover {
    background-color: rgba(255, 255, 255, 0.5);
}

.heat-treatment-toggle.rotated {
    transform: rotate(180deg);
}

.heat-treatment-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.heat-treatment-content.collapsed {
    display: none;
}

/* Ø²Ø± Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØ§Ù„Ø¨Ø«Ù‚ */
.alloy-settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 10px;
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1.6px solid #90caf9;
}

.alloy-settings-header h3 {
    margin: 0;
    color: #1565c0;
    font-size: 16px;
}

.alloy-settings-toggle {
    background: none;
    border: none;
    font-size: 18px;
    color: #1565c0;
    cursor: pointer;
    transition: transform 0.3s;
    padding: 5px;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.alloy-settings-toggle:hover {
    background-color: rgba(255, 255, 255, 0.5);
}

.alloy-settings-toggle.rotated {
    transform: rotate(180deg);
}

.alloy-settings-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.alloy-settings-content.collapsed {
    display: none;
}

/* Ø²Ø± Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù…Ùƒ */
.thickness-calc-btn {
    background: linear-gradient(135deg, #ff9800, #f57c00);
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    transition: all 0.3s ease;
    margin-top: 8px;
    width: 100%;
}

.thickness-calc-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.thickness-group {
    position: relative;
}

.thickness-info {
    background: #e3f2fd;
    padding: 8px;
    border-radius: 6px;
    margin-top: 8px;
    border: 1px solid #90caf9;
    font-size: 12px;
    text-align: center;
}

.thickness-info h4 {
    margin: 0 0 6px 0;
    color: #1565c0;
    font-size: 13px;
}

.thickness-values {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6px;
    margin-top: 6px;
}

.thickness-value {
    background: white;
    padding: 6px;
    border-radius: 4px;
    text-align: center;
    border: 1px solid #e0e0e0;
}

.thickness-value .label {
    font-weight: bold;
    color: #666;
    font-size: 11px;
}

.thickness-value .value {
    font-weight: bold;
    color: #e65100;
    font-size: 12px;
}

/* ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ© */
.european-standards-notice {
    background: linear-gradient(135deg, #e1f5fe, #b3e5fc);
    padding: 12px;
    border-radius: 8px;
    margin: 12px 0;
    border: 1.6px solid #4fc3f7;
    text-align: center;
}

.european-standards-title {
    font-size: 16px;
    font-weight: 900;
    color: #0277bd;
    margin-bottom: 8px;
}

.european-standards-content {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    margin: 8px 0;
    font-size: 13px;
    text-align: right;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
}

.european-standards-step {
    margin: 6px 0;
    padding: 6px;
    background: #f3f9ff;
    border-radius: 5px;
    border-right: 2px solid #29b6f6;
}

/* Ù‚Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø¬ÙˆØ¯Ø© */
.quality-standards-section {
    background: linear-gradient(135deg, #fff8e1, #ffecb3);
    padding: 12px;
    border-radius: 8px;
    margin: 12px 0;
    border: 1.6px solid #ffb74d;
}

.quality-standards-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 10px;
    background: linear-gradient(135deg, #fff8e1, #ffecb3);
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1.6px solid #ffb74d;
}

.quality-standards-header h3 {
    margin: 0;
    color: #e65100;
    font-size: 16px;
}

.quality-standards-toggle {
    background: none;
    border: none;
    font-size: 18px;
    color: #e65100;
    cursor: pointer;
    transition: transform 0.3s;
    padding: 5px;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.quality-standards-toggle:hover {
    background-color: rgba(255, 255, 255, 0.5);
}

.quality-standards-toggle.rotated {
    transform: rotate(180deg);
}

.quality-standards-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.quality-standards-content.collapsed {
    display: none;
}

.quality-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
    font-size: 11px;
    background: white;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
}

.quality-table th, .quality-table td {
    padding: 6px 4px;
    text-align: center;
    border: 1px solid #e0e0e0;
}

.quality-table th {
    background: linear-gradient(135deg, #fff8e1, #ffecb3);
    color: #e65100;
    font-weight: bold;
}

.quality-table tr:nth-child(even) {
    background: #f5f5f5;
}

.quality-table tr:hover {
    background: #fffde7;
}

.quality-table .section-header {
    background: linear-gradient(135deg, #ffecb3, #ffe082);
    color: #e65100;
    font-weight: bold;
    font-size: 12px;
}

.quality-table .quality-high {
    background: #e8f5e9;
}

.quality-table .quality-medium {
    background: #fff8e1;
}

.quality-table .quality-standard {
    background: #e3f2fd;
}

.quality-table .quality-economy {
    background: #fce4ec;
}

/* Ø£Ø²Ø±Ø§Ø± ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¶Ø§ÙØ© */
.social-media-row {
    margin-top: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}

.social-media-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: #3b5998; /* ÙÙŠØ³Ø¨ÙˆÙƒ */
    color: white;
    padding: 6px 12px;
    border-radius: 16px;
    text-decoration: none;
    font-weight: 700;
    box-shadow: 0 4px 8px rgba(0,0,0,0.12);
    border: 1.5px solid rgba(255,255,255,0.1);
    font-size: 12px;
    transition: all 0.3s ease;
}

.social-media-btn.tiktok {
    background: #000000; /* ØªÙŠÙƒ ØªÙˆÙƒ */
}

.social-media-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.15);
}

.social-media-btn svg { 
    width: 16px; 
    height: 16px; 
}

/* Ø²Ø± Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ */
.toggle-results-btn {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    font-size: 13px;
    margin-top: 10px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.toggle-results-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 12px rgba(0,0,0,0.3);
}

/* Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª */
.company-management {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    padding: 12px;
    border-radius: 8px;
    margin: 12px 0;
    border: 1.6px solid #90caf9;
}

.company-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 10px;
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1.6px solid #90caf9;
}

.company-header h3 {
    margin: 0;
    color: #1565c0;
    font-size: 16px;
}

.company-toggle {
    background: none;
    border: none;
    font-size: 18px;
    color: #1565c0;
    cursor: pointer;
    transition: transform 0.3s;
    padding: 5px;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.company-toggle:hover {
    background-color: rgba(255, 255, 255, 0.5);
}

.company-toggle.rotated {
    transform: rotate(180deg);
}

.company-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.company-content.collapsed {
    display: none;
}

.company-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 8px;
}

.company-btn {
    padding: 10px;
    font-size: 12px;
    border-radius: 6px;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    transition: all 0.3s ease;
}

.company-create { background: #27ae60; }
.company-join { background: #3498db; }
.company-switch { background: #9b59b6; }
.company-users { background: #f39c12; }

.company-btn:hover { transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0,0,0,0.08); }

.current-company {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    margin: 8px 0;
    text-align: center;
    font-weight: bold;
    color: #1565c0;
    border: 1px solid #90caf9;
}

/* Ù†Ù…Ø· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ø§Ù„Ø´Ø±ÙƒØ© */
.company-users-list {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    margin: 8px 0;
    border: 1px solid #e0e0e0;
    max-height: 200px;
    overflow-y: auto;
}

.company-user-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px;
    border-bottom: 1px solid #f0f0f0;
}

.company-user-item:last-child {
    border-bottom: none;
}

.user-role {
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 10px;
    background: #e3f2fd;
    color: #1565c0;
}

.user-role.admin {
    background: #ffebee;
    color: #c62828;
}

/* Ù†Ù…Ø· Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    text-align: center;
}

.modal h3 {
    margin-bottom: 15px;
    color: #2c3e50;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.modal-btn {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 6px;
    color: white;
    cursor: pointer;
    font-weight: bold;
}

.modal-btn.confirm { background: #27ae60; }
.modal-btn.cancel { background: #95a5a6; }

/* Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.login-section {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    padding: 12px;
    border-radius: 8px;
    margin: 12px 0;
    border: 1.6px solid #81c784;
}

.login-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    padding: 10px;
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1.6px solid #81c784;
}

.login-header h3 {
    margin: 0;
    color: #2e7d32;
    font-size: 16px;
}

.login-toggle {
    background: none;
    border: none;
    font-size: 18px;
    color: #2e7d32;
    cursor: pointer;
    transition: transform 0.3s;
    padding: 5px;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.login-toggle:hover {
    background-color: rgba(255, 255, 255, 0.5);
}

.login-toggle.rotated {
    transform: rotate(180deg);
}

.login-content {
    transition: all 0.3s ease;
    overflow: hidden;
}

.login-content.collapsed {
    display: none;
}

.login-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-top: 8px;
}

.login-btn {
    padding: 10px;
    font-size: 12px;
    border-radius: 6px;
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    transition: all 0.3s ease;
}

.login-register { background: #3498db; }
.login-login { background: #27ae60; }
.login-logout { background: #e74c3c; }
.login-profile { background: #9b59b6; }

.login-btn:hover { transform: translateY(-1px); box-shadow: 0 3px 8px rgba(0,0,0,0.08); }

.current-user {
    background: #fff;
    padding: 10px;
    border-radius: 6px;
    margin: 8px 0;
    text-align: center;
    font-weight: bold;
    color: #2e7d32;
    border: 1px solid #81c784;
}

/* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙØ§Ø¦Ù‚ */
.super-admin-panel {
    position: fixed;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    background: linear-gradient(135deg, #c0392b, #e74c3c);
    color: white;
    padding: 15px;
    border-radius: 10px;
    z-index: 10000;
    font-size: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    border: 2px solid #fff;
    min-width: 250px;
    max-width: 300px;
    display: none;
}

.super-admin-btn {
    position: fixed;
    top: 25px;
    left: 25px;
    background: #c0392b;
    color: white;
    border: none;
    padding: 6px 8px;
    border-radius: 50%;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 1000;
    font-size: 18px;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.super-admin-btn:hover {
    background: #a53025;
    transform: scale(1.1);
}

/* Ø£Ù†Ù…Ø§Ø· Ù„Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
.recovery-step {
    display: none;
}

.recovery-code-display {
    background: #e8f5e8;
    padding: 10px;
    border-radius: 5px;
    text-align: center;
    margin: 10px 0;
    display: none;
}

/* Ø£Ù†Ù…Ø§Ø· Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
.admin-control-panel {
    position: fixed;
    top: 60px;
    right: 15px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 15px;
    border-radius: 12px;
    z-index: 10000;
    font-size: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    border: 2px solid rgba(255,255,255,0.15);
    min-width: 280px;
    max-width: 320px;
    backdrop-filter: blur(10px);
    transition: all 0.3s ease;
}

.admin-control-panel.hidden {
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
}

.admin-control-header {
    text-align: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.admin-control-title {
    font-size: 14px;
    font-weight: 700;
    margin: 0;
}

.admin-control-buttons {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.admin-control-btn {
    background: rgba(255,255,255,0.15);
    color: white;
    border: none;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 11px;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
}

.admin-control-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-1px);
}

.admin-control-footer {
    margin-top: 10px;
    font-size: 10px;
    text-align: center;
    opacity: 0.8;
    padding-top: 8px;
    border-top: 1px solid rgba(255,255,255,0.2);
}

/* Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ø§Ø¦Ù… */
.admin-toggle-btn {
    position: fixed;
    top: 15px;
    right: 15px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 50%;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    z-index: 10001;
    font-size: 16px;
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    border: 2px solid rgba(255,255,255,0.1);
}

.admin-toggle-btn:hover {
    background: linear-gradient(135deg, #764ba2, #667eea);
    transform: scale(1.1);
    box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}

.admin-toggle-btn.active {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
}

</style>
</head>
<body>

<!-- Ø²Ø± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<button class="install-btn" id="installButton">ğŸ“± ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>

<!-- Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙØ§Ø¦Ù‚ -->
<button class="super-admin-btn" id="superAdminBtn">ğŸ‘‘</button>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙØ§Ø¦Ù‚Ø© -->
<div id="superAdminPanel" class="super-admin-panel">
    <div style="text-align: center; margin-bottom: 10px;">
        <strong>ğŸ‘‘ Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙØ§Ø¦Ù‚</strong>
    </div>
    <div style="display: flex; flex-direction: column; gap: 6px;">
        <button onclick="superAdmin.emergencyShutdown()" style="background: #c0392b; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
            ğŸš¨ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
        </button>
        <button onclick="userManagement.kickAllUsers()" style="background: #e67e22; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
            ğŸ‘¥ Ø·Ø±Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        </button>
        <button onclick="userManagement.showUserManagement()" style="background: #3498db; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
            ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        </button>
        <button onclick="superAdmin.disableNewUsers()" style="background: #d35400; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
            â›” ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        </button>
        <button onclick="superAdmin.viewAllData()" style="background: #3498db; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
            ğŸ“Š Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
        <button onclick="superAdmin.togglePanel()" style="background: #7f8c8d; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
            âŒ Ø¥ØºÙ„Ø§Ù‚
        </button>
    </div>
    <div style="margin-top: 10px; font-size: 10px; text-align: center;">
        <input type="password" id="superAdminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ÙØ§Ø¦Ù‚Ø©" style="width: 100%; padding: 4px; margin-bottom: 5px; text-align: center;">
        <button onclick="superAdmin.authenticate()" style="background: #27ae60; color: white; border: none; padding: 4px; border-radius: 4px; cursor: pointer; width: 100%;">
            ğŸ”‘ Ø¯Ø®ÙˆÙ„
        </button>
    </div>
</div>

<!-- Ù†ÙˆØ§ÙØ° Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="companyModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ©</h3>
        <div id="modalContent">
            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
        </div>
        <div class="modal-buttons">
            <button class="modal-btn confirm" id="modalConfirm">ØªØ£ÙƒÙŠØ¯</button>
            <button class="modal-btn cancel" id="modalCancel">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>

<!-- Ø¨Ø§Ù†Ø± -->
<div class="welcome-wrap">
    <div class="welcome-banner">âœ§ï½¥ï¾Ÿ: *âœ¿ ØªØ·ÙˆÙŠØ± ÙÙ‡Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² FAHD ABD ELAZIZ âœ¿* :ï½¥ï¾Ÿâœ§</div>
</div>

<div class="container">
    <h1>ğŸ§® Ø­Ø§Ø³Ø¨Ø© Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù‚Ø§Ù„Ø¨/Ø§Ù„Ø£Ø³Ø·Ù…Ø¨Ø© Ù„Ø¨Ø«Ù‚ - Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…</h1>
    <p class="subtitle">Ø¯Ø¹Ù… Ø³Ø¨Ø§Ø¦Ùƒ Ù…ØªØ¹Ø¯Ø¯Ø© + Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…) Ù…ØªØ²Ø§Ù…Ù† Ù…Ø¹ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ + Ù†Ø¸Ø§Ù… Ø­ÙØ¸ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ + ØªÙˆÙ‚Ø¹ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬</p>

    <!-- Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <div class="login-section">
        <div class="login-header" id="loginHeader">
            <h3>ğŸ‘¤ Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
            <button class="login-toggle" id="loginToggle">â–¼</button>
        </div>
        
        <div class="login-content" id="loginContent">
            <div class="current-user" id="currentUserInfo">
                Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…...
            </div>
            
            <div class="login-buttons">
                <button class="login-btn login-register" id="registerBtn">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
                <button class="login-btn login-login" id="loginBtn">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button class="login-btn login-logout" id="logoutBtn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                <button class="login-btn login-profile" id="profileBtn">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
                <button class="login-btn" id="recoveryBtn" style="background: #f39c12;">ğŸ”“ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
            </div>
            
            <div class="small" style="text-align: center; margin-top: 8px;">
                ğŸ’¡ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø²
            </div>
        </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <div class="company-management">
        <div class="company-header" id="companyHeader">
            <h3>ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ© ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
            <button class="company-toggle" id="companyToggle">â–¼</button>
        </div>
        
        <div class="company-content" id="companyContent">
            <div class="current-company" id="currentCompanyInfo">
                Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©...
            </div>
            
            <div class="company-buttons">
                <button class="company-btn company-create" id="createCompanyBtn">ğŸ¢ Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙƒØ©</button>
                <button class="company-btn company-join" id="joinCompanyBtn">â• Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø´Ø±ÙƒØ©</button>
                <button class="company-btn company-switch" id="switchCompanyBtn">ğŸ”„ ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ø±ÙƒØ©</button>
                <button class="company-btn company-users" id="manageUsersBtn">ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
            </div>
            
            <div class="small" style="text-align: center; margin-top: 8px;">
                ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù…Ø² Ø§Ù„Ø´Ø±ÙƒØ©
            </div>
        </div>
    </div>

    <h3 class="section-title">ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø§Ø³Ø·Ù…Ø¨Ø©) ÙˆØ§Ù„Ø¥Ù†ØªØ§Ø¬</h3>
    <div class="form-grid">
        <div class="form-group">
            <label for="numOpenings">Ø¹Ø¯Ø¯ ÙØªØ­Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø£Ø³Ø·Ù…Ø¨Ø©):</label>
            <input type="number" id="numOpenings" value="4" min="1" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
        </div>
        <div class="form-group">
            <label for="rodWeight">ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ (ÙƒØ¬Ù…):</label>
            <input type="number" id="rodWeight" value="1.2" step="0.01" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·ÙˆÙ„</div>
        </div>
        <div class="form-group">
            <label for="weightPerMeter">Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…):</label>
            <input type="number" id="weightPerMeter" value="0.200" step="0.001" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø·ÙˆÙ„</div>
        </div>
        
        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ Ø§Ù„Ù…Ø­Ø³Ù† -->
        <div class="form-group">
            <label for="rodLength">Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯ (Ù…ØªØ±):</label>
            <div class="custom-length-section">
                <div class="length-toggle">
                    <div class="toggle-btn active" data-length="6">6 Ù…ØªØ±</div>
                    <div class="toggle-btn" data-length="6.5">6.5 Ù…ØªØ±</div>
                    <div class="toggle-btn" data-length="custom">Ø·ÙˆÙ„ Ø®Ø§Øµ</div>
                </div>
                <div class="custom-length-input" id="customLengthContainer">
                    <input type="number" id="customLength" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ Ø¨Ø§Ù„Ù…ØªØ±" step="0.1" min="1" value="6" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø£ÙŠ Ø·ÙˆÙ„ ØªØ±ÙŠØ¯Ù‡ Ù…Ø«Ù„ 4ØŒ 5.5ØŒ 7ØŒ Ø¥Ù„Ø®</div>
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
        <div class="form-group">
            <label for="desiredBedLength">Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ (Ù…ØªØ±):</label>
            <input type="number" id="desiredBedLength" value="43.5" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ÙƒÙ„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ (Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù‡Ø§Ù„Ùƒ)</div>
        </div>
        
        <div class="form-group">
            <label for="numCuts">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù„ÙƒÙ„ ÙØªØ­Ø©):</label>
            <input type="number" id="numCuts" value="7" min="1" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
            <div class="small">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø£Ùˆ Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´</div>
        </div>
        
        <div class="form-group">
            <label for="billetDiameter">Ù‚Ø·Ø± Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù„Ù…ÙƒØ¨Ø³ (Ø¨ÙˆØµØ©):</label>
            <select id="billetDiameter">
                <option value="5">5 Ø¨ÙˆØµØ©</option>
                <option value="6">6 Ø¨ÙˆØµØ©</option>
                <option value="7" selected>7 Ø¨ÙˆØµØ©</option>
                <option value="8">8 Ø¨ÙˆØµØ©</option>
                <option value="9">9 Ø¨ÙˆØµØ©</option>
                <option value="10">10 Ø¨ÙˆØµØ©</option>
                <option value="11">11 Ø¨ÙˆØµØ©</option>
            </select>
        </div>
        <div class="form-group compact-group">
            <label for="moldNumber">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ (Ø§Ù„Ø§Ø³Ø·Ù…Ø¨Ø©)(Ù…Ø«Ø§Ù„: 6621):</label>
            <input type="text" id="moldNumber" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
            <div class="small">Ø³ÙŠØªÙ… Ø§Ù„Ø¨Ø­Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ù†Ø³Ø®Ø©</div>
        </div>
        <div class="form-group compact-group">
            <label for="moldVersion">Ø±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø© (Ù…Ø«Ø§Ù„: 1 Ø£Ùˆ 2):</label>
            <input type="text" id="moldVersion" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø©" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
        </div>
        
        <!-- Ø­Ù‚Ù„ Ø§Ù„Ø¹ÙƒØ³: Ø¥Ø¯Ø®Ø§Ù„ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ - ØªÙ… Ù†Ù‚Ù„Ù‡ Ø¥Ù„Ù‰ Ù‡Ù†Ø§ -->
        <div class="form-group">
            <label for="inputBilletLength">Ø¥Ø°Ø§ Ø£Ø¯Ø®Ù„Øª Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª  (Ø³Ù…) Ø§Ø­Ø³Ø¨ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ:ØªÙ‚Ø±ÙŠØ¨Ø§</label>
            <input type="number" id="inputBilletLength" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª Ø¨Ø§Ù„Ø³Ù…" step="0.1" min="1" class="english-numbers" />
            <div class="small">ÙŠØ±Ø¬Ø¹ Ø§Ù„ÙˆØ²Ù† Ø¨Ø¹Ø¯ Ø·Ø±Ø­ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ ÙˆÙ‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³. Ø§Ù„Ø­Ø³Ø§Ø¨ ÙŠØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„.</div>
        </div>
    </div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
    <div id="autoFillNotice" class="auto-fill-notice">
        <span class="auto-fill-indicator"></span>
        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹...
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ -->
    <div class="mold-management">
        <h3 class="section-title">ğŸ’¾ Ù†Ø¸Ø§Ù… ØªØ®Ø²ÙŠÙ† Ùˆ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨(Ø§Ù„Ø§Ø³Ø·Ù…Ø¨Ø§Øª)</h3>
        <div class="mold-buttons">
            <button class="mold-btn mold-save" id="saveMoldBtn">ğŸ’¾ Ø­ÙØ¸</button>
            <button class="mold-btn mold-search" id="searchMoldBtn">ğŸ” Ø¨Ø­Ø«</button>
            <button class="mold-btn mold-show" id="showMoldsBtn">ğŸ“‹ Ø¹Ø±Ø¶</button>
            <button class="mold-btn mold-delete" id="deleteMoldBtn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>
        <div class="small">ÙŠÙ…ÙƒÙ†Ùƒ Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù…Ø«Ù„ 6621/1 Ø£Ùˆ 6621/2</div>
    </div>

    <!-- Ù‚Ø³Ù… Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ù„Ù„Ø¹Ù„Ø¨ ÙˆØ§Ù„Ù…ÙˆØ§Ø³ÙŠØ± ÙˆØ§Ù„Ø²ÙˆØ§ÙŠØ§ Ù…Ø¹ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
    <div class="box-calculator">
        <div class="box-calculator-header" id="boxCalculatorHeader">
            <h3>ğŸ“¦ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (Ø¹Ù„Ø¨/Ù…ÙˆØ§Ø³ÙŠØ±/Ø²ÙˆØ§ÙŠØ§)</h3>
            <button class="box-calculator-toggle" id="boxCalculatorToggle">â–¼</button>
        </div>
        
        <div class="box-calculator-content" id="boxCalculatorContent">
            <!-- Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù„Ø¨Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø³ÙŠØ± ÙˆØ§Ù„Ø²ÙˆØ§ÙŠØ§ -->
            <div class="profile-type-toggle">
                <div class="profile-type-btn active" data-type="box">ğŸ“¦ Ø¹Ù„Ø¨Ø©</div>
                <div class="profile-type-btn" data-type="pipe">â­• Ù…Ø§Ø³ÙˆØ±Ø©</div>
                <div class="profile-type-btn" data-type="angle">ğŸ“ Ø²Ø§ÙˆÙŠØ©</div>
            </div>
            
            <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¹Ù„Ø¨Ø© -->
            <div class="box-inputs active">
                <div class="box-input-group">
                    <div class="form-group">
                        <label for="boxWidth">Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ù…Ù…):</label>
                        <input type="number" id="boxWidth" value="40" step="0.1" min="1" class="english-numbers" />
                    </div>
                    <div class="form-group">
                        <label for="boxHeight">Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ù…Ù…):</label>
                        <input type="number" id="boxHeight" value="40" step="0.1" min="1" class="english-numbers" />
                    </div>
                    <div class="form-group">
                        <label for="boxThickness">Ø³Ù…Ùƒ Ø§Ù„Ø¹Ù„Ø¨Ø© (Ù…Ù…):</label>
                        <input type="number" id="boxThickness" value="0.5" step="0.01" min="0.1" class="english-numbers" />
                    </div>
                </div>
            </div>
            
            <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø³ÙŠØ± -->
            <div class="pipe-inputs">
                <div class="pipe-input-group">
                    <div class="form-group">
                        <label for="pipeOuterDiameter">Ø§Ù„Ù‚Ø·Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (Ù…Ù…):</label>
                        <input type="number" id="pipeOuterDiameter" value="50" step="0.1" min="1" class="english-numbers" />
                    </div>
                    <div class="form-group">
                        <label for="pipeThickness">Ø³Ù…Ùƒ Ø§Ù„Ù…Ø§Ø³ÙˆØ±Ø© (Ù…Ù…):</label>
                        <input type="number" id="pipeThickness" value="1.0" step="0.01" min="0.1" class="english-numbers" />
                    </div>
                    <div class="form-group">
                        <label style="visibility: hidden;">Ø­Ù‚Ù„ ÙØ§Ø±Øº Ù„Ù„Ù…Ø­Ø§Ø°Ø§Ø©</label>
                        <div style="height: 38px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ -->
            <div class="angle-inputs">
                <div class="angle-input-group">
                    <div class="form-group">
                        <label for="angleWidth">Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø§ÙˆÙŠØ© (Ù…Ù…):</label>
                        <input type="number" id="angleWidth" value="25" step="0.1" min="1" class="english-numbers" />
                    </div>
                    <div class="form-group">
                        <label for="angleHeight">Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø²Ø§ÙˆÙŠØ© (Ù…Ù…):</label>
                        <input type="number" id="angleHeight" value="25" step="0.1" min="1" class="english-numbers" />
                    </div>
                    <div class="form-group">
                        <label for="angleThickness">Ø³Ù…Ùƒ Ø§Ù„Ø²Ø§ÙˆÙŠØ© (Ù…Ù…):</label>
                        <input type="number" id="angleThickness" value="2.0" step="0.01" min="0.1" class="english-numbers" />
                    </div>
                </div>
            </div>
            
            <div class="box-result" id="boxWeightResult">
                Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ: <span id="calculatedBoxWeight" class="english-numbers">0.213</span> ÙƒØ¬Ù…/Ù…
            </div>
            
            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
            <div class="calculation-details" id="boxCalculationDetails">
                <div class="calculation-step"><strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©:</strong> <span id="outerArea" class="english-numbers">1600</span> Ù…Ù…Â²</div>
                <div class="calculation-step"><strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©:</strong> <span id="innerArea" class="english-numbers">1521</span> Ù…Ù…Â²</div>
                <div class="calculation-step"><strong>Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØµØ§ÙÙŠØ©:</strong> <span id="netArea" class="english-numbers">79</span> Ù…Ù…Â²</div>
                <div class="calculation-step"><strong>Ø§Ù„ÙƒØ«Ø§ÙØ©:</strong> 2.7 Ø¬Ù…/Ø³Ù…Â³</div>
            </div>
            
            <button id="applyBoxWeight" class="mold-btn mold-save" style="width:100%;margin-top:8px;padding:8px;">
                ğŸ“¥ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ø­Ø³ÙˆØ¨
            </button>
            
            <div class="small" style="text-align: center; margin-top: 8px;">
                Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ù…Ø¯Ø®Ù„Ø© (ÙƒØ«Ø§ÙØ© Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ… 2.7 Ø¬Ù…/Ø³Ù…Â³)
            </div>
        </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØ§Ù„Ø¨Ø«Ù‚ Ù…Ø¹ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
    <div class="alloy-settings-section">
        <div class="alloy-settings-header" id="alloySettingsHeader">
            <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØ§Ù„Ø¨Ø«Ù‚</h3>
            <button class="alloy-settings-toggle" id="alloySettingsToggle">â–¼</button>
        </div>
        
        <div class="alloy-settings-content" id="alloySettingsContent">
            <div class="form-grid">
                <div class="form-group">
                    <label for="alloy">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¨ÙŠÙƒØ©:</label>
                    <select id="alloy" title="Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø¨ÙŠÙƒØ© Ø³ÙŠØ¹Ø¯Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª Ù‚Ù„ÙŠÙ„Ø§Ù‹">
                        <option value="1050">1050</option>
                        <option value="1070">1070</option>
                        <option value="1100">1100</option>
                        <option value="3003">3003</option>
                        <option value="3004">3004</option>
                        <option value="2024">2024</option>
                        <option value="6060">6060</option>
                        <option value="6063" selected>6063 (Ø´Ø§Ø¦Ø¹ Ù„Ù„Ø¨Ø«Ù‚)</option>
                        <option value="6061">6061</option>
                        <option value="6005">6005</option>
                        <option value="6082">6082</option>
                        <option value="6101">6101</option>
                        <option value="7075">7075</option>
                        <option value="5083">5083</option>
                    </select>
                    <div class="small">Ø¥Ø°Ø§ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø§Ø®ØªØ± Ø§Ù„Ø£Ù‚Ø±Ø¨</div>
                </div>

                <div class="form-group">
                    <label for="weightPerCm">ÙˆØ²Ù† Ø§Ù„Ø¨Ù„ÙŠØª Ù„ÙƒÙ„ Ø³Ù… (ÙƒØ¬Ù…):</label>
                    <input type="number" id="weightPerCm" value="0.670" step="0.001" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø·Ø±ØŒ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ ÙŠØ¯ÙˆÙŠØ§Ù‹</div>
                </div>

                <!-- Ø­Ù‚Ù„ Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³ Ø§Ù„Ù…Ø¶Ø§Ù -->
                <div class="form-group">
                    <label for="buttScrap">Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³ (Ù…Ù…):(buttScrap )</label>
                    <input type="number" id="buttScrap" value="15" step="1" min="0" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¨Ù„ÙŠØª (Ø¨Ø§Ù„Ù…Ù„Ù„ÙŠÙ…ØªØ±)</div>
                </div>

                <div class="form-group">
                    <label for="extrusionRatio">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ (ER):</label>
                    <input type="number" id="extrusionRatio" value="30" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ø³ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø± ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ/ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙˆØ¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª</div>
                </div>

                <!-- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø­Ø±Ø§Ø±Ø© -->
                <div class="form-group">
                    <label for="extrusionTemperature">Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ø¯Ø§Ø®Ù„Ø© (Â°C):</label>
                    <input type="number" id="extrusionTemperature" value="480" step="1" min="350" max="520" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¨Ù„ÙŠØª Ù‚Ø¨Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù‚Ø§Ù„Ø¨ (Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØ§Ù„Ù‚Ø·Ø±)</div>
                </div>

                <div class="form-group">
                    <label for="autoTemperature">Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¨Ù„ÙŠØª:</label>
                    <select id="autoTemperature">
                        <option value="1">Ù…ÙØ¹Ù„ - Ø­Ø±Ø§Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØ§Ù„Ù‚Ø·Ø±</option>
                        <option value="0">Ù…Ø¹Ø·Ù„ - Ø­Ø±Ø§Ø±Ø© ÙŠØ¯ÙˆÙŠØ©</option>
                    </select>
                    <div class="small">Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„: Ø§Ù„Ø­Ø±Ø§Ø±Ø© ØªØ¶Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆÙ‚Ø·Ø± Ø§Ù„Ù…ÙƒØ¨Ø³</div>
                </div>

                <!-- Ø­Ù‚Ù„ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø«Ù‚ Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ -->
                <div class="form-group">
                    <label for="extrusionSpeed">Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø«Ù‚ (Ù…/Ø¯Ù‚ÙŠÙ‚Ø©):</label>
                    <div class="speed-with-type">
                        <input type="number" id="extrusionSpeed" value="6" step="0.1" min="1" max="12" inputmode="decimal" pattern="[0-9]*" class="english-numbers speed-input" />
                        <select id="moldType" class="mold-type-select">
                            <option value="hollow">ğŸ”„ Ù‡Ø§Ù„Ùˆ (Ù…Ø¬ÙˆÙ)</option>
                            <option value="solid">ğŸ”¶ Ø³ÙˆÙ„Ø¯ (ØµÙ„Ø¯)</option>
                        </select>
                    </div>
                    <div class="small" id="speedDescription">Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ø«Ù„Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø·ÙŠØ§Øª</div>
                </div>

                <!-- Ø­Ù‚Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹ - ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡ Ù„ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                <div class="form-group">
                    <label for="wastedTimePercentage">Ù†Ø³Ø¨Ø© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹ Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ø¨Ù„ÙŠØª (%):</label>
                    <input type="number" id="wastedTimePercentage" value="20" step="1" min="0" max="100" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ù†Ø³Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø¹Ø·ÙŠØ§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>
                </div>

                <div class="form-group">
                    <label for="scrapPercentage">Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù„Ùƒ (%):(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="number" id="scrapPercentage" value="5" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                </div>

                <div class="form-group">
                    <label for="safetyFactor">Ø¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (%):(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                    <input type="number" id="safetyFactor" value="5" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ø§ÙØªØ±Ø§Ø¶ÙŠ 5%Ø› Ù„Ùˆ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø«Ø§Ø¨ØªØ©</div>
                </div>

                <div class="form-group">
                    <label for="bedScrapLength">Ø·ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ (Ù…ØªØ±):</label>
                    <input type="number" id="bedScrapLength" value="1.5" step="0.1" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ø·ÙˆÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ Ù„Ù„Ù…Ù‚Ø¯Ù…Ø§Øª+Ø§Ù„Ù…Ø¤Ø§Ø®Ø±Ø§Øª</div>
                </div>

                <div class="form-group">
                    <label for="desiredTons">Ø§Ù„ÙƒÙ…ÙŠØ© Ø¨Ø§Ù„Ø·Ù† (Ø·Ù†):</label>
                    <input type="number" id="desiredTons" value="" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 2.5" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ù„Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø§Ø¹ÙˆØ§Ø¯</div>
                </div>

                <!-- Toggle Ù„ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ù…Ø¹Ù‹Ø§ -->
                <div class="form-group">
                    <label for="enableScrapSafety">ØªÙØ¹ÙŠÙ„ Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù†</label>
                    <select id="enableScrapSafety">
                        <option value="1">Ù…ÙØ¹Ù„</option>
                        <option value="0">Ù…Ø¹Ø·Ù„</option>
                    </select>
                    <div class="small">Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø·ÙŠÙ„ Ø³ÙŠÙØ­Ø³Ø¨ ÙƒÙ„ Ø§Ù„ÙˆØ²Ù† Ø¨Ø¯ÙˆÙ† Ø¥Ø¶Ø§ÙØ© Ù†Ø³Ø¨ Ø§Ù„Ù‡Ø§Ù„Ùƒ ÙˆØ§Ù„Ø£Ù…Ø§Ù†.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
    <div class="heat-treatment-section">
        <div class="heat-treatment-header" id="heatTreatmentHeader">
            <h3>ğŸ”¥ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ù„Ù„ÙØ±Ù†</h3>
            <button class="heat-treatment-toggle" id="heatTreatmentToggle">â–¼</button>
        </div>
        
        <div class="heat-treatment-content" id="heatTreatmentContent">
            <div class="form-grid">
                <div class="form-group thickness-group">
                    <label for="materialThickness">Ø³Ù…Ùƒ Ø§Ù„Ù…Ø§Ø¯Ø© (Ù…Ù…):</label>
                    <input type="number" id="materialThickness" value="1.5" step="0.1" min="0.5" max="10" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ø³Ù…Ùƒ Ø§Ù„Ù…Ø§Ø¯Ø© ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©</div>
                    
                    <!-- Ø²Ø± Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù…Ùƒ -->
                    <button class="thickness-calc-btn" id="calculateAverageThickness">
                        ğŸ“Š Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ø§Øª Ù…Ø®ØªÙ„Ù Ø§Ù„Ø³Ù…Ø§ÙƒØ© (0.5-5 Ù…Ù…)
                    </button>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ù…Ùƒ Ø§Ù„Ù…ØªÙˆØ³Ø· -->
                    <div class="thickness-info" id="thicknessInfo" style="display: none;">
                        <h4>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù…Ùƒ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨</h4>
                        <div class="thickness-values">
                            <div class="thickness-value">
                                <div class="label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù…Ùƒ</div>
                                <div class="value" id="averageThicknessValue">2.75 Ù…Ù…</div>
                            </div>
                            <div class="thickness-value">
                                <div class="label">Ø§Ù„Ù…Ø¯Ù‰</div>
                                <div class="value">0.5 - 5 Ù…Ù…</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="t4Time">T4 - ØªØµÙ„Ø¨ Ø¨Ø§Ù„Ù‡ÙˆØ§Ø¡ (Ø³Ø§Ø¹Ø©):</label>
                    <input type="number" id="t4Time" value="0" step="0.1" min="0" inputmode="decimal" pattern="[0-9]*" class="english-numbers" readonly style="background:#f5f5f5;" />
                    <div class="small">T4: ØªØµÙ„Ø¨ Ø¨Ø§Ù„Ù‡ÙˆØ§Ø¡ ÙÙ‚Ø· - Ù„Ø§ ÙŠØ¯Ø®Ù„ ÙØ±Ù† Ø§Ù„Ù…Ø­Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©</div>
                </div>
                
                <div class="form-group">
                    <label for="t5Time">T5 - ÙØ±Ù† Ø§Ù„Ù…Ø­Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© (Ø³Ø§Ø¹Ø©):</label>
                    <input type="number" id="t5Time" value="2.5" step="0.1" min="0" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">T5: ØªØµÙ„Ø¨ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - ÙŠØ¯Ø®Ù„ ÙØ±Ù† Ø§Ù„Ù…Ø­Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©</div>
                </div>
                
                <div class="form-group">
                    <label for="t6Time">T6 - ÙØ±Ù† Ø§Ù„Ù…Ø­Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© (Ø³Ø§Ø¹Ø©):</label>
                    <input type="number" id="t6Time" value="4.5" step="0.1" min="0" inputmode="decimal" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">T6: ØªØµÙ„Ø¨ ÙƒØ§Ù…Ù„ - ÙŠØ¯Ø®Ù„ ÙØ±Ù† Ø§Ù„Ù…Ø­Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©</div>
                </div>
                
                <div class="form-group">
                    <label for="heatTreatmentTemp">Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© (Â°C):</label>
                    <input type="number" id="heatTreatmentTemp" value="175" step="1" min="100" max="250" inputmode="numeric" pattern="[0-9]*" class="english-numbers" />
                    <div class="small">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø«Ù„Ù‰ Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©</div>
                </div>
            </div>
            
            <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ© Ø§Ù„Ù…Ø¶Ø§Ù -->
            <div class="european-standards-notice">
                <div class="european-standards-title">ğŸ‡ªğŸ‡º Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ© (EN 755/EN 12020)</div>
                <div class="european-standards-content">
                    <div class="european-standards-step"><strong>EN 755-2:</strong> Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø®ÙˆØ§Øµ Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ© Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ… ÙˆØ§Ù„Ø¨Ø«Ù‚</div>
                    <div class="european-standards-step"><strong>EN 12020-2:</strong> Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ… Ù…Ù† Ø³Ø¨Ø§Ø¦Ùƒ AW6060 Ùˆ AW6063 - ØªÙØ§ÙˆØªØ§Øª Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ÙˆØ§Ù„Ø´ÙƒÙ„</div>
                    <div class="european-standards-step"><strong>Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„Ø©:</strong></div>
                    <div class="european-standards-step">â€¢ <strong>6060/6063-T6:</strong> 4-8 Ø³Ø§Ø¹Ø§Øª Ø¹Ù†Ø¯ 175Â°Ù… Â±5Â°Ù…</div>
                    <div class="european-standards-step">â€¢ <strong>6082-T6:</strong> 4-8 Ø³Ø§Ø¹Ø§Øª Ø¹Ù†Ø¯ 175Â°Ù… Â±5Â°Ù…</div>
                    <div class="european-standards-step">â€¢ <strong>6005-T6:</strong> 4-8 Ø³Ø§Ø¹Ø§Øª Ø¹Ù†Ø¯ 175Â°Ù… Â±5Â°Ù…</div>
                    <div class="european-standards-step"><strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© Ø£Ø¹Ù„Ø§Ù‡ Ù„Ù„Ø§Ø³ØªØ±Ø´Ø§Ø¯ ÙˆÙ‚Ø¯ ØªØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø¸Ø±ÙˆÙ Ø§Ù„ÙØ±Ù† ÙˆØ§Ù„ÙƒØªÙ„Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬.</div>
                </div>
            </div>
            
            <div class="small" style="text-align: center; margin-top: 8px;">
                ğŸ’¡ <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> 
                <br>â€¢ <strong>T4</strong> - ØªØµÙ„Ø¨ Ø¨Ø§Ù„Ù‡ÙˆØ§Ø¡ ÙÙ‚Ø· (Ù„Ø§ ÙŠØ¯Ø®Ù„ ÙØ±Ù†)
                <br>â€¢ <strong>T5</strong> - ØªØµÙ„Ø¨ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù‚ØµÙŠØ± (ÙŠØ¯Ø®Ù„ ÙØ±Ù† Ø§Ù„Ù…Ø­Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©)  
                <br>â€¢ <strong>T6</strong> - ØªØµÙ„Ø¨ ÙƒØ§Ù…Ù„  (ÙŠØ¯Ø®Ù„ ÙØ±Ù† Ø§Ù„Ù…Ø­Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©)
            </div>
        </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø¬ÙˆØ¯Ø© -->
    <div class="quality-standards-section">
        <div class="quality-standards-header" id="qualityStandardsHeader">
            <h3>ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø³Ù…Ø§Ø­ÙŠØ§Øª ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ… (DIN)</h3>
            <button class="quality-standards-toggle" id="qualityStandardsToggle">â–¼</button>
        </div>
        
        <div class="quality-standards-content" id="qualityStandardsContent">
            <div class="small" style="text-align: center; margin-bottom: 10px;">
                ğŸ“ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆØ§Ù„ØªØ³Ø§Ù…Ø­Ø§Øª (Ù…Ù…)
            </div>
            
            <table class="quality-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ (Ù…Ù…)</th>
                        <th>EN 755-9 (Â±Ù…Ù…)</th>
                        <th>ASTM B221 (Â±Ù…Ù…)</th>
                        <th>DIN 17615 (Â±Ù…Ù…)</th>
                        <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¬ÙˆØ¯Ø©</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="quality-high">
                        <td>â‰¤ 10</td>
                        <td>0.15</td>
                        <td>0.13</td>
                        <td>0.12</td>
                        <td>Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù‚Ø©</td>
                    </tr>
                    <tr class="quality-high">
                        <td>10 - 30</td>
                        <td>0.20</td>
                        <td>0.18</td>
                        <td>0.15</td>
                        <td>Ø¹Ø§Ù„ÙŠ</td>
                    </tr>
                    <tr class="quality-medium">
                        <td>30 - 60</td>
                        <td>0.30</td>
                        <td>0.25</td>
                        <td>0.20</td>
                        <td>Ù…ØªÙˆØ³Ø·</td>
                    </tr>
                    <tr class="quality-standard">
                        <td>60 - 120</td>
                        <td>0.50</td>
                        <td>0.40</td>
                        <td>0.30</td>
                        <td>Ù‚ÙŠØ§Ø³ÙŠ</td>
                    </tr>
                    <tr class="quality-economy">
                        <td>> 120</td>
                        <td>0.70</td>
                        <td>0.60</td>
                        <td>0.50</td>
                        <td>Ø§Ù‚ØªØµØ§Ø¯ÙŠ</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="small" style="text-align: center; margin: 10px 0;">
                ğŸ“ Ø§Ù„Ø³Ù…Ø§ÙƒØ§Øª  (Ù…Ù…)
            </div>
            
            <table class="quality-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø³Ù…Ø§ÙƒØ© (Ù…Ù…)</th>
                        <th>EN 755-2 (Â±Ù…Ù…)</th>
                        <th>ASTM B221 (Â±Ù…Ù…)</th>
                        <th>DIN 17615 (Â±Ù…Ù…)</th>
                        <th>Ø­Ø¬Ù… Ø§Ù„Ø³Ù…Ùƒ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="quality-high">
                        <td>â‰¤ 1.0</td>
                        <td>0.10</td>
                        <td>0.08</td>
                        <td>0.08</td>
                        <td>Ø³Ù…Ùƒ Ø±ÙÙŠØ¹</td>
                    </tr>
                    <tr class="quality-high">
                        <td>1.0 - 1.5</td>
                        <td>0.12</td>
                        <td>0.10</td>
                        <td>0.09</td>
                        <td>Ø³Ù…Ùƒ Ù…ØªÙˆØ³Ø·</td>
                    </tr>
                    <tr class="quality-medium">
                        <td>1.5 - 2.0</td>
                        <td>0.15</td>
                        <td>0.13</td>
                        <td>0.12</td>
                        <td>Ø³Ù…Ùƒ Ù…ØªÙˆØ³Ø·</td>
                    </tr>
                    <tr class="quality-medium">
                        <td>2.0 - 3.0</td>
                        <td>0.18</td>
                        <td>0.15</td>
                        <td>0.14</td>
                        <td>Ø³Ù…Ùƒ Ø³Ù…ÙŠÙƒ</td>
                    </tr>
                    <tr class="quality-standard">
                        <td>3.0 - 4.0</td>
                        <td>0.20</td>
                        <td>0.18</td>
                        <td>0.16</td>
                        <td>Ø³Ù…Ùƒ Ø³Ù…ÙŠÙƒ</td>
                    </tr>
                    <tr class="quality-standard">
                        <td>4.0 - 6.0</td>
                        <td>0.25</td>
                        <td>0.20</td>
                        <td>0.18</td>
                        <td>Ø³Ù…Ùƒ Ø³Ù…ÙŠÙƒ Ø¬Ø¯Ø§Ù‹</td>
                    </tr>
                    <tr class="quality-economy">
                        <td>> 6.0</td>
                        <td>0.30</td>
                        <td>0.25</td>
                        <td>0.20</td>
                        <td>Ø³Ù…Ùƒ Ø³Ù…ÙŠÙƒ Ø¬Ø¯Ø§Ù‹</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="small" style="text-align: center; margin: 10px 0;">
                ğŸ“Š Ø§Ù„Ø§Ø³ØªÙ‚Ø§Ù…Ø© ÙˆØ§Ù„ØªÙ‚ÙˆØ³ (Ù„Ø·ÙˆÙ„ 6 Ù…ØªØ±)
            </div>
            
            <table class="quality-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…ÙˆØ§ØµÙØ©</th>
                        <th>Ø§Ù„ØªÙ‚ÙˆØ³ Ø§Ù„Ù…Ø³Ù…ÙˆØ­</th>
                        <th>Ø§Ù„Ø§Ø³ØªÙ‚Ø§Ù…Ø© Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="quality-high">
                        <td>EN 755-9</td>
                        <td>6 Ù…Ù…</td>
                        <td>12 Ù…Ù…</td>
                    </tr>
                    <tr class="quality-medium">
                        <td>ASTM B221</td>
                        <td>9 Ù…Ù…</td>
                        <td>12 Ù…Ù…</td>
                    </tr>
                    <tr class="quality-high">
                        <td>DIN 17615</td>
                        <td>4.8 Ù…Ù…</td>
                        <td>9 Ù…Ù…</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="small" style="text-align: center; margin-top: 8px;">
                ğŸ“ Ø§Ù„Ø²ÙˆØ§ÙŠØ§ ÙˆØ§Ù„ØªØ³Ø§Ù…Ø­Ø§Øª Ø§Ù„Ø²Ø§ÙˆÙŠØ©
            </div>
            
            <table class="quality-table">
                <thead>
                    <tr>
                        <th>Ù†ÙˆØ¹ Ø§Ù„Ø²Ø§ÙˆÙŠØ©</th>
                        <th>EN 755-9</th>
                        <th>ASTM B221</th>
                        <th>DIN 17615</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="quality-medium">
                        <td>Ø§Ù„Ø²ÙˆØ§ÙŠØ§ 90Â°</td>
                        <td>Â±1.5Â°</td>
                        <td>Â±2.0Â°</td>
                        <td>Â±1.0Â°</td>
                    </tr>
                    <tr class="quality-high">
                        <td>Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ø­Ø§Ø¯Ø©</td>
                        <td>Â±1.0Â°</td>
                        <td>Â±1.5Â°</td>
                        <td>Â±0.8Â°</td>
                    </tr>
                    <tr class="quality-standard">
                        <td>Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ù…Ù†ÙØ±Ø¬Ø©</td>
                        <td>Â±2.0Â°</td>
                        <td>Â±2.5Â°</td>
                        <td>Â±1.5Â°</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="small" style="text-align: center; margin-top: 8px;">
            </div>
        </div>
    </div>

    <!-- Ø²Ø± Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø©ğŸ”¥ -->
    <div class="temperature-toggle-section">
        <button class="temperature-toggle-btn" id="temperatureToggleBtn">
            ğŸ‘ï¸  Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© ğŸ”¥Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ø³Ø¨Ø§Ø¦Ùƒ Ø§Ù„Ø§Ù„ÙˆÙ…Ù†ÙŠÙˆÙ…
        </button>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ù„Ù„Ø³Ø¨Ø§Ø¦Ùƒ -->
    <div class="exit-temperature-prediction" id="temperatureTableSection">
        <h3 class="exit-temperature-title">ğŸŒ¡ï¸ğŸ”¥ Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¨Ø«Ù‚ Ù„Ù„Ø³Ø¨Ø§Ø¦Ùƒ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</h3>
        <table class="temperature-table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø³Ø¨ÙŠÙƒØ©</th>
                    <th>Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ø¯Ø§Ø®Ù„Ø©</th>
                    <th>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù„Ù„Ø®Ø±ÙˆØ¬</th>
                    <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1050, 1070, 1100</td>
                    <td>440-480Â°C</td>
                    <td>480-520Â°C</td>
                    <td>Ø³Ø¨Ø§Ø¦Ùƒ Ù†Ø§Ø¹Ù…Ø© - Ø³Ù‡Ù„Ø© Ø§Ù„Ø¨Ø«Ù‚</td>
                </tr>
                <tr>
                    <td>3003, 3004</td>
                    <td>450-490Â°C</td>
                    <td>490-530Â°C</td>
                    <td>Ø³Ø¨Ø§Ø¦Ùƒ Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØµÙ„Ø§Ø¨Ø©</td>
                </tr>
                <tr>
                    <td>6060, 6063</td>
                    <td>460-500Â°C</td>
                    <td>500-540Â°C</td>
                    <td>Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø«Ù‚</td>
                </tr>
                <tr>
                    <td>6061</td>
                    <td>470-510Â°C</td>
                    <td>510-550Â°C</td>
                    <td>ØªØ­ØªØ§Ø¬ Ø­Ø±Ø§Ø±Ø© Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹</td>
                </tr>
                <tr>
                    <td>6005, 6082</td>
                    <td>480-520Â°C</td>
                    <td>520-560Â°C</td>
                    <td>Ø³Ø¨Ø§Ø¦Ùƒ Ø£Ù‚ÙˆÙ‰ - Ø­Ø±Ø§Ø±Ø© Ø£Ø¹Ù„Ù‰</td>
                </tr>
                <tr>
                    <td>6101</td>
                    <td>460-500Â°C</td>
                    <td>500-540Â°C</td>
                    <td>Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù€ 6063</td>
                </tr>
                <tr>
                    <td>2024</td>
                    <td>400-440Â°C</td>
                    <td>440-480Â°C</td>
                    <td>Ø³Ø¨ÙŠÙƒØ© ØµÙ„Ø¨Ø© - Ø­Ø±Ø§Ø±Ø© Ù…Ù†Ø®ÙØ¶Ø©</td>
                </tr>
                <tr>
                    <td>7075</td>
                    <td>380-420Â°C</td>
                    <td>420-460Â°C</td>
                    <td>Ø³Ø¨ÙŠÙƒØ© ÙØ§Ø¦Ù‚Ø© Ø§Ù„ØµÙ„Ø§Ø¨Ø©</td>
                </tr>
                <tr>
                    <td>5083</td>
                    <td>420-460Â°C</td>
                    <td>460-500Â°C</td>
                    <td>Ø³Ø¨ÙŠÙƒØ© Ø¨Ø­Ø±ÙŠØ© - Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©</td>
                </tr>
            </tbody>
        </table>
        <div class="small" style="text-align: center; margin-top: 8px;">
            ğŸ“Š Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø© Ø¹Ù„Ù‰ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬: Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ØŒ Ø§Ù„Ø³Ù…Ø§ÙƒØ©ØŒ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø«Ù‚ØŒ ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø§Ù„Ø¨
        </div>
    </div>

    <div class="buttons-group">
        <button class="calculate-btn" id="calculateBtn">ğŸ§® Ø§Ø­Ø³Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª</button>
        <button class="reset-btn" id="resetBtn">ğŸ”„ Ù…Ø³Ø­</button>
        <button class="print-btn" id="printBtn">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
    </div>

    <div id="result" class="result" aria-live="polite">
        <!-- Ø²Ø± Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <button class="toggle-results-btn" id="toggleResultsBtn">
            ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        </button>

        <h3>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
        <div class="calculation-info">
            <p><strong>ğŸ”§ Ø¹Ø¯Ø¯ ÙØªØ­Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨:</strong> <span id="resultOpenings" class="english-numbers"></span></p>
            <p><strong>âš–ï¸ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯:</strong> <span id="resultRodWeight" class="english-numbers"></span> ÙƒØ¬Ù…</p>
            <p><strong>âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…):</strong> <span id="resultWeightPerMeter" class="english-numbers"></span></p>
            <p><strong>âœ‚ï¸ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù„ÙƒÙ„ ÙØªØ­Ø©):</strong> <span id="resultCuts" class="english-numbers"></span></p>
            <p><strong>ğŸ“ Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯:</strong> <span id="resultRodLength" class="english-numbers"></span></p>
            <p><strong>ğŸ“ Ù‚Ø·Ø± Ø§Ù„Ø¨Ù„ÙŠØª:</strong> <span id="resultDiameter" class="english-numbers"></span></p>
            <p><strong>ğŸ”© Ø§Ù„Ø³Ø¨ÙŠÙƒØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</strong> <span id="resultAlloy"></span></p>
            <p><strong>ğŸŒ¡ï¸ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ø¯Ø§Ø®Ù„Ø©:</strong> <span id="resultTemperature" class="english-numbers"></span> Â°C</p>
            <p><strong>âš¡ Ø³Ø±Ø¹Ø© Ø§Ù„Ø±Ø§Ù… Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© :</strong> <span id="resultSpeed" class="english-numbers"></span> Ù…/Ø¯Ù‚ÙŠÙ‚Ø© 
                <span id="resultMoldType" class="mold-type-indicator"></span>
            </p>
            <p><strong>ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø©:</strong> <span id="resultBilletsPerHour" class="english-numbers"></span> Ø¨Ù„ÙŠØª/Ø³Ø§Ø¹Ø©</p>
            <p><strong>ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø© ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø©:</strong> <span id="resultHourlyKg" class="english-numbers"></span> ÙƒØ¬Ù…/Ø³Ø§Ø¹Ø© (<span id="resultHourlyTons" class="english-numbers"></span> Ø·Ù†/Ø³Ø§Ø¹Ø©)</p>
            <p><strong>ğŸ—‘ï¸ Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³:</strong> <span id="resultButtScrap" class="english-numbers"></span> Ù…Ù…</p>
            <p><strong>ğŸ“ˆ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ (ER):</strong> <span id="resultExtrusionRatio" class="english-numbers"></span></p>
            <p><strong>â±ï¸ Ù†Ø³Ø¨Ø© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹:</strong> <span id="resultWastedTime" class="english-numbers"></span> %</p>
        </div>

        <div class="billet-result">
            ğŸ“ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¨Ù„ÙŠØª: <span id="billetLength" class="english-numbers"></span> Ø³Ù… (<span id="billetLengthMm" class="english-numbers"></span> Ù…Ù…)
        </div>

        <div style="color:#7f8c8d;font-size:14px;margin-top:6px;">
            âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª: <span id="billetWeight" class="english-numbers"></span> ÙƒØ¬Ù…
        </div>

        <!-- Ù‚Ø³Ù… ØªÙˆÙ‚Ø¹ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ -->
        <div id="exitTemperatureResult" class="exit-temperature-prediction" style="display:none;">
            <div class="exit-temperature-title">ğŸ”¥ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ù„Ø¨</div>
            <div class="exit-temperature-value" id="exitTemperatureValue" class="english-numbers"></div>
            <div class="exit-temperature-details" id="exitTemperatureDetails"></div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ -->
        <div id="bedLengthResult" class="bed-length-result" style="display:none;">
            <div class="bed-length-title">ğŸ“ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´</div>
            <div class="bed-length-value" id="bedLengthValue" class="english-numbers"></div>
            <div class="bed-length-details" id="bedLengthDetails"></div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - ØªÙ… Ø¥Ø®ÙØ§Ø¤Ù‡ -->
        <div id="heatTreatmentResult" class="heat-treatment-result" style="display:none;">
            <!-- ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
        </div>

        <div id="calculationDetails" class="calculation-steps"></div>

        <div id="analysisBlock" class="analysis-table" style="display:none;">
            <table>
                <thead>
                    <tr><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©</th><th>Ø§Ù„Ù†Ø§ØªØ¬</th></tr>
                </thead>
                <tbody id="analysisTableBody"></tbody>
            </table>
        </div>

        <div id="summaryBox" class="summary"></div>

        <!-- Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙÙŠ Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div class="contact-phones">
            <a href="tel:01124006047" class="phone-contact-item">
                <svg class="phone-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 16.5v3a1 1 0 0 1-1.1 1 19.5 19.5 0 0 1-8.9-3.2 19 19 0 0 1-6-6A19.5 19.5 0 0 1 3.5 4.1 1 1 0 0 1 4.5 3h3a1 1 0 0 1 1 0.8c.1.7.3 1.4.6 2a1 1 0 0 1-.2 1.1L8.9 8.9a14 14 0 0 0 6 6l1.1-1.1a1 1 0 0 1 1.1-.2c.6.3 1.3.5 2 .6a1 1 0 0 1 .8 1z" fill="#fff"/>
                </svg>
                01124006047
            </a>
            
            <a href="tel:01120440740" class="phone-contact-item">
                <svg class="phone-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 16.5v3a1 1 0 0 1-1.1 1 19.5 19.5 0 0 1-8.9-3.2 19 19 0 0 1-6-6A19.5 19.5 0 0 1 3.5 4.1 1 1 0 0 1 4.5 3h3a1 1 0 0 1 1 0.8c.1.7.3 1.4.6 2a1 1 0 0 1-.2 1.1L8.9 8.9a14 14 0 0 0 6 6l1.1-1.1a1 1 0 0 1 1.1-.2c.6.3 1.3.5 2 .6a1 1 0 0 1 .8 1z" fill="#fff"/>
                </svg>
                01120440740
            </a>
        </div>

        <!-- Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª -->
        <div class="whatsapp-row">
            <a class="whatsapp-btn" href="https://wa.me/201124006047" target="_blank" rel="noopener noreferrer" title="Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.52 3.478A11.79 11.79 0 0012 0C5.373 0 .01 5.373.01 12c0 2.12.56 4.17 1.62 5.97L0 24l6.24-1.62A11.93 11.93 0 0012 24c6.627 0 12-5.373 12-12 0-2.99-1.17-5.78-3.48-7.522z" fill="#25D366"/>
                    <path d="M17.4 14.1c-.3-.15-1.76-.87-2.03-.97-.27-.1-.47-.15-.67.15s-.77.97-.95 1.17c-.17.2-.34.22-.64.07-1.71-.85-2.83-1.5-3.96-3.42-.3-.52.3-.49.86-1.62.09-.17.05-.31-.02-.46-.07-.15-.67-1.62-.92-2.22-.24-.58-.48-.5-.66-.51l-.56-.01c-.18 0-.47.07-.72.34-.25.27-.95.93-.95 2.27 0 1.34.98 2.63 1.12 2.81.14.17 1.93 3.12 4.68 4.37 1.63.7 2.37.75 3.22.63.49-.07 1.5-.61 1.71-1.21.21-.6.21-1.11.15-1.22-.06-.1-.22-.15-.52-.3z" fill="#fff"/>
                </svg>
                ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
            </a>
        </div>
        
        <!-- Ø£Ø²Ø±Ø§Ø± ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¶Ø§ÙØ© -->
        <div class="social-media-row">
            <a class="social-media-btn" href="https://www.facebook.com/share/14QS3fDdsCW/" target="_blank" rel="noopener noreferrer" title="ØµÙØ­Ø© Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" fill="#ffffff"/>
                </svg>
                ÙÙŠØ³Ø¨ÙˆÙƒ
            </a>
            
            <a class="social-media-btn tiktok" href="https://www.tiktok.com/@elmalakfahd?_r=1&_t=ZS-91XdZbKGZfj" target="_blank" rel="noopener noreferrer" title="Ø­Ø³Ø§Ø¨ ØªÙŠÙƒ ØªÙˆÙƒ">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z" fill="#ffffff"/>
                </svg>
                ØªÙŠÙƒ ØªÙˆÙƒ
            </a>
        </div>
        
        <div class="whatsapp-note">Ø§Ø¶ØºØ· Ù„ÙØªØ­ Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø§Ù„Ø±Ù‚Ù… 01124006047</div>
    </div>
</div>

<script>
// ===== ØªÙ‡ÙŠØ¦Ø© Firebase =====
const firebaseConfig = {
  apiKey: "AIzaSyBXa_d9Iv45AXmw3i8qfK-qsB_GOu8Lu4E",
  authDomain: "billet-calculator.firebaseapp.com",
  projectId: "billet-calculator",
  storageBucket: "billet-calculator.firebasestorage.app",
  messagingSenderId: "94813264906",
  appId: "1:94813264906:web:2f08a67bd6ef62c36b53f3",
  measurementId: "G-4SP4QLKJ20"
};

// ØªÙ‡ÙŠØ¦Ø© Firebase
try {
  firebase.initializeApp(firebaseConfig);
  console.log("âœ… Firebase initialized successfully");
  
  // ØªÙ‡ÙŠØ¦Ø© Analytics
  const analytics = firebase.analytics();
  
  // ØªÙ‡ÙŠØ¦Ø© Firestore
  const db = firebase.firestore();
  
  // ØªÙ‡ÙŠØ¦Ø© Authentication
  const auth = firebase.auth();
  
  // ØªÙ‡ÙŠØ¦Ø© Storage
  const storage = firebase.storage();
  
} catch (error) {
  console.error("âŒ Firebase initialization error:", error);
}

// ===== Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù† Ù…Ø¹ Ø·Ø±Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯Ø¯ =====
class UserManagementSystem {
    constructor(userManager, adminManager) {
        this.userManager = userManager;
        this.adminManager = adminManager;
    }

    // Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
    showUserManagement() {
        if (!this.adminManager.isAdmin() && !this.adminManager.isDeveloper()) {
            showTempMessage('âŒ ØªØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø´Ø±Ù Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ©', 'error');
            return;
        }

        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - Ø§Ù„Ø·Ø±Ø¯ Ø§Ù„Ù…Ø­Ø¯Ø¯';
        
        let usersHtml = `
            <div style="margin-bottom: 15px;">
                <input type="text" id="userSearch" placeholder="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯" 
                       style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; direction: rtl;">
            </div>
            <div class="company-users-list" style="max-height: 300px; overflow-y: auto;">
        `;
        
        const allUsers = this.getAllUsersWithDetails();
        
        if (Object.keys(allUsers).length === 0) {
            usersHtml += '<div style="text-align: center; padding: 20px; color: #666;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø³Ø¬Ù„ÙŠÙ†</div>';
        } else {
            for (const userId in allUsers) {
                const user = allUsers[userId];
                const roleClass = user.role === 'admin' ? 'admin' : '';
                const roleText = user.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…';
                const statusText = user.isLoggedIn ? 'ğŸŸ¢ Ù…ØªØµÙ„' : 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„';
                const lastLogin = user.lastLogin ? new Date(user.lastLogin).toLocaleString('ar-EG') : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                
                usersHtml += `
                    <div class="company-user-item" data-user-id="${userId}" data-user-email="${user.email}">
                        <div style="flex: 1;">
                            <strong>${user.name}</strong>
                            <span class="user-role ${roleClass}">${roleText}</span>
                            <br>
                            <small>${user.email}</small>
                            <br>
                            <small>${statusText} | Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„: ${lastLogin}</small>
                        </div>
                        <div style="display: flex; gap: 5px; flex-direction: column;">
                            <button onclick="userManagement.kickUser('${user.email}')" 
                                    class="kick-user-btn" 
                                    style="background: #e74c3c; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                ğŸšª Ø·Ø±Ø¯
                            </button>
                            <button onclick="userManagement.toggleAdminRole('${user.email}')" 
                                    class="admin-toggle-btn" 
                                    style="background: ${user.role === 'admin' ? '#95a5a6' : '#3498db'}; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                ${user.role === 'admin' ? 'Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠØ±' : 'ØªØ¹ÙŠÙŠÙ† Ù…Ø¯ÙŠØ±'}
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        usersHtml += `
            </div>
            <div style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                <strong>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:</strong>
                <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${Object.keys(allUsers).length}</div>
                <div>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†: ${Object.values(allUsers).filter(u => u.isLoggedIn).length}</div>
                <div>Ø§Ù„Ù…Ø¯ÙŠØ±ÙˆÙ†: ${Object.values(allUsers).filter(u => u.role === 'admin').length}</div>
            </div>
        `;

        modalContent.innerHTML = usersHtml;
        modal.style.display = 'flex';

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø¨Ø­Ø«
        document.getElementById('userSearch').addEventListener('input', (e) => {
            this.filterUsers(e.target.value);
        });
    }

    // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø¹ ØªÙØ§ØµÙŠÙ„Ù‡Ù…
    getAllUsersWithDetails() {
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        const companies = JSON.parse(localStorage.getItem('companies') || '{}');
        
        let allUsers = {};
        
        // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        Object.keys(users).forEach(email => {
            allUsers[email] = {
                ...users[email],
                source: 'users'
            };
        });
        
        // Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª
        Object.values(companies).forEach(company => {
            if (company.users) {
                Object.keys(company.users).forEach(userId => {
                    const user = company.users[userId];
                    if (!allUsers[user.email]) {
                        allUsers[user.email] = {
                            ...user,
                            source: 'company',
                            companyName: company.name
                        };
                    }
                });
            }
        });
        
        return allUsers;
    }

    // ØªØµÙÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
    filterUsers(searchTerm) {
        const userItems = document.querySelectorAll('.company-user-item');
        const searchLower = searchTerm.toLowerCase();
        
        userItems.forEach(item => {
            const userName = item.querySelector('strong').textContent.toLowerCase();
            const userEmail = item.querySelector('small').textContent.toLowerCase();
            const userRole = item.querySelector('.user-role').textContent.toLowerCase();
            
            if (userName.includes(searchLower) || userEmail.includes(searchLower) || userRole.includes(searchLower)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    // Ø·Ø±Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯Ø¯
    kickUser(email) {
        if (!this.adminManager.isAdmin() && !this.adminManager.isDeveloper()) {
            showTempMessage('âŒ ØªØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø´Ø±Ù Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ©', 'error');
            return;
        }
        
        if (!confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø·Ø±Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${email}ØŸ Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ù‡ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ù„Ø³Ø§Øª.`)) {
            return;
        }

        const users = JSON.parse(localStorage.getItem('users') || '{}');
        
        if (!users[email]) {
            showTempMessage('âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            return;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        users[email].isLoggedIn = false;
        users[email].lastLogout = new Date().toISOString();
        localStorage.setItem('users', JSON.stringify(users));

        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        if (this.userManager.currentUser.email === email) {
            showTempMessage('âœ… ØªÙ… Ø·Ø±Ø¯Ùƒ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…', 'success');
            setTimeout(() => {
                this.userManager.logoutUser();
                location.reload();
            }, 2000);
        } else {
            showTempMessage(`âœ… ØªÙ… Ø·Ø±Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${email} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            setTimeout(() => this.showUserManagement(), 1000);
        }
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø¯ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±
    toggleAdminRole(email) {
        if (!this.adminManager.isDeveloper()) {
            showTempMessage('âŒ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†', 'error');
            return;
        }

        const users = JSON.parse(localStorage.getItem('users') || '{}');
        const user = users[email];
        
        if (!user) {
            showTempMessage('âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
            return;
        }

        const newRole = user.role === 'admin' ? 'user' : 'admin';
        const actionText = newRole === 'admin' ? 'ØªÙ… Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±' : 'ØªÙ… Ø¥Ø²Ø§Ù„Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±';
        
        if (!confirm(`âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ ${actionText} Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${email}ØŸ`)) {
            return;
        }

        user.role = newRole;
        users[email] = user;
        localStorage.setItem('users', JSON.stringify(users));

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        if (newRole === 'admin') {
            const adminUsers = this.adminManager.getAdminUsers();
            if (!adminUsers.includes(email)) {
                adminUsers.push(email);
                localStorage.setItem('billet_admin_users', JSON.stringify(adminUsers));
            }
        }

        showTempMessage(`âœ… ${actionText} Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${email}`, 'success');
        setTimeout(() => this.showUserManagement(), 1000);
    }

    // Ø·Ø±Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø­Ø³Ù†Ø©)
    kickAllUsers() {
        if (!this.adminManager.isDeveloper()) {
            showTempMessage('âŒ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†', 'error');
            return;
        }
        
        if (!confirm('ğŸš¨ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø·Ø±Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ù‡Ù…ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø³ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†.')) {
            return;
        }

        const users = JSON.parse(localStorage.getItem('users') || '{}');
        let kickedCount = 0;
        
        // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        Object.keys(users).forEach(email => {
            if (users[email].isLoggedIn) {
                users[email].isLoggedIn = false;
                users[email].lastLogout = new Date().toISOString();
                kickedCount++;
            }
        });
        
        localStorage.setItem('users', JSON.stringify(users));
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø·ÙˆØ±Ø§Ù‹
        if (!this.adminManager.isDeveloper()) {
            localStorage.removeItem('currentUser');
        }

        showTempMessage(`âœ… ØªÙ… Ø·Ø±Ø¯ ${kickedCount} Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        
        if (!this.adminManager.isDeveloper()) {
            setTimeout(() => location.reload(), 2000);
        } else {
            // Ø§Ù„Ù…Ø·ÙˆØ± ÙŠØ¨Ù‚Ù‰ Ù…ØªØµÙ„Ø§Ù‹
            setTimeout(() => this.showUserManagement(), 1000);
        }
    }
}

// ===== Ù†Ø¸Ø§Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù† =====
class AdminPanelManager {
    constructor(adminManager) {
        this.adminManager = adminManager;
        this.isVisible = false;
        this.panel = null;
        this.toggleBtn = null;
        this.init();
    }

    init() {
        this.createPanel();
        this.createToggleButton();
        this.loadState();
        
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø­Ø¯Ø« Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', (event) => {
            this.handleClickOutside(event);
        });
    }

    createPanel() {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        const oldPanel = document.getElementById('adminControlPanel');
        if (oldPanel) {
            oldPanel.remove();
        }

        this.panel = document.createElement('div');
        this.panel.id = 'adminControlPanel';
        this.panel.className = 'admin-control-panel hidden';
        
        this.updatePanelContent();
        document.body.appendChild(this.panel);
    }

    createToggleButton() {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        const oldBtn = document.getElementById('adminToggleBtn');
        if (oldBtn) {
            oldBtn.remove();
        }

        this.toggleBtn = document.createElement('button');
        this.toggleBtn.id = 'adminToggleBtn';
        this.toggleBtn.className = 'admin-toggle-btn';
        this.toggleBtn.innerHTML = 'ğŸ‘‘';
        this.toggleBtn.title = 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†';

        this.toggleBtn.addEventListener('click', (event) => {
            event.stopPropagation();
            this.togglePanel();
        });

        document.body.appendChild(this.toggleBtn);
    }

    updatePanelContent() {
        if (!this.panel) return;

        const userRole = this.adminManager.isDeveloper() ? 'ğŸ‘‘ Ø§Ù„Ù…Ø·ÙˆØ±' : 'ğŸ”§ Ø§Ù„Ù…Ø´Ø±Ù';
        const showAddAdminButton = this.adminManager.isAdmin();
        
        this.panel.innerHTML = `
            <div class="admin-control-header">
                <div class="admin-control-title">${userRole}</div>
            </div>
            <div class="admin-control-buttons">
                <button onclick="adminManager.clearAllData()" class="admin-control-btn">
                    ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button onclick="adminManager.exportAllData()" class="admin-control-btn">
                    ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button onclick="adminManager.showUserStats()" class="admin-control-btn">
                    ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </button>
                <button onclick="userManagement.showUserManagement()" class="admin-control-btn">
                    ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </button>
                ${this.adminManager.isDeveloper() ? `
                <button onclick="adminManager.manageAllCompanies()" class="admin-control-btn">
                    ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙƒØ§Øª
                </button>
                ` : ''}
                ${showAddAdminButton ? `
                <button onclick="adminManager.addAdminUser()" class="admin-control-btn">
                    â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯
                </button>
                ` : ''}
                <button onclick="adminPanelManager.hidePanel()" class="admin-control-btn">
                    âŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø©
                </button>
            </div>
            <div class="admin-control-footer">
                Ø£Ù†Øª: ${this.adminManager.userManager.currentUser.name}
            </div>
        `;
    }

    handleClickOutside(event) {
        if (this.isVisible && 
            this.panel && !this.panel.contains(event.target) && 
            this.toggleBtn && !this.toggleBtn.contains(event.target)) {
            this.hidePanel();
        }
    }

    togglePanel() {
        if (this.isVisible) {
            this.hidePanel();
        } else {
            this.showPanel();
        }
    }

    showPanel() {
        if (this.panel) {
            this.panel.classList.remove('hidden');
            this.toggleBtn.classList.add('active');
            this.isVisible = true;
            this.saveState();
        }
    }

    hidePanel() {
        if (this.panel) {
            this.panel.classList.add('hidden');
            this.toggleBtn.classList.remove('active');
            this.isVisible = false;
            this.saveState();
        }
    }

    saveState() {
        localStorage.setItem('adminPanelVisible', this.isVisible.toString());
    }

    loadState() {
        const savedState = localStorage.getItem('adminPanelVisible');
        if (savedState === 'true') {
            this.showPanel();
        } else {
            this.hidePanel();
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    refresh() {
        this.updatePanelContent();
    }
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø³Ù† Ù…Ø¹ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± =====
class AdminManager {
    constructor(userManager) {
        this.userManager = userManager;
        this.adminUsers = this.getAdminUsers();
        this.developerUsers = this.getDeveloperUsers();
        this.init();
    }

    init() {
        setTimeout(() => {
            this.checkAndShowAdminPanel();
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø´Ø±ÙØ§Ù‹ØŒ Ù†Ù‚ÙˆÙ… Ø¨ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù†Ø©
            if (this.isAdmin() && !window.adminPanelManager) {
                window.adminPanelManager = new AdminPanelManager(this);
            }
        }, 1000);
    }

    getAdminUsers() {
        const defaultAdmins = [
            'admin_fahd_2024',
            'user_backup_admin'
        ];
        
        const savedAdmins = JSON.parse(localStorage.getItem('billet_admin_users') || '[]');
        return [...new Set([...defaultAdmins, ...savedAdmins])];
    }

    getDeveloperUsers() {
        const defaultDevelopers = [
            'developer_fahd',
            'admin_fahd_2024',
            'user_backup_admin'
        ];
        
        const savedDevelopers = JSON.parse(localStorage.getItem('billet_developer_users') || '[]');
        return [...new Set([...defaultDevelopers, ...savedDevelopers])];
    }

    isAdmin() {
        if (!this.userManager.currentUser) return false;
        return this.adminUsers.includes(this.userManager.currentUser.id) || 
               this.developerUsers.includes(this.userManager.currentUser.id);
    }

    isDeveloper() {
        if (!this.userManager.currentUser) return false;
        return this.developerUsers.includes(this.userManager.currentUser.id);
    }

    checkAndShowAdminPanel() {
        // ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠÙŠÙ†ØŒ ÙˆÙ„ÙŠØ³ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠÙ†
        if (this.isDeveloper()) {
            this.showAdminPanel();
        }
    }

    showAdminPanel() {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
        if (window.adminPanelManager) {
            window.adminPanelManager.showPanel();
        } else {
            // Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙƒØ§Ø­ØªÙŠØ§Ø·ÙŠ
            this.createLegacyPanel();
        }
    }

    createLegacyPanel() {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        const oldPanel = document.getElementById('adminControlPanel');
        if (oldPanel) {
            oldPanel.remove();
        }

        const adminPanel = document.createElement('div');
        adminPanel.id = 'adminControlPanel';
        adminPanel.style.cssText = `
            position: fixed;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            background: linear-gradient(135deg, ${this.isDeveloper() ? '#8e44ad, #9b59b6' : '#e74c3c, #c0392b'});
            color: white;
            padding: 10px;
            border-radius: 10px;
            z-index: 10000;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            border: 2px solid #fff;
            min-width: 200px;
            max-width: 300px;
        `;

        const userRole = this.isDeveloper() ? 'ğŸ‘‘ Ø§Ù„Ù…Ø·ÙˆØ±' : 'ğŸ”§ Ø§Ù„Ù…Ø´Ø±Ù';
        const showAddAdminButton = this.isAdmin();
        
        adminPanel.innerHTML = `
            <div style="text-align: center; margin-bottom: 10px;">
                <strong>${userRole}</strong>
            </div>
            <div style="display: flex; flex-direction: column; gap: 6px;">
                <button onclick="adminManager.clearAllData()" style="background: #c0392b; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                    ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button onclick="adminManager.exportAllData()" style="background: #27ae60; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                    ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <button onclick="adminManager.showUserStats()" style="background: #3498db; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                    ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </button>
                <button onclick="userManagement.showUserManagement()" style="background: #9b59b6; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                    ğŸ‘¤ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                </button>
                ${this.isDeveloper() ? `
                <button onclick="adminManager.manageAllCompanies()" style="background: #9b59b6; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                    ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙƒØ§Øª
                </button>
                ` : ''}
                ${showAddAdminButton ? `
                <button onclick="adminManager.addAdminUser()" style="background: #e67e22; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                    â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯
                </button>
                ` : ''}
                <button onclick="adminManager.toggleAdminPanel()" style="background: #7f8c8d; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                    âŒ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø©
                </button>
            </div>
            <div style="margin-top: 10px; font-size: 10px; text-align: center; opacity: 0.8;">
                Ø£Ù†Øª: ${this.userManager.currentUser.name}
            </div>
        `;

        document.body.appendChild(adminPanel);
    }

    toggleAdminPanel() {
        if (window.adminPanelManager) {
            window.adminPanelManager.togglePanel();
        } else {
            const panel = document.getElementById('adminControlPanel');
            if (panel) {
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            }
        }
    }

    clearAllData() {
        if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
            localStorage.clear();
            alert('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            setTimeout(() => {
                location.reload();
            }, 1000);
        }
    }

    exportAllData() {
        try {
            const allData = {
                users: JSON.parse(localStorage.getItem('users') || '{}'),
                companies: JSON.parse(localStorage.getItem('companies') || '{}'),
                moldDatabase: companyManager.getCompanyMoldDatabase(),
                appState: JSON.parse(localStorage.getItem('billetCalculatorState') || '{}'),
                adminUsers: this.adminUsers,
                developerUsers: this.developerUsers,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `billet_app_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);

            alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        } catch (error) {
            alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
        }
    }

    showUserStats() {
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        const companies = JSON.parse(localStorage.getItem('companies') || '{}');
        const moldDatabase = companyManager.getCompanyMoldDatabase();

        const stats = {
            totalUsers: Object.keys(users).length,
            activeUsers: Object.values(users).filter(u => u.isLoggedIn).length,
            totalCompanies: Object.keys(companies).length,
            totalMolds: Object.keys(moldDatabase).length,
            adminUsers: this.adminUsers.length,
            developerUsers: this.developerUsers.length,
            lastExport: new Date().toLocaleString('ar-EG')
        };

        alert(`ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:

ğŸ‘¥ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${stats.totalUsers}
ğŸŸ¢ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†: ${stats.activeUsers}
ğŸ¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø±ÙƒØ§Øª: ${stats.totalCompanies}
ğŸ“‹ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©: ${stats.totalMolds}
ğŸ”§ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†: ${stats.adminUsers}
ğŸ‘‘ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ†: ${stats.developerUsers}
ğŸ•’ Ø¢Ø®Ø± ØªØµØ¯ÙŠØ±: ${stats.lastExport}

ğŸ’¾ Ø­Ø¬Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${this.getStorageSize()} KB`);
    }

    getStorageSize() {
        let totalSize = 0;
        for (let key in localStorage) {
            if (localStorage.hasOwnProperty(key)) {
                totalSize += localStorage[key].length;
            }
        }
        return (totalSize / 1024).toFixed(2);
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø·ÙˆØ±
    manageAllCompanies() {
        if (!this.isDeveloper()) {
            showTempMessage('âŒ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†', 'error');
            return;
        }

        const companies = JSON.parse(localStorage.getItem('companies') || '{}');
        let companiesHtml = '<div style="max-height: 300px; overflow-y: auto;">';
        
        Object.keys(companies).forEach(companyId => {
            const company = companies[companyId];
            const userCount = company.users ? Object.keys(company.users).length : 0;
            
            companiesHtml += `
                <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 5px;">
                    <strong>${company.name}</strong><br>
                    <small>Ø§Ù„Ø±Ù…Ø²: ${company.code} | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${userCount}</small><br>
                    <small>Ø£Ù†Ø´Ø£Ù‡Ø§: ${company.createdBy}</small>
                </div>
            `;
        });
        
        companiesHtml += '</div>';

        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙƒØ§Øª (ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±)';
        modalContent.innerHTML = companiesHtml;
        
        modal.style.display = 'flex';
    }

    addAdminUser() {
        if (!this.isDeveloper()) {
            showTempMessage('âŒ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø·ÙˆØ±ÙŠÙ†', 'error');
            return;
        }

        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯';
        modalContent.innerHTML = `
            <div class="form-group">
                <label for="newAdminEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                <input type="email" id="newAdminEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="english-numbers" />
            </div>
            <div class="small">Ø³ÙŠØªÙ… Ù…Ù†Ø­ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±Ù</div>
        `;
        
        modal.style.display = 'flex';
    }
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± =====
class PasswordRecovery {
    constructor(userManager) {
        this.userManager = userManager;
        this.recoveryCodes = new Map(); // ÙƒÙˆØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ø¤Ù‚Øª
    }

    // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø©
    generateRecoveryCode(email) {
        const code = Math.random().toString(36).substr(2, 8).toUpperCase();
        const expires = Date.now() + 30 * 60 * 1000; // 30 Ø¯Ù‚ÙŠÙ‚Ø©
        
        this.recoveryCodes.set(email, { code, expires });
        
        // ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‡Ù†Ø§ Ù†Ø±Ø³Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„
        // Ù„ÙƒÙ† Ø­Ø§Ù„ÙŠØ§Ù‹ Ù†Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        return code;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
    verifyRecoveryCode(email, code) {
        const recoveryData = this.recoveryCodes.get(email);
        
        if (!recoveryData) {
            return { success: false, message: 'âŒ Ù„Ù… ÙŠØªÙ… Ø·Ù„Ø¨ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯' };
        }
        
        if (Date.now() > recoveryData.expires) {
            this.recoveryCodes.delete(email);
            return { success: false, message: 'âŒ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØ© ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©' };
        }
        
        if (recoveryData.code !== code.toUpperCase()) {
            return { success: false, message: 'âŒ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© ØºÙŠØ± ØµØ­ÙŠØ­' };
        }
        
        this.recoveryCodes.delete(email);
        return { success: true };
    }

    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    resetPassword(email, code, newPassword) {
        const verification = this.verifyRecoveryCode(email, code);
        if (!verification.success) return verification;

        const users = JSON.parse(localStorage.getItem('users') || '{}');
        const user = users[email];
        
        if (!user) {
            return { success: false, message: 'âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯' };
        }

        user.password = btoa(newPassword);
        users[email] = user;
        localStorage.setItem('users', JSON.stringify(users));

        return { success: true, message: 'âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­' };
    }

    // Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ù‡Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    showRecoveryModal() {
        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'ğŸ” Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
        modalContent.innerHTML = `
            <div id="recoveryStep1">
                <div class="form-group">
                    <label for="recoveryEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                    <input type="email" id="recoveryEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="english-numbers" />
                </div>
                <div class="small">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙˆØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
            </div>
            <div id="recoveryStep2" style="display: none;">
                <div class="form-group">
                    <label for="recoveryCode">ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©:</label>
                    <input type="text" id="recoveryCode" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø±Ø³Ù„ Ø¥Ù„ÙŠÙƒ" class="english-numbers" style="text-align: center; letter-spacing: 2px; font-weight: bold;" />
                </div>
                <div class="form-group">
                    <label for="newPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                    <input type="password" id="newPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" class="english-numbers" />
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                    <input type="password" id="confirmNewPassword" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©" class="english-numbers" />
                </div>
            </div>
            <div id="recoveryCodeDisplay" style="display: none; background: #e8f5e8; padding: 10px; border-radius: 5px; text-align: center; margin: 10px 0;">
                <strong>ğŸ”‘ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©:</strong>
                <div id="displayedCode" style="font-size: 24px; font-weight: bold; color: #27ae60; margin: 10px 0;"></div>
                <small>Ù‡Ø°Ø§ ÙƒÙˆØ¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠ - ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ</small>
            </div>
        `;
        
        modal.style.display = 'flex';
        document.getElementById('recoveryEmail').focus();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('modalConfirm').onclick = () => this.handleRecoveryConfirm();
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
    handleRecoveryConfirm() {
        const step1 = document.getElementById('recoveryStep1');
        const step2 = document.getElementById('recoveryStep2');
        const codeDisplay = document.getElementById('recoveryCodeDisplay');
        
        if (step1.style.display !== 'none') {
            // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø·Ù„Ø¨ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
            const email = document.getElementById('recoveryEmail').value.trim();
            
            if (!email) {
                showTempMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (!users[email]) {
                showTempMessage('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'error');
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
            const recoveryCode = this.generateRecoveryCode(email);
            
            // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯ (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„)
            document.getElementById('displayedCode').textContent = recoveryCode;
            step1.style.display = 'none';
            step2.style.display = 'block';
            codeDisplay.style.display = 'block';
            
            document.getElementById('recoveryCode').focus();
            
        } else {
            // Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            const email = document.getElementById('recoveryEmail').value.trim();
            const code = document.getElementById('recoveryCode').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            
            if (!code || !newPassword || !confirmPassword) {
                showTempMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showTempMessage('âš ï¸ ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showTempMessage('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            const result = this.resetPassword(email, code, newPassword);
            if (result.success) {
                showTempMessage(result.message, 'success');
                document.getElementById('companyModal').style.display = 'none';
            } else {
                showTempMessage(result.message, 'error');
            }
        }
    }
}

// ===== Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù† =====
class UserManager {
    constructor() {
        this.currentUser = this.getCurrentUser();
        this.init();
    }

    init() {
        this.updateUserDisplay();
        this.setupEventListeners();
        
        // Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„Ù…Ø·ÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        if (this.currentUser.name.includes('ÙÙ‡Ø¯') || this.currentUser.email.includes('fahd')) {
            this.grantDeveloperAccess();
        }
    }

    grantDeveloperAccess() {
        const developerUsers = JSON.parse(localStorage.getItem('billet_developer_users') || '[]');
        if (!developerUsers.includes(this.currentUser.id)) {
            developerUsers.push(this.currentUser.id);
            localStorage.setItem('billet_developer_users', JSON.stringify(developerUsers));
            console.log('âœ… ØªÙ… Ù…Ù†Ø­ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ');
        }
    }

    generateUserId() {
        return 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
    }

    getCurrentUser() {
        let user = localStorage.getItem('currentUser');
        if (!user) {
            user = {
                id: this.generateUserId(),
                name: 'Ø²Ø§Ø¦Ø±',
                email: '',
                role: 'guest',
                isLoggedIn: false,
                joinDate: new Date().toISOString()
            };
            localStorage.setItem('currentUser', JSON.stringify(user));
        } else {
            user = JSON.parse(user);
        }
        return user;
    }

    updateUserDisplay() {
        const userInfo = document.getElementById('currentUserInfo');
        
        if (this.currentUser.isLoggedIn) {
            const adminManager = new AdminManager(this);
            const roleBadge = adminManager.isDeveloper() ? ' ğŸ‘‘' : adminManager.isAdmin() ? ' ğŸ”§' : '';
            
            userInfo.innerHTML = `
                <strong>ğŸ‘¤ ${this.currentUser.name}${roleBadge}</strong><br>
                <small>${this.currentUser.email}</small><br>
                <small>Ù…Ø³Ø¬Ù„ Ù…Ù†Ø°: ${new Date(this.currentUser.joinDate).toLocaleDateString('ar-EG')}</small>
            `;
        } else {
            userInfo.innerHTML = `
                <strong>ğŸ‘¤ Ø²Ø§Ø¦Ø±</strong><br>
                <small>Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</small>
            `;
        }
    }

    registerUser(name, email, password) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        if (localStorage.getItem('disableNewUsers') === 'true') {
            return { success: false, message: 'âŒ ØªÙ… ØªØ¹Ø·ÙŠÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ Ù…Ø¤Ù‚ØªØ§Ù‹' };
        }

        const users = JSON.parse(localStorage.getItem('users') || '{}');
        
        if (users[email]) {
            return { success: false, message: 'âŒ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹' };
        }

        const newUser = {
            id: this.generateUserId(),
            name: name,
            email: email,
            password: btoa(password),
            role: 'user',
            isLoggedIn: true,
            joinDate: new Date().toISOString(),
            lastLogin: new Date().toISOString()
        };

        users[email] = newUser;
        localStorage.setItem('users', JSON.stringify(users));

        this.currentUser = newUser;
        localStorage.setItem('currentUser', JSON.stringify(newUser));

        this.updateUserDisplay();
        
        return { success: true, user: newUser };
    }

    loginUser(email, password) {
        const users = JSON.parse(localStorage.getItem('users') || '{}');
        const user = users[email];
        
        if (!user) {
            return { success: false, message: 'âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©' };
        }

        if (user.password !== btoa(password)) {
            return { success: false, message: 'âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©' };
        }

        user.isLoggedIn = true;
        user.lastLogin = new Date().toISOString();
        users[email] = user;
        localStorage.setItem('users', JSON.stringify(users));

        this.currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(user));

        this.updateUserDisplay();
        
        return { success: true, user: user };
    }

    logoutUser() {
        if (this.currentUser.isLoggedIn) {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const user = users[this.currentUser.email];
            
            if (user) {
                user.isLoggedIn = false;
                users[this.currentUser.email] = user;
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        this.currentUser = {
            id: this.generateUserId(),
            name: 'Ø²Ø§Ø¦Ø±',
            email: '',
            role: 'guest',
            isLoggedIn: false,
            joinDate: new Date().toISOString()
        };
        localStorage.setItem('currentUser', JSON.stringify(this.currentUser));

        this.updateUserDisplay();
        
        return { success: true };
    }

    updateProfile(name, email) {
        if (!this.currentUser.isLoggedIn) {
            return { success: false, message: 'âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹' };
        }

        const users = JSON.parse(localStorage.getItem('users') || '{}');
        const oldUser = users[this.currentUser.email];
        
        if (!oldUser) {
            return { success: false, message: 'âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯' };
        }

        if (email !== this.currentUser.email && users[email]) {
            return { success: false, message: 'âŒ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹' };
        }

        oldUser.name = name;
        oldUser.email = email;
        
        if (email !== this.currentUser.email) {
            delete users[this.currentUser.email];
            users[email] = oldUser;
        }

        localStorage.setItem('users', JSON.stringify(users));

        this.currentUser.name = name;
        this.currentUser.email = email;
        localStorage.setItem('currentUser', JSON.stringify(this.currentUser));

        this.updateUserDisplay();
        
        return { success: true, user: this.currentUser };
    }

    setupEventListeners() {
        document.getElementById('registerBtn').addEventListener('click', () => this.showRegisterModal());
        document.getElementById('loginBtn').addEventListener('click', () => this.showLoginModal());
        document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
        document.getElementById('profileBtn').addEventListener('click', () => this.showProfileModal());
        document.getElementById('recoveryBtn').addEventListener('click', () => passwordRecovery.showRecoveryModal());
    }

    showRegisterModal() {
        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
        modalContent.innerHTML = `
            <div class="form-group">
                <label for="registerName">Ø§Ù„Ø§Ø³Ù…:</label>
                <input type="text" id="registerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" class="english-numbers" />
            </div>
            <div class="form-group">
                <label for="registerEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                <input type="email" id="registerEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="english-numbers" />
            </div>
            <div class="form-group">
                <label for="registerPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                <input type="password" id="registerPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="english-numbers" />
            </div>
            <div class="form-group">
                <label for="registerConfirmPassword">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                <input type="password" id="registerConfirmPassword" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="english-numbers" />
            </div>
            <div class="small">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ Ù„Ùƒ</div>
        `;
        
        modal.style.display = 'flex';
        document.getElementById('registerName').focus();
    }

    showLoginModal() {
        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
        modalContent.innerHTML = `
            <div class="form-group">
                <label for="loginEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                <input type="email" id="loginEmail" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="english-numbers" />
            </div>
            <div class="form-group">
                <label for="loginPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                <input type="password" id="loginPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="english-numbers" />
            </div>
            <div class="small">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹</div>
        `;
        
        modal.style.display = 'flex';
        document.getElementById('loginEmail').focus();
    }

    showProfileModal() {
        if (!this.currentUser.isLoggedIn) {
            showTempMessage('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            return;
        }

        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ';
        modalContent.innerHTML = `
            <div class="form-group">
                <label for="profileName">Ø§Ù„Ø§Ø³Ù…:</label>
                <input type="text" id="profileName" value="${this.currentUser.name}" class="english-numbers" />
            </div>
            <div class="form-group">
                <label for="profileEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                <input type="email" id="profileEmail" value="${this.currentUser.email}" class="english-numbers" />
            </div>
            <div class="small">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ© Ù‡Ù†Ø§</div>
        `;
        
        modal.style.display = 'flex';
        document.getElementById('profileName').focus();
    }

    logout() {
        if (!this.currentUser.isLoggedIn) {
            showTempMessage('âŒ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            return;
        }

        const result = this.logoutUser();
        if (result.success) {
            showTempMessage('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
    }

    handleModalConfirm() {
        const modalTitle = document.getElementById('modalTitle').textContent;
        
        if (modalTitle.includes('ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯')) {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (!name || !email || !password) {
                showTempMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showTempMessage('âš ï¸ ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†', 'error');
                return;
            }
            
            if (password.length < 6) {
                showTempMessage('âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            const result = this.registerUser(name, email, password);
            if (result.success) {
                showTempMessage(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ - Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}`, 'success');
                this.closeModal();
            } else {
                showTempMessage(result.message, 'error');
            }
            
        } else if (modalTitle.includes('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„')) {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showTempMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            const result = this.loginUser(email, password);
            if (result.success) {
                showTempMessage(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ - Ù…Ø±Ø­Ø¨Ø§Ù‹ ${result.user.name}`, 'success');
                this.closeModal();
            } else {
                showTempMessage(result.message, 'error');
            }
            
        } else if (modalTitle.includes('Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ')) {
            const name = document.getElementById('profileName').value.trim();
            const email = document.getElementById('profileEmail').value.trim();
            
            if (!name || !email) {
                showTempMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            const result = this.updateProfile(name, email);
            if (result.success) {
                showTempMessage('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                this.closeModal();
            } else {
                showTempMessage(result.message, 'error');
            }
        } else {
            this.closeModal();
        }
    }

    closeModal() {
        document.getElementById('companyModal').style.display = 'none';
    }

    getUserMoldDatabase() {
        if (!this.currentUser.isLoggedIn) {
            return JSON.parse(localStorage.getItem('moldDatabase') || '{}');
        }
        
        const userMoldDatabase = JSON.parse(localStorage.getItem(`moldDatabase_${this.currentUser.id}`) || '{}');
        return userMoldDatabase;
    }

    saveUserMoldDatabase(database) {
        if (!this.currentUser.isLoggedIn) {
            localStorage.setItem('moldDatabase', JSON.stringify(database));
        } else {
            localStorage.setItem(`moldDatabase_${this.currentUser.id}`, JSON.stringify(database));
        }
    }
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù† Ù…Ø¹ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± =====
class CompanyManager {
    constructor(userManager) {
        this.userManager = userManager;
        this.currentCompany = this.getCurrentCompany();
        this.init();
    }

    init() {
        this.updateCompanyDisplay();
        this.setupEventListeners();
    }

    generateCompanyCode() {
        return 'COMP_' + Math.random().toString(36).substr(2, 6).toUpperCase();
    }

    getCurrentCompany() {
        if (!this.userManager.currentUser.isLoggedIn) return null;
        
        const companies = JSON.parse(localStorage.getItem('companies') || '{}');
        return companies[this.userManager.currentUser.id] || null;
    }

    updateCompanyDisplay() {
        const companyInfo = document.getElementById('currentCompanyInfo');
        
        if (this.currentCompany) {
            const userCount = this.currentCompany.users ? Object.keys(this.currentCompany.users).length : 1;
            const adminManager = new AdminManager(this.userManager);
            let userRole = this.userManager.currentUser.role;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø·ÙˆØ±ØŒ Ø§Ø¬Ø¹Ù„Ù‡ Ù…Ø¯ÙŠØ±Ø§Ù‹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            if (adminManager.isDeveloper()) {
                userRole = 'admin';
            }
            
            userRole = userRole === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…';
            
            companyInfo.innerHTML = `
                <strong>ğŸ¢ ${this.currentCompany.name}</strong><br>
                <small>Ø±Ù…Ø² Ø§Ù„Ø´Ø±ÙƒØ©: ${this.currentCompany.code}</small><br>
                <small>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: ${userCount} | Ø¯ÙˆØ±Ùƒ: ${userRole}</small>
            `;
        } else {
            companyInfo.innerHTML = `
                <strong>âš ï¸ Ù„Ù… ØªÙ†Ø¶Ù… Ù„Ø£ÙŠ Ø´Ø±ÙƒØ© Ø¨Ø¹Ø¯</strong><br>
                <small>Ø£Ù†Ø´Ø¦ Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© Ø£Ùˆ Ø§Ù†Ø¶Ù… Ù„Ø´Ø±ÙƒØ© Ù…ÙˆØ¬ÙˆØ¯Ø©</small>
            `;
        }
    }

    createCompany(companyName) {
        if (!this.userManager.currentUser.isLoggedIn) {
            return { success: false, message: 'âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹' };
        }

        const companyCode = this.generateCompanyCode();
        const companyId = 'company_' + Date.now();
        
        const adminManager = new AdminManager(this.userManager);
        
        // Ø§Ù„ØªØµØ­ÙŠØ­: ÙÙ‚Ø· Ø§Ù„Ù…Ø·ÙˆØ±ÙˆÙ† ÙŠØµØ¨Ø­ÙˆÙ† Ù…Ø¯Ø±Ø§Ø¡ØŒ Ø§Ù„Ø¨Ø§Ù‚ÙˆÙ† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ø§Ø¯ÙŠÙŠÙ†
        const userRole = adminManager.isDeveloper() ? 'admin' : 'user';
        
        const newCompany = {
            id: companyId,
            name: companyName,
            code: companyCode,
            createdBy: this.userManager.currentUser.id,
            createdAt: new Date().toISOString(),
            users: {
                [this.userManager.currentUser.id]: {
                    id: this.userManager.currentUser.id,
                    name: this.userManager.currentUser.name,
                    email: this.userManager.currentUser.email,
                    role: userRole, // Ù‡Ù†Ø§ Ø§Ù„ØªØµØ­ÙŠØ­
                    joinDate: new Date().toISOString()
                }
            }
        };

        const companies = JSON.parse(localStorage.getItem('companies') || '{}');
        companies[companyId] = newCompany;
        localStorage.setItem('companies', JSON.stringify(companies));

        this.userManager.currentUser.companyId = companyId;
        this.userManager.currentUser.role = userRole;
        localStorage.setItem('currentUser', JSON.stringify(this.userManager.currentUser));

        this.currentCompany = newCompany;
        this.updateCompanyDisplay();
        
        return { success: true, company: newCompany };
    }

    joinCompany(companyCode) {
        if (!this.userManager.currentUser.isLoggedIn) {
            return { success: false, message: 'âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹' };
        }

        const companies = JSON.parse(localStorage.getItem('companies') || '{}');
        
        let targetCompany = null;
        let companyId = null;
        
        for (const id in companies) {
            if (companies[id].code === companyCode) {
                targetCompany = companies[id];
                companyId = id;
                break;
            }
        }

        if (!targetCompany) {
            return { success: false, message: 'âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´Ø±ÙƒØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…' };
        }

        const adminManager = new AdminManager(this.userManager);
        
        // Ø§Ù„ØªØµØ­ÙŠØ­: Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… ÙƒÙ€ user Ø¹Ø§Ø¯ÙŠ Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø·ÙˆØ±
        const userRole = adminManager.isDeveloper() ? 'admin' : 'user';

        targetCompany.users[this.userManager.currentUser.id] = {
            id: this.userManager.currentUser.id,
            name: this.userManager.currentUser.name,
            email: this.userManager.currentUser.email,
            role: userRole, // Ù‡Ù†Ø§ Ø§Ù„ØªØµØ­ÙŠØ­
            joinDate: new Date().toISOString()
        };

        companies[companyId] = targetCompany;
        localStorage.setItem('companies', JSON.stringify(companies));

        this.userManager.currentUser.companyId = companyId;
        this.userManager.currentUser.role = userRole;
        localStorage.setItem('currentUser', JSON.stringify(this.userManager.currentUser));

        this.currentCompany = targetCompany;
        this.updateCompanyDisplay();
        
        return { success: true, company: targetCompany };
    }

    switchCompany() {
        if (!this.userManager.currentUser.isLoggedIn) {
            showTempMessage('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            return;
        }

        if (this.currentCompany) {
            this.leaveCompany();
        }
        
        this.currentCompany = null;
        this.userManager.currentUser.companyId = null;
        localStorage.setItem('currentUser', JSON.stringify(this.userManager.currentUser));
        this.updateCompanyDisplay();
        
        showTempMessage('âœ… ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©', 'success');
    }

    leaveCompany() {
        if (!this.currentCompany) return;

        const companies = JSON.parse(localStorage.getItem('companies') || '{}');
        
        if (companies[this.currentCompany.id] && companies[this.currentCompany.id].users) {
            delete companies[this.currentCompany.id].users[this.userManager.currentUser.id];
            
            if (Object.keys(companies[this.currentCompany.id].users).length === 0) {
                delete companies[this.currentCompany.id];
            }
            
            localStorage.setItem('companies', JSON.stringify(companies));
        }
    }

    manageUsers() {
        const adminManager = new AdminManager(this.userManager);
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª - Ø§Ù„Ù…Ø·ÙˆØ± Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ±
        if (!this.currentCompany && !adminManager.isDeveloper()) {
            showTempMessage('âŒ Ù„Ù… ØªÙ†Ø¶Ù… Ù„Ø£ÙŠ Ø´Ø±ÙƒØ© Ø¨Ø¹Ø¯', 'error');
            return;
        }
        
        if (!adminManager.isDeveloper() && this.userManager.currentUser.role !== 'admin') {
            showTempMessage('âŒ ØªØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø¯ÙŠØ± Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ©', 'error');
            return;
        }

        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ø´Ø±ÙƒØ©';
        
        let usersHtml = '<div class="company-users-list">';
        
        const usersToShow = adminManager.isDeveloper() ? 
            this.getAllUsers() : 
            this.currentCompany.users;
        
        for (const userId in usersToShow) {
            const user = usersToShow[userId];
            const roleClass = user.role === 'admin' ? 'admin' : '';
            const roleText = user.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…';
            
            usersHtml += `
                <div class="company-user-item">
                    <div>
                        <strong>${user.name}</strong>
                        <span class="user-role ${roleClass}">${roleText}</span>
                    </div>
                    <small>${new Date(user.joinDate).toLocaleDateString('ar-EG')}</small>
                </div>
            `;
        }
        
        usersHtml += '</div>';
        modalContent.innerHTML = usersHtml;
        
        modal.style.display = 'flex';
    }

    getAllUsers() {
        const companies = JSON.parse(localStorage.getItem('companies') || '{}');
        let allUsers = {};
        
        Object.values(companies).forEach(company => {
            if (company.users) {
                Object.assign(allUsers, company.users);
            }
        });
        
        return allUsers;
    }

    setupEventListeners() {
        document.getElementById('createCompanyBtn').addEventListener('click', () => this.showCreateCompanyModal());
        document.getElementById('joinCompanyBtn').addEventListener('click', () => this.showJoinCompanyModal());
        document.getElementById('switchCompanyBtn').addEventListener('click', () => this.switchCompany());
        document.getElementById('manageUsersBtn').addEventListener('click', () => this.manageUsers());
    }

    showCreateCompanyModal() {
        if (!this.userManager.currentUser.isLoggedIn) {
            showTempMessage('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            return;
        }

        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'ğŸ¢ Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©';
        modalContent.innerHTML = `
            <div class="form-group">
                <label for="newCompanyName">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©:</label>
                <input type="text" id="newCompanyName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©" class="english-numbers" />
            </div>
            <div class="small">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ³ØªÙƒÙˆÙ† Ø£Ù†Øª Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙŠÙ‡Ø§</div>
        `;
        
        modal.style.display = 'flex';
        document.getElementById('newCompanyName').focus();
    }

    showJoinCompanyModal() {
        if (!this.userManager.currentUser.isLoggedIn) {
            showTempMessage('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
            return;
        }

        const modal = document.getElementById('companyModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');
        
        modalTitle.textContent = 'â• Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ù…ÙˆØ¬ÙˆØ¯Ø©';
        modalContent.innerHTML = `
            <div class="form-group">
                <label for="companyCode">Ø±Ù…Ø² Ø§Ù„Ø´Ø±ÙƒØ©:</label>
                <input type="text" id="companyCode" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø´Ø±ÙƒØ©" class="english-numbers" />
            </div>
            <div class="small">Ø§Ø·Ù„Ø¨ Ø±Ù…Ø² Ø§Ù„Ø´Ø±ÙƒØ© Ù…Ù† Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</div>
        `;
        
        modal.style.display = 'flex';
        document.getElementById('companyCode').focus();
    }

    handleModalConfirm() {
        const modalTitle = document.getElementById('modalTitle').textContent;
        
        if (modalTitle.includes('Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©')) {
            const companyName = document.getElementById('newCompanyName').value.trim();
            if (!companyName) {
                showTempMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©', 'error');
                return;
            }
            
            const result = this.createCompany(companyName);
            if (result.success) {
                showTempMessage(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø±ÙƒØ© "${companyName}" - Ø§Ù„Ø±Ù…Ø²: ${result.company.code}`, 'success');
                this.closeModal();
            } else {
                showTempMessage(result.message, 'error');
            }
            
        } else if (modalTitle.includes('Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø´Ø±ÙƒØ© Ù…ÙˆØ¬ÙˆØ¯Ø©')) {
            const companyCode = document.getElementById('companyCode').value.trim().toUpperCase();
            if (!companyCode) {
                showTempMessage('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø´Ø±ÙƒØ©', 'error');
                return;
            }
            
            const result = this.joinCompany(companyCode);
            if (result.success) {
                showTempMessage(`âœ… ØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ø´Ø±ÙƒØ© "${result.company.name}"`, 'success');
                this.closeModal();
            } else {
                showTempMessage(result.message, 'error');
            }
        } else {
            this.closeModal();
        }
    }

    closeModal() {
        document.getElementById('companyModal').style.display = 'none';
    }

    getCompanyMoldDatabase() {
        if (!this.currentCompany) {
            return this.userManager.getUserMoldDatabase();
        }
        
        const companyMoldDatabase = JSON.parse(localStorage.getItem(`moldDatabase_${this.currentCompany.id}`) || '{}');
        return companyMoldDatabase;
    }

    saveCompanyMoldDatabase(database) {
        if (!this.currentCompany) {
            this.userManager.saveUserMoldDatabase(database);
        } else {
            localStorage.setItem(`moldDatabase_${this.currentCompany.id}`, JSON.stringify(database));
        }
    }
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙØ§Ø¦Ù‚ Ø§Ù„Ù…Ø­Ø³Ù† Ù…Ø¹ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© =====
class SuperAdmin {
    constructor() {
        this.isAuthenticated = false;
        this.authTimeout = null;
        this.init();
    }

    init() {
        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙØ§Ø¦Ù‚
        document.getElementById('superAdminBtn').addEventListener('click', () => this.togglePanel());
    }

    authenticate() {
        const password = document.getElementById('superAdminPassword').value;
        // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ÙØ§Ø¦Ù‚Ø© - ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡Ø§
        if (password === '12319900') {
            this.isAuthenticated = true;
            document.getElementById('superAdminPanel').style.display = 'block';
            document.getElementById('superAdminPassword').value = '';
            
            // ØªÙØ¹ÙŠÙ„ Ù…Ù‡Ù„Ø© Ù„Ù„Ù…ØµØ§Ø¯Ù‚Ø© (30 Ø¯Ù‚ÙŠÙ‚Ø©)
            this.resetAuthTimeout();
            
            console.log('âœ… ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„ ÙØ§Ø¦Ù‚');
            showTempMessage('âœ… ØªÙ… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­ - ØµÙ„Ø§Ø­ÙŠØ§ØªÙƒ Ù†Ø´Ø·Ø© Ù„Ù…Ø¯Ø© 30 Ø¯Ù‚ÙŠÙ‚Ø©', 'success');
        } else {
            this.isAuthenticated = false;
            alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
        }
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ù‚Ø¨Ù„ ØªÙ†ÙÙŠØ° Ø£ÙŠ Ø£Ù…Ø±
    requireAuth() {
        if (!this.isAuthenticated) {
            showTempMessage('âŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„ÙØ§Ø¦Ù‚Ø©', 'error');
            return false;
        }
        this.resetAuthTimeout(); // ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù‡Ù„Ø©
        return true;
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…Ù‡Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    resetAuthTimeout() {
        if (this.authTimeout) clearTimeout(this.authTimeout);
        this.authTimeout = setTimeout(() => {
            this.isAuthenticated = false;
            showTempMessage('ğŸ”’ Ø§Ù†ØªÙ‡Øª Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ÙØ§Ø¦Ù‚ - ÙŠÙ„Ø²Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©', 'warning');
        }, 30 * 60 * 1000); // 30 Ø¯Ù‚ÙŠÙ‚Ø©
    }

    togglePanel() {
        const panel = document.getElementById('superAdminPanel');
        if (!this.isAuthenticated) {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©ØŒ Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙ‚Ø·
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        } else {
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
    }

    // ğŸš¨ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ - Ù…Ø¹Ø¯Ù„
    emergencyShutdown() {
        if (!this.requireAuth()) return;
        
        if (confirm('ğŸš¨ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
            localStorage.setItem('appEmergencyShutdown', 'true');
            localStorage.setItem('shutdownTime', new Date().toISOString());
            localStorage.setItem('shutdownReason', 'Ø¥ÙŠÙ‚Ø§Ù Ø·Ø§Ø±Ø¦ Ù…Ù† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙˆÙ‚Ù
            document.body.innerHTML = `
                <div style="width: 100vw; height: 100vh; background: linear-gradient(135deg, #c0392b, #e74c3c); display: flex; justify-content: center; align-items: center; color: white; font-family: Arial; text-align: center;">
                    <div>
                        <h1 style="font-size: 2.5em; margin-bottom: 20px;">ğŸš¨ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ØªÙˆÙ‚Ù</h1>
                        <p style="font-size: 1.2em; margin-bottom: 10px;">ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ø£Ø³Ø¨Ø§Ø¨ ØªÙ‚Ù†ÙŠØ©</p>
                        <p style="font-size: 1.em; opacity: 0.8;">ÙˆÙ‚Øª Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù: ${new Date().toLocaleString('ar-EG')}</p>
                        <p style="font-size: 1.em; opacity: 0.8;">Ø§Ù„ØªØ·ÙˆÙŠØ±: ÙÙ‡Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²</p>
                    </div>
                </div>
            `;
        }
    }

    // ğŸ‘¥ Ø·Ø±Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - Ù…Ø¹Ø¯Ù„
    kickAllUsers() {
        if (!this.requireAuth()) return;
        
        if (confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ø·Ø±Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ù‡Ù…ØŸ')) {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            
            // ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            Object.keys(users).forEach(email => {
                users[email].isLoggedIn = false;
            });
            
            localStorage.setItem('users', JSON.stringify(users));
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            localStorage.removeItem('currentUser');
            
            showTempMessage('âœ… ØªÙ… Ø·Ø±Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ù‡Ù…', 'success');
            setTimeout(() => location.reload(), 2000);
        }
    }

    // â›” ØªØ¹Ø·ÙŠÙ„ ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯ - Ù…Ø¹Ø¯Ù„
    disableNewUsers() {
        if (!this.requireAuth()) return;
        
        const currentlyDisabled = localStorage.getItem('disableNewUsers') === 'true';
        
        if (!currentlyDisabled) {
            localStorage.setItem('disableNewUsers', 'true');
            showTempMessage('âœ… ØªÙ… ØªØ¹Ø·ÙŠÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯', 'success');
        } else {
            localStorage.setItem('disableNewUsers', 'false');
            showTempMessage('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯', 'success');
        }
    }

    // ğŸ“Š Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ù…Ø¹Ø¯Ù„
    viewAllData() {
        if (!this.requireAuth()) return;
        
        let allData = '';
        
        // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const value = localStorage.getItem(key);
            allData += `${key}: ${value}\n\n`;
        }
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const dataWindow = window.open('', '_blank');
        dataWindow.document.write(`
            <html>
                <head><title>Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</title></head>
                <body style="font-family: Arial; direction: ltr; word-wrap: break-word;">
                    <h1>Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h1>
                    <pre>${allData}</pre>
                    <button onclick="window.print()">ğŸ–¨ Ø·Ø¨Ø§Ø¹Ø©</button>
                    <button onclick="window.close()">Ø¥ØºÙ„Ø§Ù‚</button>
                </body>
            </html>
        `);
    }
}

// ===== Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
const baseBilletWeights = { 
    '5': 0.342, 
    '6': 0.493, 
    '7': 0.670, 
    '8': 0.876, 
    '9': 1.108,  
    '10': 1.368,
    '11': 1.656
};

const alloyFactor = {
    '1050':0.98, '1070':0.99, '1100':0.96, '3003':1.00, '3004':1.00,
    '2024':1.01, '6060':1.00, '6063':1.00, '6061':0.995, '6005':1.01,
    '6082':1.02, '7075':1.03, '5083':1.02, '6101':1.00
};

// ===== Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ© =====
const alloyTemperatures = {
    '1050': { entryMin: 440, entryMax: 480, exitMin: 480, exitMax: 520, notes: 'Ø³Ø¨Ø§Ø¦Ùƒ Ù†Ø§Ø¹Ù…Ø© - Ø³Ù‡Ù„Ø© Ø§Ù„Ø¨Ø«Ù‚' },
    '1070': { entryMin: 440, entryMax: 480, exitMin: 480, exitMax: 520, notes: 'Ø³Ø¨Ø§Ø¦Ùƒ Ù†Ø§Ø¹Ù…Ø© - Ø³Ù‡Ù„Ø© Ø§Ù„Ø¨Ø«Ù‚' },
    '1100': { entryMin: 440, entryMax: 480, exitMin: 480, exitMax: 520, notes: 'Ø³Ø¨Ø§Ø¦Ùƒ Ù†Ø§Ø¹Ù…Ø© - Ø³Ù‡Ù„Ø© Ø§Ù„Ø¨Ø«Ù‚' },
    '3003': { entryMin: 450, entryMax: 490, exitMin: 490, exitMax: 530, notes: 'Ø³Ø¨Ø§Ø¦Ùƒ Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØµÙ„Ø§Ø¨Ø©' },
    '3004': { entryMin: 450, entryMax: 490, exitMin: 490, exitMax: 530, notes: 'Ø³Ø¨Ø§Ø¦Ùƒ Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØµÙ„Ø§Ø¨Ø©' },
    '6060': { entryMin: 460, entryMax: 500, exitMin: 500, exitMax: 540, notes: 'Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø«Ù‚' },
    '6063': { entryMin: 460, entryMax: 500, exitMin: 500, exitMax: 540, notes: 'Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø«Ù‚' },
    '6061': { entryMin: 470, entryMax: 510, exitMin: 510, exitMax: 550, notes: 'ØªØ­ØªØ§Ø¬ Ø­Ø±Ø§Ø±Ø© Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹' },
    '6005': { entryMin: 480, entryMax: 520, exitMin: 520, exitMax: 560, notes: 'Ø³Ø¨Ø§Ø¦Ùƒ Ø£Ù‚ÙˆÙ‰ - Ø­Ø±Ø§Ø±Ø© Ø£Ø¹Ù„Ù‰' },
    '6082': { entryMin: 480, entryMax: 520, exitMin: 520, exitMax: 560, notes: 'Ø³Ø¨Ø§Ø¦Ùƒ Ø£Ù‚ÙˆÙ‰ - Ø­Ø±Ø§Ø±Ø© Ø£Ø¹Ù„Ù‰' },
    '6101': { entryMin: 460, entryMax: 500, exitMin: 500, exitMax: 540, notes: 'Ù…Ø´Ø§Ø¨Ù‡Ø© Ù„Ù€ 6063' },
    '2024': { entryMin: 400, entryMax: 440, exitMin: 440, exitMax: 480, notes: 'Ø³Ø¨ÙŠÙƒØ© ØµÙ„Ø¨Ø© - Ø­Ø±Ø§Ø±Ø© Ù…Ù†Ø®ÙØ¶Ø©' },
    '7075': { entryMin: 380, entryMax: 420, exitMin: 420, exitMax: 460, notes: 'Ø³Ø¨ÙŠÙƒØ© ÙØ§Ø¦Ù‚Ø© Ø§Ù„ØµÙ„Ø§Ø¨Ø©' },
    '5083': { entryMin: 420, entryMax: 460, exitMin: 460, exitMax: 500, notes: 'Ø³Ø¨ÙŠÙƒØ© Ø¨Ø­Ø±ÙŠØ© - Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©' }
};

// ØªÙ‡ÙŠØ¦Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ
const userManager = new UserManager();
const companyManager = new CompanyManager(userManager);
const adminManager = new AdminManager(userManager);
const passwordRecovery = new PasswordRecovery(userManager);
const superAdmin = new SuperAdmin();
const userManagement = new UserManagementSystem(userManager, adminManager);

// ===== Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­ Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹ =====
function calculateBilletsPerHour(extrusionSpeed, billetLengthCm) {
    // Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ø¨Ø§Ù„Ù…ÙŠÙ„ÙŠÙ…ØªØ±
    const billetLengthMm = billetLengthCm * 10;
    
    // Ø­Ø³Ø§Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø¨Ø«Ù‚ Ù„Ù„Ø¨Ù„ÙŠØª Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
    // Ø§Ù„ÙˆÙ‚Øª = Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª (Ù…Ù…) Ã· Ø§Ù„Ø³Ø±Ø¹Ø© (Ù…/Ø¯Ù‚ÙŠÙ‚Ø©)
    const extrusionTimeSeconds = billetLengthMm / extrusionSpeed;
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹ Ù…Ù† Ø§Ù„Ø­Ù‚Ù„
    const wastedTimePercentage = parseFloat(document.getElementById('wastedTimePercentage').value) || 20;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹
    const totalTimePerBillet = extrusionTimeSeconds * (1 + (wastedTimePercentage / 100));
    
    // Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© = 3600 Ø«Ø§Ù†ÙŠØ© Ã· Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ø¨Ù„ÙŠØª Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
    const billetsPerHour = 3600 / totalTimePerBillet;
    
    return isFinite(billetsPerHour) ? Math.round(billetsPerHour * 10) / 10 : 0;
}

// ===== Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø«Ù‚ Ø§Ù„Ù…Ø­Ø³Ù‘Ù† ÙˆØ§Ù„Ù…ØµØ­Ø­ =====
function calculateOptimalSpeed() {
    const alloy = document.getElementById('alloy').value;
    const moldType = document.getElementById('moldType').value;
    const weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value) || 0;
    const numOpenings = parseInt(document.getElementById('numOpenings').value) || 1;
    const extrusionTemperature = parseFloat(document.getElementById('extrusionTemperature').value) || 480;
    const extrusionRatio = parseFloat(document.getElementById('extrusionRatio').value) || 30;
    const billetDiameter = document.getElementById('billetDiameter').value;
    
    // Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨
    let baseSpeed;
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© - ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù‡Ù†Ø§
    if (alloy === '6082') {
        // Ø³Ø¨ÙŠÙƒØ© 6082: Ø£Ø¨Ø·Ø£ Ø³Ø±Ø¹Ø© Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­
        baseSpeed = moldType === 'hollow' ? 1.8 : 2.5;
    } else if (alloy === '6061' || alloy === '6005') {
        // Ø³Ø¨Ø§Ø¦Ùƒ Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„ØµÙ„Ø§Ø¨Ø©
        baseSpeed = moldType === 'hollow' ? 3.0 : 4.2;
    } else if (alloy === '6063' || alloy === '6060' || alloy === '6101') {
        // Ø³Ø¨Ø§Ø¦Ùƒ Ø´Ø§Ø¦Ø¹Ø© Ù„Ù„Ø¨Ø«Ù‚ - ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø© 20% ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª
        baseSpeed = moldType === 'hollow' ? 4.8 : 6.7; // Ø²Ø§Ø¯Øª Ù…Ù† 4.0 Ø¥Ù„Ù‰ 4.8 Ùˆ Ù…Ù† 5.6 Ø¥Ù„Ù‰ 6.7
    } else {
        // Ø³Ø¨Ø§Ø¦Ùƒ Ù†Ø§Ø¹Ù…Ø©
        baseSpeed = moldType === 'hollow' ? 5.0 : 7.0;
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ
    let weightFactor = 1.0;
    if (weightPerMeter < 0.200) {
        // ÙˆØ²Ù† Ø®ÙÙŠÙ Ø¬Ø¯Ø§Ù‹ - ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø©
        weightFactor = 0.7;
    } else if (weightPerMeter < 0.300) {
        // ÙˆØ²Ù† Ø®ÙÙŠÙ
        weightFactor = 0.85;
    } else if (weightPerMeter > 0.500 && weightPerMeter <= 1.000) {
        // ÙˆØ²Ù† Ø«Ù‚ÙŠÙ„ - Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø©
        weightFactor = 1.2;
    } else if (weightPerMeter > 1.000) {
        // ÙˆØ²Ù† Ø«Ù‚ÙŠÙ„ Ø¬Ø¯Ø§Ù‹
        weightFactor = 1.4;
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª
    let openingsFactor = 1.0;
    if (numOpenings > 6) {
        openingsFactor = 0.9;
    } else if (numOpenings > 4) {
        openingsFactor = 0.95;
    } else if (numOpenings === 1) {
        openingsFactor = 1.1;
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© Ø­Ø³Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©
    let temperatureFactor = 1.0;
    const tempData = alloyTemperatures[alloy] || { entryMin: 460, entryMax: 500 };
    const optimalTemp = (tempData.entryMin + tempData.entryMax) / 2;
    
    if (extrusionTemperature < optimalTemp - 20) {
        // Ø­Ø±Ø§Ø±Ø© Ù…Ù†Ø®ÙØ¶Ø© - Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø©
        temperatureFactor = 1.15;
    } else if (extrusionTemperature > optimalTemp + 20) {
        // Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø© - ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø©
        temperatureFactor = 0.85;
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© Ø­Ø³Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚
    let ratioFactor = 1.0;
    if (extrusionRatio > 80) {
        ratioFactor = 0.9;
    } else if (extrusionRatio > 60) {
        ratioFactor = 0.95;
    } else if (extrusionRatio < 20) {
        ratioFactor = 1.1;
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© Ø­Ø³Ø¨ Ù‚Ø·Ø± Ø§Ù„Ù…ÙƒØ¨Ø³
    let diameterFactor = 1.0;
    if (billetDiameter === '11') {
        diameterFactor = 1.15; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø© Ù„Ù„Ù…ÙƒØ§Ø¨Ø³ Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
    } else if (billetDiameter === '10') {
        diameterFactor = 1.1;
    } else if (billetDiameter === '9') {
        diameterFactor = 1.05;
    } else if (billetDiameter === '5') {
        diameterFactor = 0.9; // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø© Ù„Ù„Ù…ÙƒØ§Ø¨Ø³ Ø§Ù„ØµØºÙŠØ±Ø©
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    let finalSpeed = baseSpeed * weightFactor * openingsFactor * temperatureFactor * ratioFactor * diameterFactor;
    
    // ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„Ø³Ø±Ø¹Ø© Ø¶Ù…Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­Ø©
    if (moldType === 'hollow') {
        finalSpeed = Math.max(1.5, Math.min(8.0, finalSpeed));
    } else {
        finalSpeed = Math.max(2.0, Math.min(12.0, finalSpeed));
    }
    
    // ØªØ­Ø¯ÙŠØ« ÙˆØµÙ Ø§Ù„Ø³Ø±Ø¹Ø©
    const speedDescription = document.getElementById('speedDescription');
    let description = '';
    
    if (alloy === '6082') {
        description = 'âš ï¸ Ø³Ø¨ÙŠÙƒØ© 6082 - Ø³Ø±Ø¹Ø© Ø¨Ø·ÙŠØ¦Ø© Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø¬ÙˆØ¯Ø© (1.5-2.5 Ù…/Ø¯Ù‚ÙŠÙ‚Ø©)';
    } else if (finalSpeed < 3.0) {
        description = 'ğŸ¢ Ø³Ø±Ø¹Ø© Ø¨Ø·ÙŠØ¦Ø© - Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù…Ø¹Ù‚Ø¯Ø©';
    } else if (finalSpeed < 5.0) {
        description = 'ğŸš¶ Ø³Ø±Ø¹Ø© Ù…ØªÙˆØ³Ø·Ø© - ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ©';
    } else {
        description = 'ğŸš€ Ø³Ø±Ø¹Ø© Ø¹Ø§Ù„ÙŠØ© - Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø¨Ø³ÙŠØ·Ø©';
    }
    
    speedDescription.textContent = description;
    
    return finalSpeed.toFixed(1);
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¨Ù„ÙŠØª Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ù‚Ø·Ø± Ø§Ù„Ù…ÙƒØ¨Ø³ =====
function calculateOptimalTemperature() {
    const alloy = document.getElementById('alloy').value;
    const billetDiameter = document.getElementById('billetDiameter').value;
    const autoTemp = document.getElementById('autoTemperature').value === '1';
    
    if (!autoTemp) return; // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù…ÙØ¹Ù„
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ù„Ù„Ø³Ø¨ÙŠÙƒØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    const tempData = alloyTemperatures[alloy] || { entryMin: 460, entryMax: 500, exitMin: 500, exitMax: 540, notes: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©' };
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ© (Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¯Ù‰)
    let optimalTemp = Math.round((tempData.entryMin + tempData.entryMax) / 2);
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø­Ø³Ø¨ Ù‚Ø·Ø± Ø§Ù„Ù…ÙƒØ¨Ø³
    if (billetDiameter === '11' || billetDiameter === '10') {
        // Ù…ÙƒØ§Ø¨Ø³ ÙƒØ¨ÙŠØ±Ø© ØªØ­ØªØ§Ø¬ Ø­Ø±Ø§Ø±Ø© Ø£Ø¹Ù„Ù‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹
        optimalTemp += 10;
    } else if (billetDiameter === '5' || billetDiameter === '6') {
        // Ù…ÙƒØ§Ø¨Ø³ ØµØºÙŠØ±Ø© ØªØ­ØªØ§Ø¬ Ø­Ø±Ø§Ø±Ø© Ø£Ù‚Ù„ Ù‚Ù„ÙŠÙ„Ø§Ù‹
        optimalTemp -= 10;
    } else if (billetDiameter === '7' || billetDiameter === '8') {
        // Ù…ÙƒØ§Ø¨Ø³ Ù…ØªÙˆØ³Ø·Ø© - Ù„Ø§ ØªØºÙŠÙŠØ±
        optimalTemp += 0;
    } else if (billetDiameter === '9') {
        // Ù…ÙƒØ§Ø¨Ø³ ÙƒØ¨ÙŠØ±Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹ - Ø²ÙŠØ§Ø¯Ø© Ø¨Ø³ÙŠØ·Ø©
        optimalTemp += 5;
    }
    
    document.getElementById('extrusionTemperature').value = optimalTemp;
    updateTemperatureWarning();
}

// ===== Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ =====
function calculateWastedTimePercentage() {
    const alloy = document.getElementById('alloy').value;
    const moldType = document.getElementById('moldType').value;
    const extrusionRatio = parseFloat(document.getElementById('extrusionRatio').value) || 30;
    const billetDiameter = document.getElementById('billetDiameter').value;
    
    let baseWastedTime = 20; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© 20%
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¨ÙŠÙƒØ©
    if (alloy === '6082' || alloy === '6061') {
        baseWastedTime += 5; // Ø³Ø¨Ø§Ø¦Ùƒ Ø£Ù‚ÙˆÙ‰ ØªØ­ØªØ§Ø¬ ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ
    } else if (alloy === '6063' || alloy === '6060') {
        baseWastedTime -= 2; // Ø³Ø¨Ø§Ø¦Ùƒ Ø³Ù‡Ù„Ø© Ø§Ù„Ø¨Ø«Ù‚
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨
    if (moldType === 'hollow') {
        baseWastedTime += 3; // Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø¬ÙˆÙØ© ØªØ­ØªØ§Ø¬ ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ
    } else {
        baseWastedTime -= 2; // Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØµÙ„Ø¯Ø© Ø£Ø³Ø±Ø¹
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚
    if (extrusionRatio > 80) {
        baseWastedTime += 5; // Ù†Ø³Ø¨ Ø§Ù„Ø¨Ø«Ù‚ Ø§Ù„Ø¹Ø§Ù„ÙŠØ© ØªØ­ØªØ§Ø¬ ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ
    } else if (extrusionRatio < 30) {
        baseWastedTime -= 3; // Ù†Ø³Ø¨ Ø§Ù„Ø¨Ø«Ù‚ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© Ø£Ø³Ø±Ø¹
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ù‚Ø·Ø± Ø§Ù„Ù…ÙƒØ¨Ø³
    if (billetDiameter === '11' || billetDiameter === '10') {
        baseWastedTime += 3; // Ø§Ù„Ù…ÙƒØ§Ø¨Ø³ Ø§Ù„ÙƒØ¨ÙŠØ±Ø© ØªØ­ØªØ§Ø¬ ÙˆÙ‚Øª Ø¥Ø¶Ø§ÙÙŠ
    } else if (billetDiameter === '5' || billetDiameter === '6') {
        baseWastedTime -= 2; // Ø§Ù„Ù…ÙƒØ§Ø¨Ø³ Ø§Ù„ØµØºÙŠØ±Ø© Ø£Ø³Ø±Ø¹
    }
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨ÙŠÙ† 10% Ùˆ 40%
    const finalWastedTime = Math.max(10, Math.min(40, baseWastedTime));
    
    document.getElementById('wastedTimePercentage').value = finalWastedTime;
    
    return finalWastedTime;
}

// ===== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø±Ø¹Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø£ÙŠ Ù…Ù† Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø© =====
function updateSpeedAutomatically() {
    const optimalSpeed = calculateOptimalSpeed();
    document.getElementById('extrusionSpeed').value = optimalSpeed;
    saveState();
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ =====
function initializeWeightCalculatorToggle() {
    const toggleBtn = document.getElementById('boxCalculatorToggle');
    const content = document.getElementById('boxCalculatorContent');
    const header = document.getElementById('boxCalculatorHeader');
    
    // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ù† localStorage
    const isCollapsed = localStorage.getItem('boxCalculatorCollapsed') === 'true';
    if (isCollapsed) {
        content.classList.add('collapsed');
        toggleBtn.classList.add('rotated');
    }
    
    header.addEventListener('click', function() {
        content.classList.toggle('collapsed');
        toggleBtn.classList.toggle('rotated');
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ localStorage
        localStorage.setItem('boxCalculatorCollapsed', content.classList.contains('collapsed'));
    });
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù„Ø¨Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø³ÙŠØ± ÙˆØ§Ù„Ø²ÙˆØ§ÙŠØ§ =====
function initializeProfileTypeToggle() {
    const profileTypeBtns = document.querySelectorAll('.profile-type-btn');
    const boxInputs = document.querySelector('.box-inputs');
    const pipeInputs = document.querySelector('.pipe-inputs');
    const angleInputs = document.querySelector('.angle-inputs');
    
    profileTypeBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            profileTypeBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const profileType = this.getAttribute('data-type');
            
            if (profileType === 'box') {
                boxInputs.classList.add('active');
                pipeInputs.classList.remove('active');
                angleInputs.classList.remove('active');
            } else if (profileType === 'pipe') {
                boxInputs.classList.remove('active');
                pipeInputs.classList.add('active');
                angleInputs.classList.remove('active');
            } else if (profileType === 'angle') {
                boxInputs.classList.remove('active');
                pipeInputs.classList.remove('active');
                angleInputs.classList.add('active');
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            calculateWeightPerMeter();
            saveState();
        });
    });
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­ =====
function initializeLengthSystem() {
    const toggleBtns = document.querySelectorAll('.toggle-btn');
    const customLengthContainer = document.getElementById('customLengthContainer');
    const customLengthInput = document.getElementById('customLength');
    
    toggleBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            toggleBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const lengthType = this.getAttribute('data-length');
            
            if (lengthType === 'custom') {
                customLengthContainer.classList.add('active');
                if (!customLengthInput.value) {
                    customLengthInput.value = '6';
                }
            } else {
                customLengthContainer.classList.remove('active');
            }
            
            // Ø§Ù„ØªØµØ­ÙŠØ­: ØªØ­Ø¯ÙŠØ« ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª ÙˆØ§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            updateRodWeightFromMeterAndLength();
            saveState();
        });
    });
    
    customLengthInput.addEventListener('input', function() {
        setTimeout(() => {
            // Ø§Ù„ØªØµØ­ÙŠØ­: ØªØ­Ø¯ÙŠØ« ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø§Ù„Ø«Ø§Ø¨Øª ÙˆØ§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            updateRodWeightFromMeterAndLength();
            saveState();
        }, 100);
    });
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© =====
function initializeHeatTreatmentToggle() {
    const toggleBtn = document.getElementById('heatTreatmentToggle');
    const content = document.getElementById('heatTreatmentContent');
    const header = document.getElementById('heatTreatmentHeader');
    
    // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ù† localStorage
    const isCollapsed = localStorage.getItem('heatTreatmentCollapsed') === 'true';
    if (isCollapsed) {
        content.classList.add('collapsed');
        toggleBtn.classList.add('rotated');
    }
    
    header.addEventListener('click', function() {
        content.classList.toggle('collapsed');
        toggleBtn.classList.toggle('rotated');
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ localStorage
        localStorage.setItem('heatTreatmentCollapsed', content.classList.contains('collapsed'));
    });
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„Ø³Ø¨ÙŠÙƒØ© ÙˆØ§Ù„Ø¨Ø«Ù‚ =====
function initializeAlloySettingsToggle() {
    const toggleBtn = document.getElementById('alloySettingsToggle');
    const content = document.getElementById('alloySettingsContent');
    const header = document.getElementById('alloySettingsHeader');
    
    // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ù† localStorage
    const isCollapsed = localStorage.getItem('alloySettingsCollapsed') === 'true';
    if (isCollapsed) {
        content.classList.add('collapsed');
        toggleBtn.classList.add('rotated');
    }
    
    header.addEventListener('click', function() {
        content.classList.toggle('collapsed');
        toggleBtn.classList.toggle('rotated');
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ localStorage
        localStorage.setItem('alloySettingsCollapsed', content.classList.contains('collapsed'));
    });
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© =====
function initializeTemperatureTableToggle() {
    const toggleBtn = document.getElementById('temperatureToggleBtn');
    const tableSection = document.getElementById('temperatureTableSection');
    
    // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ù† localStorage
    const isHidden = localStorage.getItem('temperatureTableHidden') === 'true';
    if (isHidden) {
        tableSection.style.display = 'none';
        toggleBtn.textContent = 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø©';
        toggleBtn.classList.add('hidden');
    }
    
    toggleBtn.addEventListener('click', function() {
        if (tableSection.style.display === 'none') {
            tableSection.style.display = 'block';
            toggleBtn.textContent = 'ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø©';
            toggleBtn.classList.remove('hidden');
            localStorage.setItem('temperatureTableHidden', 'false');
        } else {
            tableSection.style.display = 'none';
            toggleBtn.textContent = 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø©';
            toggleBtn.classList.add('hidden');
            localStorage.setItem('temperatureTableHidden', 'true');
        }
    });
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù‚Ø³Ù… Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ø¬ÙˆØ¯Ø© =====
function initializeQualityStandardsToggle() {
    const toggleBtn = document.getElementById('qualityStandardsToggle');
    const content = document.getElementById('qualityStandardsContent');
    const header = document.getElementById('qualityStandardsHeader');
    
    // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ù† localStorage
    const isCollapsed = localStorage.getItem('qualityStandardsCollapsed') === 'true';
    if (isCollapsed) {
        content.classList.add('collapsed');
        toggleBtn.classList.add('rotated');
    }
    
    header.addEventListener('click', function() {
        content.classList.toggle('collapsed');
        toggleBtn.classList.toggle('rotated');
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ localStorage
        localStorage.setItem('qualityStandardsCollapsed', content.classList.contains('collapsed'));
    });
}

// ===== Ù†Ø¸Ø§Ù… Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ§Ù„Ø³Ø±Ø¹Ø© =====
function initializeMoldTypeSystem() {
    const moldTypeSelect = document.getElementById('moldType');
    
    function updateSpeed() {
        const optimalSpeed = calculateOptimalSpeed();
        document.getElementById('extrusionSpeed').value = optimalSpeed;
        saveState();
    }
    
    moldTypeSelect.addEventListener('change', function() {
        updateSpeed();
        saveState();
    });
    
    updateSpeed(); // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
}

// ===== Ù†Ø¸Ø§Ù… Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ =====
function initializeResultsToggle() {
    const toggleBtn = document.getElementById('toggleResultsBtn');
    const resultSection = document.getElementById('result');
    
    toggleBtn.addEventListener('click', function() {
        const isVisible = resultSection.style.display !== 'none';
        
        if (isVisible) {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            resultSection.style.display = 'none';
            toggleBtn.innerHTML = 'ğŸ‘ï¸ Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬';
        } else {
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            resultSection.style.display = 'block';
            toggleBtn.innerHTML = 'ğŸ‘ï¸ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬';
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }
    });
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù‚Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ§Øª =====
function initializeCompanyToggle() {
    const toggleBtn = document.getElementById('companyToggle');
    const content = document.getElementById('companyContent');
    const header = document.getElementById('companyHeader');
    
    // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ù† localStorage
    const isCollapsed = localStorage.getItem('companyCollapsed') === 'true';
    if (isCollapsed) {
        content.classList.add('collapsed');
        toggleBtn.classList.add('rotated');
    }
    
    header.addEventListener('click', function() {
        content.classList.toggle('collapsed');
        toggleBtn.classList.toggle('rotated');
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ localStorage
        localStorage.setItem('companyCollapsed', content.classList.contains('collapsed'));
    });
}

// ===== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù„Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ =====
function initializeLoginToggle() {
    const toggleBtn = document.getElementById('loginToggle');
    const content = document.getElementById('loginContent');
    const header = document.getElementById('loginHeader');
    
    // ØªØ­Ù…ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ù…Ù† localStorage
    const isCollapsed = localStorage.getItem('loginCollapsed') === 'true';
    if (isCollapsed) {
        content.classList.add('collapsed');
        toggleBtn.classList.add('rotated');
    }
    
    header.addEventListener('click', function() {
        content.classList.toggle('collapsed');
        toggleBtn.classList.toggle('rotated');
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ localStorage
        localStorage.setItem('loginCollapsed', content.classList.contains('collapsed'));
    });
}

// ===== Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ù„Ù„Ø¹Ù„Ø¨Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø³ÙŠØ± ÙˆØ§Ù„Ø²ÙˆØ§ÙŠØ§ =====
function calculateWeightPerMeter() {
    const activeProfile = document.querySelector('.profile-type-btn.active').getAttribute('data-type');
    
    if (activeProfile === 'box') {
        return calculateBoxWeight();
    } else if (activeProfile === 'pipe') {
        return calculatePipeWeight();
    } else if (activeProfile === 'angle') {
        return calculateAngleWeight();
    }
    return 0;
}

// ===== Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ù„Ù„Ø¹Ù„Ø¨Ø© =====
function calculateBoxWeight() {
    const width = parseFloat(document.getElementById('boxWidth').value) || 0;
    const height = parseFloat(document.getElementById('boxHeight').value) || 0;
    const thickness = parseFloat(document.getElementById('boxThickness').value) || 0;
    
    if (width > 0 && height > 0 && thickness > 0) {
        // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
        const outerArea = width * height;
        
        // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© (Ø®ØµÙ… Ø§Ù„Ø³Ù…Ø§ÙƒØ© Ù…Ù† ÙƒÙ„ Ø¬Ø§Ù†Ø¨)
        const innerWidth = width - (2 * thickness);
        const innerHeight = height - (2 * thickness);
        
        // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©
        const innerArea = innerWidth * innerHeight;
        
        // 4. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØµØ§ÙÙŠØ© Ù„Ù„Ù…Ø¹Ø¯Ù†
        const netArea = outerArea - innerArea;
        
        // 5. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¥Ù„Ù‰ Ø³Ù…Â²
        const areaCm2 = netArea / 100;
        
        // 6. Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒØ«Ø§ÙØ© Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ… 2.7 Ø¬Ù…/Ø³Ù…Â³
        const weightPerMeter = (areaCm2 * 2.7) / 10;
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        document.getElementById('calculatedBoxWeight').textContent = weightPerMeter.toFixed(3);
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
        document.getElementById('outerArea').textContent = outerArea.toFixed(0);
        document.getElementById('innerArea').textContent = innerArea.toFixed(0);
        document.getElementById('netArea').textContent = netArea.toFixed(0);
        
        return weightPerMeter;
    } else {
        document.getElementById('calculatedBoxWeight').textContent = '0.000';
        document.getElementById('outerArea').textContent = '0';
        document.getElementById('innerArea').textContent = '0';
        document.getElementById('netArea').textContent = '0';
        return 0;
    }
}

// ===== Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ù„Ù„Ù…ÙˆØ§Ø³ÙŠØ± =====
function calculatePipeWeight() {
    const outerDiameter = parseFloat(document.getElementById('pipeOuterDiameter').value) || 0;
    const thickness = parseFloat(document.getElementById('pipeThickness').value) || 0;
    
    if (outerDiameter > 0 && thickness > 0) {
        // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø·Ø± Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ
        const innerDiameter = outerDiameter - (2 * thickness);
        
        // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© (Ø¯Ø§Ø¦Ø±Ø©)
        const outerArea = Math.PI * Math.pow(outerDiameter / 2, 2);
        
        // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© (Ø¯Ø§Ø¦Ø±Ø©)
        const innerArea = Math.PI * Math.pow(innerDiameter / 2, 2);
        
        // 4. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØµØ§ÙÙŠØ© Ù„Ù„Ù…Ø¹Ø¯Ù†
        const netArea = outerArea - innerArea;
        
        // 5. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¥Ù„Ù‰ Ø³Ù…Â²
        const areaCm2 = netArea / 100;
        
        // 6. Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒØ«Ø§ÙØ© Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ… 2.7 Ø¬Ù…/Ø³Ù…Â³
        const weightPerMeter = (areaCm2 * 2.7) / 10;
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        document.getElementById('calculatedBoxWeight').textContent = weightPerMeter.toFixed(3);
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„Ù…ÙˆØ§Ø³ÙŠØ±
        document.getElementById('outerArea').textContent = outerArea.toFixed(1);
        document.getElementById('innerArea').textContent = innerArea.toFixed(1);
        document.getElementById('netArea').textContent = netArea.toFixed(1);
        
        return weightPerMeter;
    } else {
        document.getElementById('calculatedBoxWeight').textContent = '0.000';
        document.getElementById('outerArea').textContent = '0';
        document.getElementById('innerArea').textContent = '0';
        document.getElementById('netArea').textContent = '0';
        return 0;
    }
}

// ===== Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ù„Ù„Ø²ÙˆØ§ÙŠØ§ =====
function calculateAngleWeight() {
    const width = parseFloat(document.getElementById('angleWidth').value) || 0;
    const height = parseFloat(document.getElementById('angleHeight').value) || 0;
    const thickness = parseFloat(document.getElementById('angleThickness').value) || 0;
    
    if (width > 0 && height > 0 && thickness > 0) {
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØµØ§ÙÙŠØ© Ù„Ù„Ø²Ø§ÙˆÙŠØ©
        // Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø²Ø§ÙˆÙŠØ© = (Ø§Ù„Ø¹Ø±Ø¶ + Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ - Ø§Ù„Ø³Ù…Ø§ÙƒØ©) Ã— Ø§Ù„Ø³Ù…Ø§ÙƒØ©
        const netArea = (width + height - thickness) * thickness;
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø¥Ù„Ù‰ Ø³Ù…Â²
        const areaCm2 = netArea / 100;
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (ÙƒØ¬Ù…/Ù…) Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒØ«Ø§ÙØ© Ø§Ù„Ø£Ù„ÙˆÙ…Ù†ÙŠÙˆÙ… 2.7 Ø¬Ù…/Ø³Ù…Â³
        const weightPerMeter = (areaCm2 * 2.7) / 10;
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        document.getElementById('calculatedBoxWeight').textContent = weightPerMeter.toFixed(3);
        
        // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„Ø²ÙˆØ§ÙŠØ§
        document.getElementById('outerArea').textContent = (width * height).toFixed(1);
        document.getElementById('innerArea').textContent = ((width - thickness) * (height - thickness)).toFixed(1);
        document.getElementById('netArea').textContent = netArea.toFixed(1);
        
        return weightPerMeter;
    } else {
        document.getElementById('calculatedBoxWeight').textContent = '0.000';
        document.getElementById('outerArea').textContent = '0';
        document.getElementById('innerArea').textContent = '0';
        document.getElementById('netArea').textContent = '0';
        return 0;
    }
}

// ===== Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ =====
function applyCalculatedWeightToMeter() {
    const calculatedWeight = calculateWeightPerMeter();
    if (calculatedWeight > 0) {
        document.getElementById('weightPerMeter').value = calculatedWeight.toFixed(3);
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ø·ÙˆÙ„
        updateRodFromMeter();
        updateExtrusionRatio();
        
        saveState();
        
        const activeProfile = document.querySelector('.profile-type-btn.active').getAttribute('data-type');
        const profileName = activeProfile === 'box' ? 'Ø§Ù„Ø¹Ù„Ø¨Ø©' : activeProfile === 'pipe' ? 'Ø§Ù„Ù…Ø§Ø³ÙˆØ±Ø©' : 'Ø§Ù„Ø²Ø§ÙˆÙŠØ©';
        
        showTempMessage(`âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨ Ù„Ù„${profileName}: ${calculatedWeight.toFixed(3)} ÙƒØ¬Ù…/Ù…`, 'success');
    }
}

// ===== Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª =====
function recalculateBedLengthFromCuts() {
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = getCurrentRodLength();
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;
    
    if (numCuts > 0 && rodLength > 0) {
        const calculatedBedLength = (numCuts * rodLength) + bedScrapLength;
        document.getElementById('desiredBedLength').value = calculatedBedLength.toFixed(1);
    }
}

// ===== Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª Ù…Ù† Ø§Ù„Ø·ÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´ =====
function recalculateCutsFromBedLength() {
    const desiredBedLength = parseFloat(document.getElementById('desiredBedLength').value) || 0;
    const rodLength = getCurrentRodLength();
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;
    
    if (desiredBedLength > 0 && rodLength > 0) {
        const calculatedCuts = Math.max(1, Math.ceil((desiredBedLength - bedScrapLength) / rodLength));
        document.getElementById('numCuts').value = calculatedCuts;
        showTempMessage(`ğŸ”„ ØªÙ… Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§Øª: (${desiredBedLength} - ${bedScrapLength}) Ã· ${rodLength} = ${calculatedCuts} Ù‚ØµÙ‘Ø©`, 'info');
    }
}

function getCurrentRodLength() {
    const activeToggle = document.querySelector('.toggle-btn.active');
    const customLengthInput = document.getElementById('customLength');
    
    if (activeToggle && activeToggle.getAttribute('data-length') === 'custom') {
        return parseFloat(customLengthInput.value) || 6;
    } else if (activeToggle) {
        return parseFloat(activeToggle.getAttribute('data-length')) || 6;
    } else {
        return 6;
    }
}

// ===== Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­ Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø´Ø±ÙƒØ§Øª =====
function autoSearchMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber || !moldVersion) return;
    
    document.getElementById('autoFillNotice').style.display = 'block';
    
    setTimeout(() => {
        try {
            const moldDatabase = companyManager.getCompanyMoldDatabase();
            const moldKey = `${moldNumber}/${moldVersion}`;
            const foundMold = moldDatabase[moldKey];
            
            if (foundMold) {
                document.getElementById('rodWeight').value = foundMold.rodWeight || '1.2';
                document.getElementById('weightPerMeter').value = foundMold.weightPerMeter || '0.200';
                document.getElementById('numOpenings').value = foundMold.numOpenings || '4';
                document.getElementById('desiredBedLength').value = foundMold.desiredBedLength || '43.5';
                document.getElementById('numCuts').value = foundMold.numCuts || '7';
                document.getElementById('alloy').value = foundMold.alloy || '6063';
                document.getElementById('buttScrap').value = foundMold.buttScrap || '15';
                document.getElementById('billetDiameter').value = foundMold.billetDiameter || '7';
                document.getElementById('scrapPercentage').value = foundMold.scrapPercentage || '5';
                document.getElementById('safetyFactor').value = foundMold.safetyFactor || '5';
                document.getElementById('enableScrapSafety').value = foundMold.enableScrapSafety || '1';
                document.getElementById('extrusionTemperature').value = foundMold.extrusionTemperature || '480';
                document.getElementById('autoTemperature').value = foundMold.autoTemperature || '1';
                document.getElementById('extrusionSpeed').value = foundMold.extrusionSpeed || '6';
                document.getElementById('moldType').value = foundMold.moldType || 'hollow';
                document.getElementById('wastedTimePercentage').value = foundMold.wastedTimePercentage || '20';
                document.getElementById('t4Time').value = foundMold.t4Time || '1.5';
                document.getElementById('t5Time').value = foundMold.t5Time || '2.5';
                document.getElementById('t6Time').value = foundMold.t6Time || '4.5';
                document.getElementById('heatTreatmentTemp').value = foundMold.heatTreatmentTemp || '175';
                document.getElementById('materialThickness').value = foundMold.materialThickness || '1.5';
                
                applyAlloyToWeight();
                initializeMoldTypeSystem(); // ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±Ø¹Ø©
                
                const toggleBtns = document.querySelectorAll('.toggle-btn');
                let lengthFound = false;
                
                toggleBtns.forEach(btn => {
                    if (btn.getAttribute('data-length') === foundMold.rodLength) {
                        btn.click();
                        lengthFound = true;
                    }
                });
                
                if (foundMold.rodLength === 'custom' && foundMold.customLength) {
                    document.getElementById('customLength').value = foundMold.customLength;
                    if (!lengthFound) {
                        document.querySelector('.toggle-btn[data-length="custom"]').click();
                    }
                }
                
                updateExtrusionRatio();
                calculateOptimalTemperature();
                
                document.getElementById('autoFillNotice').style.display = 'none';
                showTempMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹`, 'success');
                
            } else {
                document.getElementById('autoFillNotice').style.display = 'none';
            }
            
        } catch (e) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:', e);
            document.getElementById('autoFillNotice').style.display = 'none';
        }
    }, 800);
}

function saveMoldData() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    const rodWeight = document.getElementById('rodWeight').value;
    const weightPerMeter = document.getElementById('weightPerMeter').value;
    const numOpenings = document.getElementById('numOpenings').value;
    const desiredBedLength = document.getElementById('desiredBedLength').value;
    const numCuts = document.getElementById('numCuts').value;
    const activeToggle = document.querySelector('.toggle-btn.active');
    const rodLength = activeToggle ? activeToggle.getAttribute('data-length') : '6';
    const customLength = document.getElementById('customLength').value;
    const alloy = document.getElementById('alloy').value;
    const buttScrap = document.getElementById('buttScrap').value;
    const billetDiameter = document.getElementById('billetDiameter').value;
    const scrapPercentage = document.getElementById('scrapPercentage').value;
    const safetyFactor = document.getElementById('safetyFactor').value;
    const enableScrapSafety = document.getElementById('enableScrapSafety').value;
    const extrusionTemperature = document.getElementById('extrusionTemperature').value;
    const autoTemperature = document.getElementById('autoTemperature').value;
    const extrusionSpeed = document.getElementById('extrusionSpeed').value;
    const moldType = document.getElementById('moldType').value;
    const wastedTimePercentage = document.getElementById('wastedTimePercentage').value;
    const t4Time = document.getElementById('t4Time').value;
    const t5Time = document.getElementById('t5Time').value;
    const t6Time = document.getElementById('t6Time').value;
    const heatTreatmentTemp = document.getElementById('heatTreatmentTemp').value;
    const materialThickness = document.getElementById('materialThickness').value;

    if (!moldNumber || !moldVersion) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø©');
        return;
    }
    
    const moldKey = `${moldNumber}/${moldVersion}`;
    const moldData = {
        rodWeight: rodWeight,
        weightPerMeter: weightPerMeter,
        numOpenings: numOpenings,
        desiredBedLength: desiredBedLength,
        numCuts: numCuts,
        rodLength: rodLength,
        customLength: customLength,
        alloy: alloy,
        buttScrap: buttScrap,
        billetDiameter: billetDiameter,
        scrapPercentage: scrapPercentage,
        safetyFactor: safetyFactor,
        enableScrapSafety: enableScrapSafety,
        extrusionTemperature: extrusionTemperature,
        autoTemperature: autoTemperature,
        extrusionSpeed: extrusionSpeed,
        moldType: moldType,
        wastedTimePercentage: wastedTimePercentage,
        t4Time: t4Time,
        t5Time: t5Time,
        t6Time: t6Time,
        heatTreatmentTemp: heatTreatmentTemp,
        materialThickness: materialThickness,
        timestamp: new Date().toLocaleString('ar-EG'),
        moldNumber: moldNumber,
        moldVersion: moldVersion,
        savedBy: userManager.currentUser.id,
        savedByCompany: companyManager.currentCompany ? companyManager.currentCompany.id : null
    };
    
    try {
        const existingData = companyManager.getCompanyMoldDatabase();
        existingData[moldKey] = moldData;
        companyManager.saveCompanyMoldDatabase(existingData);
        showTempMessage(`âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        localStorage.setItem('lastUpdatedMold', moldKey);
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        console.error(e);
    }
}

function searchMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
        return;
    }
    
    try {
        const moldDatabase = companyManager.getCompanyMoldDatabase();
        let foundMold = null;
        let foundKey = '';
        
        if (moldVersion) {
            const fullKey = `${moldNumber}/${moldVersion}`;
            foundMold = moldDatabase[fullKey];
            foundKey = fullKey;
        } else {
            const searchPattern = new RegExp(`^${moldNumber}/`);
            for (const key in moldDatabase) {
                if (searchPattern.test(key)) {
                    foundMold = moldDatabase[key];
                    foundKey = key;
                    break;
                }
            }
        }
        
        if (foundMold) {
            document.getElementById('rodWeight').value = foundMold.rodWeight || '1.2';
            document.getElementById('weightPerMeter').value = foundMold.weightPerMeter || '0.200';
            document.getElementById('numOpenings').value = foundMold.numOpenings || '4';
            document.getElementById('desiredBedLength').value = foundMold.desiredBedLength || '43.5';
            document.getElementById('numCuts').value = foundMold.numCuts || '7';
            document.getElementById('alloy').value = foundMold.alloy || '6063';
            document.getElementById('buttScrap').value = foundMold.buttScrap || '15';
            document.getElementById('billetDiameter').value = foundMold.billetDiameter || '7';
            document.getElementById('scrapPercentage').value = foundMold.scrapPercentage || '5';
            document.getElementById('safetyFactor').value = foundMold.safetyFactor || '5';
            document.getElementById('enableScrapSafety').value = foundMold.enableScrapSafety || '1';
            document.getElementById('extrusionTemperature').value = foundMold.extrusionTemperature || '480';
            document.getElementById('autoTemperature').value = foundMold.autoTemperature || '1';
            document.getElementById('extrusionSpeed').value = foundMold.extrusionSpeed || '6';
            document.getElementById('moldType').value = foundMold.moldType || 'hollow';
            document.getElementById('wastedTimePercentage').value = foundMold.wastedTimePercentage || '20';
            document.getElementById('t4Time').value = foundMold.t4Time || '1.5';
            document.getElementById('t5Time').value = foundMold.t5Time || '2.5';
            document.getElementById('t6Time').value = foundMold.t6Time || '4.5';
            document.getElementById('heatTreatmentTemp').value = foundMold.heatTreatmentTemp || '175';
            document.getElementById('materialThickness').value = foundMold.materialThickness || '1.5';
            
            applyAlloyToWeight();
            initializeMoldTypeSystem(); // ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±Ø¹Ø©
            
            const toggleBtns = document.querySelectorAll('.toggle-btn');
            let lengthFound = false;
            
            toggleBtns.forEach(btn => {
                if (btn.getAttribute('data-length') === foundMold.rodLength) {
                    btn.click();
                    lengthFound = true;
                }
            });
            
            if (foundMold.rodLength === 'custom' && foundMold.customLength) {
                document.getElementById('customLength').value = foundMold.customLength;
                if (!lengthFound) {
                    document.querySelector('.toggle-btn[data-length="custom"]').click();
                }
            }
            
            document.getElementById('moldNumber').value = foundMold.moldNumber || '';
            document.getElementById('moldVersion').value = foundMold.moldVersion || '';
            
            updateExtrusionRatio();
            calculateOptimalTemperature();
            
            showTempMessage(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ù„Ø¨ ${foundKey}`, 'success');
        } else {
            alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }
        
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«');
        console.error(e);
    }
}

function showAllMolds() {
    try {
        const moldDatabase = companyManager.getCompanyMoldDatabase();
        const moldKeys = Object.keys(moldDatabase);
        
        if (moldKeys.length === 0) {
            alert('ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯');
            return;
        }
        
        let message = `ğŸ“‹ Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© (${moldKeys.length}):\n\n`;
        moldKeys.forEach(key => {
            const mold = moldDatabase[key];
            const moldTypeText = mold.moldType === 'solid' ? 'Ø³ÙˆÙ„Ø¯' : 'Ù‡Ø§Ù„Ùˆ';
            message += `ğŸ”¸ ${key} - Ø§Ù„Ù†ÙˆØ¹: ${moldTypeText} - Ø§Ù„ÙˆØ²Ù†: ${mold.rodWeight} ÙƒØ¬Ù… - Ø§Ù„ÙØªØ­Ø§Øª: ${mold.numOpenings}\n`;
            message += `   Ø§Ù„Ø³Ø¨ÙŠÙƒØ©: ${mold.alloy} - Ø·ÙˆÙ„ Ø§Ù„Ø¹ÙˆØ¯: ${mold.rodLength}Ù… - Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³: ${mold.buttScrap || 15}Ù…Ù…\n`;
            message += `   Ø§Ù„Ù‡Ø§Ù„Ùƒ: ${mold.scrapPercentage || '5'}% - Ø§Ù„Ø£Ù…Ø§Ù†: ${mold.safetyFactor || '5'}% - Ø§Ù„Ø­Ø±Ø§Ø±Ø©: ${mold.extrusionTemperature || '480'}Â°C\n`;
            message += `   Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©: T4=${mold.t4Time || '1.5'}h, T5=${mold.t5Time || '2.5'}h, T6=${mold.t6Time || '4.5'}h\n`;
            message += `   Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©: ${mold.autoTemperature === '1' ? 'Ù…ÙØ¹Ù„' : 'Ù…Ø¹Ø·Ù„'}\n\n`;
        });
        
        alert(message);
    } catch (e) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
    }
}

function deleteMold() {
    const moldNumber = document.getElementById('moldNumber').value.trim();
    const moldVersion = document.getElementById('moldVersion').value.trim();
    
    if (!moldNumber || !moldVersion) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØ±Ù‚Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ù„Ù„Ø­Ø°Ù');
        return;
    }
    
    const moldKey = `${moldNumber}/${moldVersion}`;
    
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey}ØŸ`)) {
        try {
            const moldDatabase = companyManager.getCompanyMoldDatabase();
            
            if (moldDatabase[moldKey]) {
                delete moldDatabase[moldKey];
                companyManager.saveCompanyMoldDatabase(moldDatabase);
                showTempMessage(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ø§Ù„Ø¨ ${moldKey} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                document.getElementById('moldNumber').value = '';
                document.getElementById('moldVersion').value = '';
            } else {
                alert('âŒ Ø§Ù„Ù‚Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');
            }
        } catch (e) {
            alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù');
        }
    }
}

// ===== Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù…Ùƒ =====
function calculateAverageThickness() {
    const minThickness = 0.5;
    const maxThickness = 5.0;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªÙˆØ³Ø·
    const averageThickness = (minThickness + maxThickness) / 2;
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„Ø³Ù…Ùƒ
    document.getElementById('materialThickness').value = averageThickness.toFixed(2);
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·
    const thicknessInfo = document.getElementById('thicknessInfo');
    const averageThicknessValue = document.getElementById('averageThicknessValue');
    
    averageThicknessValue.textContent = averageThickness.toFixed(2) + ' Ù…Ù…';
    thicknessInfo.style.display = 'block';
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©
    calculateHeatTreatmentTimes();
    
    showTempMessage(`âœ… ØªÙ… Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ù…Ùƒ: ${averageThickness.toFixed(2)} Ù…Ù… (Ø§Ù„Ù…Ø¯Ù‰: ${minThickness}-${maxThickness} Ù…Ù…)`, 'success');
}

// ===== Ù†Ø¸Ø§Ù… Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© =====
function calculateHeatTreatmentTimes() {
    const materialThickness = parseFloat(document.getElementById('materialThickness').value) || 1.5;
    const alloy = document.getElementById('alloy').value;
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø³Ù†Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© ÙˆØ§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ©
    const alloyData = {
        '6082': { 
            T5: { base: 4.0, range: '3-5' },
            T6: { base: 6.0, range: '4-8' },
            temp: 175
        },
        '6061': { 
            T5: { base: 3.5, range: '3-4' },
            T6: { base: 8.0, range: '6-18' },
            temp: 175
        },
        '6063': { 
            T5: { base: 2.5, range: '2-4' },
            T6: { base: 5.0, range: '4-8' },
            temp: 175
        },
        '6005': { 
            T5: { base: 3.0, range: '2-4' },
            T6: { base: 6.0, range: '4-8' },
            temp: 175
        },
        '6101': { 
            T5: { base: 2.5, range: '2-4' },
            T6: { base: 5.0, range: '4-8' },
            temp: 175
        },
        '6060': { 
            T5: { base: 2.5, range: '2-4' },
            T6: { base: 5.0, range: '4-8' },
            temp: 175
        }
    };

    const selectedAlloy = alloyData[alloy] || alloyData['6063'];
    
    // Ù…Ø¹Ø§Ø¯Ù„Ø© Ø³Ù…Ùƒ Ù…Ø­Ø³Ù†Ø© Ù…Ø¹ Ù‡ÙˆØ§Ù…Ø´ Ø£Ù…Ø§Ù†
    let thicknessFactor;
    if (materialThickness <= 1.0) {
        thicknessFactor = 0.8;
    } else if (materialThickness <= 2.0) {
        thicknessFactor = 1.0;
    } else if (materialThickness <= 3.0) {
        thicknessFactor = 1.3;
    } else if (materialThickness <= 5.0) {
        thicknessFactor = 1.7;
    } else {
        thicknessFactor = 2.2;
    }

    // T4: ØªØµÙ„Ø¨ Ø¨Ø§Ù„Ù‡ÙˆØ§Ø¡ ÙÙ‚Ø·
    document.getElementById('t4Time').value = '0';
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    const t5Time = selectedAlloy.T5.base * thicknessFactor;
    const t6Time = selectedAlloy.T6.base * thicknessFactor;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„
    document.getElementById('t5Time').value = t5Time.toFixed(1);
    document.getElementById('t6Time').value = t6Time.toFixed(1);
    document.getElementById('heatTreatmentTemp').value = selectedAlloy.temp;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ©
    verifyEuropeanStandards(alloy, t5Time, t6Time);
    
    saveState();
}

// ===== Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ© =====
function verifyEuropeanStandards(alloy, t5Time, t6Time) {
    const europeanStandards = {
        '6060': { T5: { min: 2, max: 4 }, T6: { min: 4, max: 8 } },
        '6063': { T5: { min: 2, max: 4 }, T6: { min: 4, max: 8 } },
        '6082': { T5: { min: 3, max: 5 }, T6: { min: 4, max: 8 } },
        '6005': { T5: { min: 2, max: 4 }, T6: { min: 4, max: 8 } },
        '6101': { T5: { min: 2, max: 4 }, T6: { min: 4, max: 8 } }
    };
    
    const standard = europeanStandards[alloy];
    if (standard) {
        let message = '';
        
        if (t5Time < standard.T5.min || t5Time > standard.T5.max) {
            message += `T5 Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠ (${standard.T5.min}-${standard.T5.max} Ø³Ø§Ø¹Ø©). `;
        }
        
        if (t6Time < standard.T6.min || t6Time > standard.T6.max) {
            message += `T6 Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠ (${standard.T6.min}-${standard.T6.max} Ø³Ø§Ø¹Ø©). `;
        }
        
        if (message) {
            showTempMessage(`âš ï¸ ${message} Ø±Ø§Ø¬Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£ÙˆØ±ÙˆØ¨ÙŠØ© EN 755/EN 12020`, 'warning');
        }
    }
}

// ===== ØªÙˆÙ‚Ø¹ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ =====
function calculateExitTemperature() {
    const alloy = document.getElementById('alloy').value;
    const extrusionTemp = parseFloat(document.getElementById('extrusionTemperature').value) || 480;
    const extrusionRatio = parseFloat(document.getElementById('extrusionRatio').value) || 30;
    const extrusionSpeed = parseFloat(document.getElementById('extrusionSpeed').value) || 6;
    const moldType = document.getElementById('moldType').value;
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ù„Ù„Ø³Ø¨ÙŠÙƒØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    const tempData = alloyTemperatures[alloy] || { entryMin: 460, entryMax: 500, exitMin: 500, exitMax: 540, notes: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©' };
    
    // Ø­Ø³Ø§Ø¨ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
    let baseExitTemp = tempData.exitMin;
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…ØªÙˆØ³Ø·)
    const avgEntryTemp = (tempData.entryMin + tempData.entryMax) / 2;
    const entryAdjustment = (extrusionTemp - avgEntryTemp) * 0.8;
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ - Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø¹Ø§Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    const ratioAdjustment = Math.max(0, (extrusionRatio - 30) / 10) * 3;
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© - ØªØ£Ø«ÙŠØ± Ù…Ø¹ØªØ¯Ù„
    let speedAdjustment;
    if (moldType === 'hollow') {
        speedAdjustment = Math.max(0, (extrusionSpeed - 4) / 4) * 2;
    } else {
        speedAdjustment = Math.max(0, (extrusionSpeed - 6) / 6) * 3;
    }
    
    // ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ - Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ø¬ÙˆÙØ© ØªØ²ÙŠØ¯ Ø§Ù„Ø­Ø±Ø§Ø±Ø©
    const moldTypeAdjustment = moldType === 'hollow' ? 5 : 0;
    
    // Ø­Ø³Ø§Ø¨ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
    let exitTemperature = baseExitTemp + entryAdjustment + ratioAdjustment + speedAdjustment + moldTypeAdjustment;
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø¶Ù…Ù† Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ø³Ø¨ÙŠÙƒØ©
    exitTemperature = Math.max(tempData.exitMin, Math.min(tempData.exitMax, exitTemperature));
    
    return {
        temperature: Math.round(exitTemperature),
        factors: {
            baseExitTemp: baseExitTemp,
            entryAdjustment: entryAdjustment.toFixed(1),
            ratioAdjustment: ratioAdjustment.toFixed(1),
            speedAdjustment: speedAdjustment.toFixed(1),
            moldTypeAdjustment: moldTypeAdjustment,
            notes: tempData.notes
        },
        range: {
            min: tempData.exitMin,
            max: tempData.exitMax
        }
    };
}

// ===== ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ =====
function updateExitTemperatureDisplay(exitTempData) {
    const exitTempElement = document.getElementById('exitTemperatureResult');
    const exitTempValue = document.getElementById('exitTemperatureValue');
    const exitTempDetails = document.getElementById('exitTemperatureDetails');
    
    if (!exitTempData || !exitTempData.temperature) {
        exitTempElement.style.display = 'none';
        return;
    }
    
    exitTempValue.textContent = `${exitTempData.temperature} Â°C`;
    
    // Ø¨Ù†Ø§Ø¡ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
    let detailsHTML = `
        <div class="exit-temperature-step"><strong>Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ø³Ø¨ÙŠÙƒØ©:</strong> ${exitTempData.range.min}-${exitTempData.range.max}Â°C</div>
        <div class="exit-temperature-step"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø³Ø¨ÙŠÙƒØ©:</strong> ${exitTempData.factors.notes}</div>
        <div class="temperature-factor">
            <span>Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</span>
            <span class="temperature-factor-value">${exitTempData.factors.baseExitTemp} Â°C</span>
        </div>
        <div class="temperature-factor">
            <span>ØªØ¹Ø¯ÙŠÙ„ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„:</span>
            <span class="temperature-factor-value">+${exitTempData.factors.entryAdjustment} Â°C</span>
        </div>
        <div class="temperature-factor">
            <span>ØªØ¹Ø¯ÙŠÙ„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚:</span>
            <span class="temperature-factor-value">+${exitTempData.factors.ratioAdjustment} Â°C</span>
        </div>
        <div class="temperature-factor">
            <span>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±Ø¹Ø©:</span>
            <span class="temperature-factor-value">+${exitTempData.factors.speedAdjustment} Â°C</span>
        </div>
    `;
    
    // Ø¥Ø¶Ø§ÙØ© ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªØ¨Ø±ÙŠØ¯
    let coolingRecommendation = '';
    if (exitTempData.temperature > 550) {
        coolingRecommendation = 'âŒ Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø© Ø¬Ø¯Ø§Ù‹ - Ù…Ø·Ù„ÙˆØ¨ ØªØ¨Ø±ÙŠØ¯ Ù…ÙƒØ«Ù ÙÙˆØ±ÙŠ';
    } else if (exitTempData.temperature > 520) {
        coolingRecommendation = 'âš ï¸ Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø© - ØªØ¨Ø±ÙŠØ¯ Ù‚ÙˆÙŠ Ù…Ø·Ù„ÙˆØ¨';
    } else if (exitTempData.temperature > 490) {
        coolingRecommendation = 'âœ… Ø­Ø±Ø§Ø±Ø© Ù…Ù†Ø§Ø³Ø¨Ø© - ØªØ¨Ø±ÙŠØ¯ Ø¹Ø§Ø¯ÙŠ Ù…Ø·Ù„ÙˆØ¨';
    } else {
        coolingRecommendation = 'ğŸ’  Ø­Ø±Ø§Ø±Ø© Ù…Ù†Ø®ÙØ¶Ø© - ØªØ¨Ø±ÙŠØ¯ Ø®ÙÙŠÙ';
    }
    
    detailsHTML += `
        <div class="cooling-recommendation">
            <strong>ğŸ’¡ ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªØ¨Ø±ÙŠØ¯:</strong><br>
            â€¢ ${coolingRecommendation}<br>
            â€¢ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ¨Ø±ÙŠØ¯ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§: ${getCoolingSpeedRecommendation(exitTempData.temperature)}
        </div>
    `;
    
    exitTempDetails.innerHTML = detailsHTML;
    exitTempElement.style.display = 'block';
}

// ===== Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ¨Ø±ÙŠØ¯ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ =====
function getCoolingSpeedRecommendation(exitTemperature) {
    if (exitTemperature > 550) return 'Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹ (Ù…Ø±ÙˆØ­Ø© + Ø±Ø°Ø§Ø° Ù…Ø§Ø¡)';
    if (exitTemperature > 520) return 'Ø¹Ø§Ù„ÙŠØ© (Ù…Ø±ÙˆØ­Ø© Ù‚ÙˆÙŠØ©)';
    if (exitTemperature > 490) return 'Ù…ØªÙˆØ³Ø·Ø© (Ù…Ø±ÙˆØ­Ø© Ø¹Ø§Ø¯ÙŠØ©)';
    return 'Ù…Ù†Ø®ÙØ¶Ø© (ØªÙ‡ÙˆÙŠØ© Ø·Ø¨ÙŠØ¹ÙŠØ©)';
}

// ===== ØªØ­Ø¯ÙŠØ« ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© =====
function updateTemperatureWarning() {
    const alloy = document.getElementById('alloy').value;
    const temperature = parseFloat(document.getElementById('extrusionTemperature').value) || 480;
    
    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ù„Ù„Ø³Ø¨ÙŠÙƒØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    const tempData = alloyTemperatures[alloy] || { entryMin: 460, entryMax: 500, exitMin: 500, exitMax: 540, notes: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©' };
    
    let warningElement = document.getElementById('temperatureWarning');
    if (!warningElement) {
        const warningDiv = document.createElement('div');
        warningDiv.id = 'temperatureWarning';
        warningDiv.className = 'temperature-warning';
        document.getElementById('extrusionTemperature').parentNode.appendChild(warningDiv);
        warningElement = warningDiv;
    }
    
    if (temperature > tempData.entryMax) {
        warningElement.innerHTML = 'ğŸ”¥ Ø­Ø±Ø§Ø±Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹ - Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ø³Ø¨ÙŠÙƒØ©';
        warningElement.style.background = '#ffcdd2';
        warningElement.style.color = '#b71c1c';
        warningElement.style.border = '1px solid #b71c1c';
    } else if (temperature < tempData.entryMin) {
        warningElement.innerHTML = 'ğŸ’  Ø­Ø±Ø§Ø±Ø© Ù…Ù†Ø®ÙØ¶Ø© - Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ø³Ø¨ÙŠÙƒØ©';
        warningElement.style.background = '#bbdefb';
        warningElement.style.color = '#1565c0';
        warningElement.style.border = '1px solid #1565c0';
    } else if (temperature > (tempData.entryMin + tempData.entryMax) / 2 + 10) {
        warningElement.innerHTML = 'ğŸŒ¡ï¸ Ø­Ø±Ø§Ø±Ø© Ù…Ø±ØªÙØ¹Ø© - Ø¶Ù…Ù† Ø§Ù„Ù…Ø¯Ù‰ Ù„ÙƒÙ† Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¹Ù„Ù‰';
        warningElement.style.background = '#ffecb3';
        warningElement.style.color = '#ff8f00';
        warningElement.style.border = '1px solid #ff8f00';
    } else {
        warningElement.innerHTML = 'âœ… Ø­Ø±Ø§Ø±Ø© Ù…Ù†Ø§Ø³Ø¨Ø© - Ø¶Ù…Ù† Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ø³Ø¨ÙŠÙƒØ©';
        warningElement.style.background = '#c8e6c9';
        warningElement.style.color = '#2e7d32';
        warningElement.style.border = '1px solid #2e7d32';
    }
}

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© =====
function calculateBilletLength(){
    const numOpenings = parseInt(document.getElementById('numOpenings').value) || 0;
    const rodWeight = parseFloat(document.getElementById('rodWeight').value) || 0;
    const weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value) || 0;
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = getCurrentRodLength();
    const billetDiameter = document.getElementById('billetDiameter').value;
    const alloy = document.getElementById('alloy').value;
    const weightPerCm = parseFloat(document.getElementById('weightPerCm').value) || 0;
    const scrapPercentage = parseFloat(document.getElementById('scrapPercentage').value) || 0;
    const safetyFactor = parseFloat(document.getElementById('safetyFactor').value) || 0;
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;
    const desiredTons = parseFloat(document.getElementById('desiredTons').value);
    const buttScrap = parseFloat(document.getElementById('buttScrap').value) || 15;
    const enableScrapSafety = document.getElementById('enableScrapSafety').value === '1';
    const extrusionTemperature = parseFloat(document.getElementById('extrusionTemperature').value) || 480;
    const extrusionSpeed = parseFloat(document.getElementById('extrusionSpeed').value) || 6;
    const moldType = document.getElementById('moldType').value;
    const t4Time = parseFloat(document.getElementById('t4Time').value) || 0;
    const t5Time = parseFloat(document.getElementById('t5Time').value) || 0;
    const t6Time = parseFloat(document.getElementById('t6Time').value) || 0;
    const heatTreatmentTemp = parseFloat(document.getElementById('heatTreatmentTemp').value) || 175;
    const materialThickness = parseFloat(document.getElementById('materialThickness').value) || 1.5;

    if (!numOpenings || !rodWeight || !numCuts || !weightPerCm) {
        alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©: ÙØªØ­Ø§ØªØŒ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ØŒ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµØ§ØªØŒ ÙˆÙˆØ²Ù† Ø§Ù„Ø¨Ù„ÙŠØª Ù„ÙƒÙ„ Ø³Ù…');
        return;
    }

    const totalRodsCount = numOpenings * numCuts;
    const totalRodsWeight = rodWeight * totalRodsCount;
    const scrapFactor = 1 + (scrapPercentage / 100);
    const safetyFactorValue = 1 + (safetyFactor / 100);
    
    const bedScrapWeight = (bedScrapLength * weightPerMeter * numOpenings);
    
    let adjustedWeight = totalRodsWeight;
    if (enableScrapSafety) adjustedWeight = adjustedWeight * scrapFactor * safetyFactorValue;
    const finalWeight = adjustedWeight + bedScrapWeight;
    
    const buttScrapCm = buttScrap / 10;
    const billetLengthCm = (finalWeight / weightPerCm) + buttScrapCm;
    const billetWeightKg = billetLengthCm * weightPerCm;

    document.getElementById('resultOpenings').textContent = numOpenings;
    document.getElementById('resultRodWeight').textContent = rodWeight.toFixed(3);
    document.getElementById('resultWeightPerMeter').textContent = weightPerMeter.toFixed(3);
    document.getElementById('resultCuts').textContent = numCuts;
    document.getElementById('resultRodLength').textContent = rodLength + ' Ù…ØªØ±';
    document.getElementById('resultDiameter').textContent = billetDiameter + ' Ø¨ÙˆØµØ©';
    document.getElementById('resultAlloy').textContent = alloy;
    document.getElementById('resultTemperature').textContent = extrusionTemperature;
    document.getElementById('resultSpeed').textContent = extrusionSpeed;
    document.getElementById('resultButtScrap').textContent = buttScrap;
    document.getElementById('resultWastedTime').textContent = document.getElementById('wastedTimePercentage').value;

    // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ØµØ­Ø­Ø© Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¶Ø§Ø¦Ø¹
    const billetsPerHour = calculateBilletsPerHour(extrusionSpeed, billetLengthCm);
    document.getElementById('resultBilletsPerHour').textContent = billetsPerHour.toFixed(1);

    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø© ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© Ø¨Ø§Ù„ÙƒÙŠÙ„Ùˆ ÙˆØ§Ù„Ø·Ù†
    const hourlyKg = billetsPerHour * billetWeightKg;
    const hourlyTons = hourlyKg / 1000;
    
    document.getElementById('resultHourlyKg').textContent = hourlyKg.toFixed(1);
    document.getElementById('resultHourlyTons').textContent = hourlyTons.toFixed(2);

    // Ø¹Ø±Ø¶ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    const moldTypeIndicator = document.getElementById('resultMoldType');
    if (moldType === 'hollow') {
        moldTypeIndicator.textContent = 'ğŸ”„ Ù‡Ø§Ù„Ùˆ';
        moldTypeIndicator.className = 'mold-type-indicator mold-type-hollow';
    } else {
        moldTypeIndicator.textContent = 'ğŸ”¶ Ø³ÙˆÙ„Ø¯';
        moldTypeIndicator.className = 'mold-type-indicator mold-type-solid';
    }

    const erDisplay = document.getElementById('resultExtrusionRatio');
    const erValue = parseFloat(document.getElementById('extrusionRatio').value) || 0;
    erDisplay.textContent = isFinite(erValue) ? erValue.toFixed(1) : '0.0';

    // Ø¹Ø±Ø¶ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ø¨Ø§Ù„Ø³Ù†ØªÙŠÙ…ØªØ± ÙˆØ§Ù„Ù…ÙŠÙ„ÙŠÙ…ØªØ±
    document.getElementById('billetLength').textContent = isFinite(billetLengthCm) ? billetLengthCm.toFixed(1) : '0.0';
    document.getElementById('billetLengthMm').textContent = isFinite(billetLengthCm) ? (billetLengthCm * 10).toFixed(0) : '0';
    document.getElementById('billetWeight').textContent = isFinite(billetWeightKg) ? billetWeightKg.toFixed(1) : '0.0';

    // Ø­Ø³Ø§Ø¨ ÙˆØªÙˆÙ‚Ø¹ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø®Ø±ÙˆØ¬
    const exitTempData = calculateExitTemperature();
    updateExitTemperatureDisplay(exitTempData);

    const bedLengthData = calculateBedLength();
    if (bedLengthData) {
        document.getElementById('bedLengthValue').textContent = `${bedLengthData.totalLength.toFixed(1)} Ù…ØªØ±`;
        document.getElementById('bedLengthDetails').innerHTML = `
            <div class="bed-length-step"><strong>Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ØµØ§ÙÙŠ:</strong> ${bedLengthData.numCuts} Ù‚ØµÙ‘Ø© Ã— ${bedLengthData.rodLength} Ù…ØªØ± = ${bedLengthData.netLength.toFixed(1)} Ù…ØªØ±</div>
            <div class="bed-length-step"><strong>Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´:</strong> ${bedLengthData.bedScrapLength} Ù…ØªØ±</div>
            <div class="bed-length-step"><strong>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©:</strong> ${bedLengthData.netLength.toFixed(1)} Ù…ØªØ± + ${bedLengthData.bedScrapLength} Ù…ØªØ± = ${bedLengthData.totalLength.toFixed(1)} Ù…ØªØ±</div>
        `;
        document.getElementById('bedLengthResult').style.display = 'block';
    }

    // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    document.getElementById('heatTreatmentResult').style.display = 'none';

    document.getElementById('calculationDetails').innerHTML = `
        <h4>ğŸ§® Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨:</h4>
        <div class="step"><strong>1. Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯ Ø§Ù„ÙØ¹Ù„ÙŠ:</strong><br>${numOpenings} ÙØªØ­Ø© Ã— ${numCuts} Ù‚ØµÙ‘Ø© = ${totalRodsCount} Ø¹ÙˆØ¯</div>
        <div class="step"><strong>2. Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„Ù„Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</strong><br>${rodWeight.toFixed(3)} ÙƒØ¬Ù…/Ø¹ÙˆØ¯ Ã— ${totalRodsCount} = ${totalRodsWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>3. Ø§Ø­ØªØ³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø§Ù„Ùƒ (${scrapPercentage}%):</strong><br>${enableScrapSafety ? (totalRodsWeight.toFixed(3) + ' Ã— ' + scrapFactor.toFixed(3) + ' = ' + (totalRodsWeight*scrapFactor).toFixed(3) + ' ÙƒØ¬Ù…') : 'Ù…Ø¹Ø·Ù„ - Ù„Ø§ ÙŠØ·Ø¨Ù‚'}</div>
    <div class="step"><strong>4. Ø§Ø­ØªØ³Ø§Ø¨ Ø¹Ø§Ù…Ù„ Ø§Ù„Ø£Ù…Ø§Ù† (${safetyFactor}%):</strong><br>${enableScrapSafety ? ((totalRodsWeight*scrapFactor).toFixed(3) + ' Ã— ' + safetyFactorValue.toFixed(3) + ' = ' + (totalRodsWeight*scrapFactor*safetyFactorValue).toFixed(3) + ' ÙƒØ¬Ù…') : 'Ù…Ø¹Ø·Ù„ - Ù„Ø§ ÙŠØ·Ø¨Ù‚'}</div>
        <div class="step"><strong>5. Ø§Ø­ØªØ³Ø§Ø¨ ÙˆØ²Ù† Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´:</strong><br>${bedScrapLength} Ù… Ã— ${weightPerMeter.toFixed(3)} ÙƒØ¬Ù…/Ù… Ã— ${numOpenings} ÙØªØ­Ø© = ${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>6. Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong><br>${(enableScrapSafety ? (totalRodsWeight*scrapFactor*safetyFactorValue).toFixed(3) : totalRodsWeight.toFixed(3))} ÙƒØ¬Ù… + ${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù… = ${finalWeight.toFixed(3)} ÙƒØ¬Ù…</div>
        <div class="step"><strong>7. Ø­Ø³Ø§Ø¨ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:</strong><br>${finalWeight.toFixed(3)} ÙƒØ¬Ù… Ã· ${weightPerCm.toFixed(3)} ÙƒØ¬Ù…/Ø³Ù… = ${(finalWeight / weightPerCm).toFixed(1)} Ø³Ù…</div>
        <div class="step"><strong>8. Ø¥Ø¶Ø§ÙØ© Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³ (${buttScrap}Ù…Ù… = ${buttScrapCm.toFixed(1)}Ø³Ù…):</strong><br>${(finalWeight / weightPerCm).toFixed(1)} Ø³Ù… + ${buttScrapCm.toFixed(1)} Ø³Ù… = ${billetLengthCm.toFixed(1)} Ø³Ù…</div>
    `;

    const analysisBody = document.getElementById('analysisTableBody');
    analysisBody.innerHTML = '';
    const analysisRows = [
        `<tr><td>Ø§Ù„ÙˆØ²Ù† Ø§Ù„ØµØ§ÙÙŠ</td><td>ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ã— Ø¹Ø¯Ø¯ Ø§Ù„Ù‚ØµÙ‘Ø§Øª Ã— Ø¹Ø¯Ø¯ Ø§Ù„ÙØªØ­Ø§Øª</td><td>${totalRodsWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>Ø¨Ø¹Ø¯ Ø§Ù„Ù‡Ø§Ù„Ùƒ (${scrapPercentage}%)</td><td>Ã— (1 + ${scrapPercentage/100})</td><td>${(totalRodsWeight * scrapFactor).toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ù…Ø§Ù† (${safetyFactor}%)</td><td>Ã— (1 + ${safetyFactor/100})</td><td>${(totalRodsWeight * scrapFactor * safetyFactorValue).toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>ÙˆØ²Ù† Ø§Ù„Ù‡Ø§Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø´</td><td>${bedScrapLength} Ù… Ã— ${weightPerMeter.toFixed(3)} ÙƒØ¬Ù…/Ù… Ã— ${numOpenings}</td><td>${bedScrapWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</td><td>${(enableScrapSafety ? (totalRodsWeight * scrapFactor * safetyFactorValue).toFixed(3) : totalRodsWeight.toFixed(3))} + ${bedScrapWeight.toFixed(3)}</td><td class="highlight">${finalWeight.toFixed(3)} ÙƒØ¬Ù…</td></tr>`,
        `<tr><td>Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</td><td>Ã· ${weightPerCm.toFixed(3)} ÙƒØ¬Ù…/Ø³Ù…</td><td>${(finalWeight / weightPerCm).toFixed(1)} Ø³Ù…</td></tr>`,
        `<tr><td>Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³</td><td>${buttScrap} Ù…Ù… = ${buttScrapCm.toFixed(1)} Ø³Ù…</td><td>+ ${buttScrapCm.toFixed(1)} Ø³Ù…</td></tr>`,
        `<tr><td>Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</td><td>${(finalWeight / weightPerCm).toFixed(1)} + ${buttScrapCm.toFixed(1)}</td><td class="highlight">${billetLengthCm.toFixed(1)} Ø³Ù…</td></tr>`
    ];
    analysisBody.innerHTML = analysisRows.join('');
    document.getElementById('analysisBlock').style.display = 'block';

    let summaryHtml = '';
    if (!isNaN(desiredTons) && desiredTons > 0) {
        const desiredKg = desiredTons * 1000;
        const billetsNeeded = Math.ceil(desiredKg / billetWeightKg);
        const rodsProduced = billetsNeeded * totalRodsCount;
        const producedKg = billetsNeeded * billetWeightKg;
        const diffKg = producedKg - desiredKg;

        summaryHtml += `<strong>Ù…Ù„Ø®Øµ Ù„Ø·Ù„Ø¨ ${desiredTons} Ø·Ù† (Ø£ÙŠ ${desiredKg.toLocaleString()} ÙƒØ¬Ù…):</strong><br>`;
        summaryHtml += `â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù„ÙŠØª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: <strong>${billetsNeeded.toLocaleString()}</strong> Ø¨Ù„ÙŠØª<br>`;
        summaryHtml += `â€¢ ÙƒÙ„ Ø¨Ù„ÙŠØª ÙŠØ²Ù† ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§: <strong>${billetWeightKg.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯ Ø§Ù„Ù†Ø§ØªØ¬Ø©: <strong>${rodsProduced.toLocaleString()}</strong> Ø¹ÙˆØ¯<br>`;
        summaryHtml += `â€¢ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ÙØ¹Ù„ÙŠ Ø§Ù„Ù†Ø§ØªØ¬: <strong>${producedKg.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø§Ù„ÙØ±Ù‚ Ø¹Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: <strong>${diffKg >= 0 ? '+' : ''}${diffKg.toFixed(1)} ÙƒØ¬Ù…</strong>`;
    } else {
        summaryHtml += `<strong>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø²Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong><br>`;
        summaryHtml += `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹ÙˆØ§Ø¯: <strong>${totalRodsCount}</strong> Ø¹ÙˆØ¯<br>`;
        summaryHtml += `â€¢ ÙˆØ²Ù† Ø§Ù„Ø­Ø²Ù…Ø©: <strong>${finalWeight.toFixed(1)} ÙƒØ¬Ù…</strong><br>`;
        summaryHtml += `â€¢ Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª: <strong>${billetLengthCm.toFixed(1)} Ø³Ù…</strong><br>`;
        summaryHtml += `â€¢ Ù‡Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø§ØªØ³: <strong>${buttScrap} Ù…Ù…</strong>`;
    }
    document.getElementById('summaryBox').innerHTML = summaryHtml;

    document.getElementById('result').style.display = 'block';
    document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
    saveState();
}

function calculateBedLength() {
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = getCurrentRodLength();
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;
    
    if (numCuts <= 0) return null;
    
    const netLength = numCuts * rodLength;
    const totalLength = netLength + bedScrapLength;
    
    return {
        netLength: netLength,
        totalLength: totalLength,
        rodLength: rodLength,
        bedScrapLength: bedScrapLength,
        numCuts: numCuts
    };
}

// ===== Ø¯ÙˆØ§Ù„ Ø¬Ø¯ÙŠØ¯Ø©: Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© =====
function updateExtrusionRatio() {
    const weightPerCm = parseFloat(document.getElementById('weightPerCm').value) || 0;
    const weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value) || 0;
    const numOpenings = parseInt(document.getElementById('numOpenings').value) || 1;

    // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù„ÙƒÙ„ Ø³Ù… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØªØ­Ø§Øª
    const totalWeightPerMeter = weightPerMeter * numOpenings;
    const profileWeightPerCm = totalWeightPerMeter / 100;

    let er = 0;
    if (profileWeightPerCm > 0) {
        er = weightPerCm / profileWeightPerCm;
    } else {
        const rodWeight = parseFloat(document.getElementById('rodWeight').value) || 0;
        const rodLength = getCurrentRodLength() || 6;
        const profilePerCmFallback = ((rodWeight * numOpenings) / rodLength) / 100;
        if (profilePerCmFallback > 0) {
            er = weightPerCm / profilePerCmFallback;
        }
    }

    const erRounded = isFinite(er) ? Math.max(0.1, parseFloat(er.toFixed(1))) : 0;
    document.getElementById('extrusionRatio').value = erRounded;
    const erDisplay = document.getElementById('resultExtrusionRatio');
    if (erDisplay) erDisplay.textContent = erRounded.toFixed(1);
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø±Ø§Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    calculateOptimalTemperature();
    updateExtrusionRatioWarning();
}

// ===== ØªØ­Ø¯ÙŠØ« ØªØ­Ø°ÙŠØ±Ø§Øª Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ =====
function updateExtrusionRatioWarning() {
    const extrusionRatio = parseFloat(document.getElementById('extrusionRatio').value) || 0;
    let warningElement = document.getElementById('extrusionWarning');
    
    if (!warningElement) {
        const warningDiv = document.createElement('div');
        warningDiv.id = 'extrusionWarning';
        warningDiv.style.cssText = 'padding:8px; margin:5px 0; border-radius:5px; font-weight:bold; text-align:center; font-size:12px;';
        document.getElementById('extrusionRatio').parentNode.appendChild(warningDiv);
        warningElement = warningDiv;
    }
    
    let message = '';
    let background = '';
    let color = '';
    let border = '';
    
    if (extrusionRatio > 180) {
        message = 'âŒ Ø®Ø·Ø± Ø´Ø¯ÙŠØ¯: Ù†Ø³Ø¨Ø© Ø¨Ø«Ù‚ Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹ - ÙŠØ­ØªØ§Ø¬ Ø®Ø¨Ø±Ø© ÙØ§Ø¦Ù‚Ø©';
        background = '#ffebee';
        color = '#c62828';
        border = '2px solid #c62828';
    } else if (extrusionRatio > 120) {
        message = 'âš ï¸ ØªØ­Ø°ÙŠØ±: Ù†Ø³Ø¨Ø© Ø¨Ø«Ù‚ Ø¹Ø§Ù„ÙŠØ© - ÙŠØ­ØªØ§Ø¬ Ø­Ø±Ø§Ø±Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø³ØªÙ…Ø±Ø©';
        background = '#fff3e0';
        color = '#ef6c00';
        border = '2px solid #ef6c00';
    } else if (extrusionRatio > 80) {
        message = 'â„¹ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù†Ø³Ø¨Ø© Ø¨Ø«Ù‚ Ù…ØªÙˆØ³Ø·Ø© - Ø¹Ù…Ù„ÙŠØ© Ø¹Ø§Ø¯ÙŠØ© Ù„Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ø±Ù‚ÙŠÙ‚Ø©';
        background = '#e8f5e8';
        color = '#2e7d32';
        border = '2px solid #2e7d32';
    } else {
        message = 'âœ… Ù†Ø³Ø¨Ø© Ø¨Ø«Ù‚ Ø¬ÙŠØ¯Ø© - Ø¹Ù…Ù„ÙŠØ© Ù…Ø³ØªÙ‚Ø±Ø©';
        background = '#e3f2fd';
        color = '#1565c0';
        border = '2px solid #1565c0';
    }
    
    warningElement.innerHTML = message;
    warningElement.style.background = background;
    warningElement.style.color = color;
    warningElement.style.border = border;
}

// ===== Ø¯ÙˆØ§Ù„ Ø¬Ø¯ÙŠØ¯Ø©: Ø­Ø³Ø§Ø¨ Ø¹ÙƒØ³ÙŠ Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØµØ­Ø­ =====
function computeFromBilletLength() {
    const inputLengthCm = parseFloat(document.getElementById('inputBilletLength').value);
    if (!inputLengthCm || inputLengthCm <= 0) return;

    const buttScrap = parseFloat(document.getElementById('buttScrap').value) || 15;
    const buttScrapCm = buttScrap / 10;
    const weightPerCm = parseFloat(document.getElementById('weightPerCm').value) || 0;
    const numOpenings = parseInt(document.getElementById('numOpenings').value) || 0;
    const numCuts = parseInt(document.getElementById('numCuts').value) || 0;
    const rodLength = getCurrentRodLength();
    const bedScrapLength = parseFloat(document.getElementById('bedScrapLength').value) || 1.5;

    const totalRodsCount = numOpenings * numCuts;
    if (totalRodsCount <= 0) return;

    document.getElementById('scrapPercentage').value = '5';
    document.getElementById('safetyFactor').value = '5';
    document.getElementById('enableScrapSafety').value = '1';

    const scrapPercentage = 10;
    const safetyFactor = 5;
    const enableScrapSafety = true;

    const basicBilletLength = inputLengthCm - buttScrapCm;
    const basicBilletWeight = basicBilletLength * weightPerCm;
    
    let weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value) || 0;
    if (!weightPerMeter || weightPerMeter === 0) {
        const currentRodWeight = parseFloat(document.getElementById('rodWeight').value) || 0;
        if (currentRodWeight > 0) {
            weightPerMeter = (currentRodWeight / rodLength);
        } else {
            weightPerMeter = weightPerCm * 100;
        }
        document.getElementById('weightPerMeter').value = weightPerMeter.toFixed(3);
    }
    const bedScrapWeight = bedScrapLength * weightPerMeter * numOpenings;
    
    const availableWeightForRods = basicBilletWeight - bedScrapWeight;
    
    let netWeightForRods;
    if (enableScrapSafety) {
        const scrapFactor = 1 + (scrapPercentage / 100);
        const safetyFactorValue = 1 + (safetyFactor / 100);
        const totalFactor = scrapFactor * safetyFactorValue;
        netWeightForRods = availableWeightForRods / totalFactor;
    } else {
        netWeightForRods = availableWeightForRods;
    }
    
    const computedRodWeight = totalRodsCount > 0 ? netWeightForRods / totalRodsCount : 0;
    const computedWeightPerMeter = rodLength > 0 ? computedRodWeight / rodLength : 0;

    if (isFinite(computedRodWeight) && computedRodWeight > 0 && isFinite(computedWeightPerMeter) && computedWeightPerMeter > 0) {
        document.getElementById('rodWeight').value = computedRodWeight.toFixed(3);
        document.getElementById('weightPerMeter').value = computedWeightPerMeter.toFixed(3);
        updateExtrusionRatio();
        
        saveState();
        showTempMessage(`ğŸ” ØªÙ… Ø­Ø³Ø§Ø¨ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ (${computedRodWeight.toFixed(3)} ÙƒØ¬Ù…) ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ (${computedWeightPerMeter.toFixed(3)} ÙƒØ¬Ù…/Ù…) Ù…Ù† Ø·ÙˆÙ„ Ø§Ù„Ø¨Ù„ÙŠØª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø³Ø¨Ø© Ù‡Ø§Ù„Ùƒ 10% ÙˆØ¹Ø§Ù…Ù„ Ø£Ù…Ø§Ù† 10%`,'success');
    } else {
        showTempMessage('âš ï¸ ØªØ¹Ø°Ø± Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø¯Ø®Ù„Ø©.', 'error');
    }
}

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© =====
function showTempMessage(message, type = 'info') {
    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;
    messageDiv.style.cssText = `
        position: fixed;
        top: 15px;
        right: 15px;
        padding: 10px 16px;
        border-radius: 6px;
        color: white;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        transition: opacity 0.3s;
        ${type === 'success' ? 'background: #27ae60;' : type === 'error' ? 'background: #e74c3c;' : 'background: #3498db;'}
        font-size: 13px;
    `;
    
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.style.opacity = '0';
        setTimeout(() => {
            document.body.removeChild(messageDiv);
        }, 300);
    }, 3000);
}

// ===== Ø§Ù„ØªØµØ­ÙŠØ­: Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø«Ø§Ø¨Øª ÙˆÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙŠØªØºÙŠØ± Ù…Ø¹ Ø§Ù„Ø·ÙˆÙ„ =====
function updateRodFromMeter() {
    const weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value);
    const rodLength = getCurrentRodLength();
    if (!isNaN(weightPerMeter) && rodLength > 0) {
        // Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ ÙŠØªØ­ÙƒÙ… ÙÙŠ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ (Ø§Ù„ØªØµØ­ÙŠØ­)
        const newRodWeight = (weightPerMeter * rodLength).toFixed(3);
        document.getElementById('rodWeight').value = newRodWeight;
        
        // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚ Ø¨Ø¹Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
        updateExtrusionRatio();
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
        saveState();
    }
}

// ===== Ø§Ù„ØªØµØ­ÙŠØ­: ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹ =====
function updateMeterFromRod() {
    const rodWeight = parseFloat(document.getElementById('rodWeight').value);
    const rodLength = getCurrentRodLength();
    if (!isNaN(rodWeight) && rodLength > 0) {
        // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯
        const newWeightPerMeter = (rodWeight / rodLength).toFixed(3);
        document.getElementById('weightPerMeter').value = newWeightPerMeter;
        
        // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚
        updateExtrusionRatio();
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
        saveState();
        
        showTempMessage(`ğŸ”„ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø¥Ù„Ù‰: ${newWeightPerMeter} ÙƒØ¬Ù…/Ù…`, 'success');
    }
}

// ===== Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©: ØªØ­Ø¯ÙŠØ« ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ ÙˆØ§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ =====
function updateRodWeightFromMeterAndLength() {
    const weightPerMeter = parseFloat(document.getElementById('weightPerMeter').value);
    const rodLength = getCurrentRodLength();
    if (!isNaN(weightPerMeter) && rodLength > 0) {
        const newRodWeight = (weightPerMeter * rodLength).toFixed(3);
        document.getElementById('rodWeight').value = newRodWeight;
        
        // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚
        updateExtrusionRatio();
        
        // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
        saveState();
    }
}

// ===== Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹ =====
function fixWeightUpdateLogic() {
    const rodWeightInput = document.getElementById('rodWeight');
    const weightPerMeterInput = document.getElementById('weightPerMeter');
    
    // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹ØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ
    rodWeightInput.addEventListener('input', function() {
        const rodWeight = parseFloat(this.value);
        const rodLength = getCurrentRodLength();
        
        if (!isNaN(rodWeight) && rodLength > 0) {
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ ÙˆØ§Ù„Ø·ÙˆÙ„
            const newWeightPerMeter = (rodWeight / rodLength).toFixed(3);
            weightPerMeterInput.value = newWeightPerMeter;
            
            // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø«Ù‚
            updateExtrusionRatio();
            
            // Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
            saveState();
            
            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ:', newWeightPerMeter, 'ÙƒØ¬Ù…/Ù…');
        }
    });
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ ÙŠØªØ­ÙƒÙ… ÙÙŠ ÙˆØ²Ù† Ø§Ù„Ø¹ÙˆØ¯ (ÙƒÙ…Ø§ Ù‡Ùˆ Ù…ÙˆØ¬ÙˆØ¯)
    weightPerMeterInput.addEventListener('input', function() {
        updateRodFromMeter();
    });
}

// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ =====
function saveState() {
    const state = {
        numOpenings: document.getElementById('numOpenings').value,
        rodWeight: document.getElementById('rodWeight').value,
        weightPerMeter: document.getElementById('weightPerMeter').value,
        numCuts: document.getElementById('numCuts').value,
        desiredBedLength: document.getElementById('desiredBedLength').value,
        billetDiameter: document.getElementById('billetDiameter').value,
        moldNumber: document.getElementById('moldNumber').value,
        moldVersion: document.getElementById('moldVersion').value,
        inputBilletLength: document.getElementById('inputBilletLength').value,
        alloy: document.getElementById('alloy').value,
        weightPerCm: document.getElementById('weightPerCm').value,
        buttScrap: document.getElementById('buttScrap').value,
        extrusionRatio: document.getElementById('extrusionRatio').value,
        extrusionTemperature: document.getElementById('extrusionTemperature').value,
        autoTemperature: document.getElementById('autoTemperature').value,
        extrusionSpeed: document.getElementById('extrusionSpeed').value,
        moldType: document.getElementById('moldType').value,
        wastedTimePercentage: document.getElementById('wastedTimePercentage').value,
        scrapPercentage: document.getElementById('scrapPercentage').value,
        safetyFactor: document.getElementById('safetyFactor').value,
        bedScrapLength: document.getElementById('bedScrapLength').value,
        desiredTons: document.getElementById('desiredTons').value,
        enableScrapSafety: document.getElementById('enableScrapSafety').value,
        materialThickness: document.getElementById('materialThickness').value,
        t4Time: document.getElementById('t4Time').value,
        t5Time: document.getElementById('t5Time').value,
        t6Time: document.getElementById('t6Time').value,
        heatTreatmentTemp: document.getElementById('heatTreatmentTemp').value,
        boxWidth: document.getElementById('boxWidth').value,
        boxHeight: document.getElementById('boxHeight').value,
        boxThickness: document.getElementById('boxThickness').value,
        pipeOuterDiameter: document.getElementById('pipeOuterDiameter').value,
        pipeThickness: document.getElementById('pipeThickness').value,
        angleWidth: document.getElementById('angleWidth').value,
        angleHeight: document.getElementById('angleHeight').value,
        angleThickness: document.getElementById('angleThickness').value,
        activeProfile: document.querySelector('.profile-type-btn.active')?.getAttribute('data-type') || 'box',
        activeLength: document.querySelector('.toggle-btn.active')?.getAttribute('data-length') || '6',
        customLength: document.getElementById('customLength').value,
        timestamp: new Date().toISOString()
    };
    
    localStorage.setItem('billetCalculatorState', JSON.stringify(state));
}

function loadState() {
    try {
        const saved = localStorage.getItem('billetCalculatorState');
        if (!saved) return;
        
        const state = JSON.parse(saved);
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        document.getElementById('numOpenings').value = state.numOpenings || '4';
        document.getElementById('rodWeight').value = state.rodWeight || '1.2';
        document.getElementById('weightPerMeter').value = state.weightPerMeter || '0.200';
        document.getElementById('numCuts').value = state.numCuts || '7';
        document.getElementById('desiredBedLength').value = state.desiredBedLength || '43.5';
        document.getElementById('billetDiameter').value = state.billetDiameter || '7';
        document.getElementById('moldNumber').value = state.moldNumber || '';
        document.getElementById('moldVersion').value = state.moldVersion || '';
        document.getElementById('inputBilletLength').value = state.inputBilletLength || '';
        document.getElementById('alloy').value = state.alloy || '6063';
        document.getElementById('weightPerCm').value = state.weightPerCm || '0.670';
        document.getElementById('buttScrap').value = state.buttScrap || '15';
        document.getElementById('extrusionRatio').value = state.extrusionRatio || '30';
        document.getElementById('extrusionTemperature').value = state.extrusionTemperature || '480';
        document.getElementById('autoTemperature').value = state.autoTemperature || '1';
        document.getElementById('extrusionSpeed').value = state.extrusionSpeed || '6';
        document.getElementById('moldType').value = state.moldType || 'hollow';
        document.getElementById('wastedTimePercentage').value = state.wastedTimePercentage || '20';
        document.getElementById('scrapPercentage').value = state.scrapPercentage || '5';
        document.getElementById('safetyFactor').value = state.safetyFactor || '5';
        document.getElementById('bedScrapLength').value = state.bedScrapLength || '1.5';
        document.getElementById('desiredTons').value = state.desiredTons || '';
        document.getElementById('enableScrapSafety').value = state.enableScrapSafety || '1';
        document.getElementById('materialThickness').value = state.materialThickness || '1.5';
        document.getElementById('t4Time').value = state.t4Time || '0';
        document.getElementById('t5Time').value = state.t5Time || '2.5';
        document.getElementById('t6Time').value = state.t6Time || '4.5';
        document.getElementById('heatTreatmentTemp').value = state.heatTreatmentTemp || '175';
        
        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ
        document.getElementById('boxWidth').value = state.boxWidth || '40';
        document.getElementById('boxHeight').value = state.boxHeight || '40';
        document.getElementById('boxThickness').value = state.boxThickness || '0.5';
        document.getElementById('pipeOuterDiameter').value = state.pipeOuterDiameter || '50';
        document.getElementById('pipeThickness').value = state.pipeThickness || '1.0';
        document.getElementById('angleWidth').value = state.angleWidth || '25';
        document.getElementById('angleHeight').value = state.angleHeight || '25';
        document.getElementById('angleThickness').value = state.angleThickness || '2.0';
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø§Ù„Ù†Ø´Ø·
        const activeProfile = state.activeProfile || 'box';
        document.querySelectorAll('.profile-type-btn').forEach(btn => {
            if (btn.getAttribute('data-type') === activeProfile) {
                btn.click();
            }
        });
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù†Ø´Ø·
        const activeLength = state.activeLength || '6';
        document.querySelectorAll('.toggle-btn').forEach(btn => {
            if (btn.getAttribute('data-length') === activeLength) {
                btn.click();
            }
        });
        
        // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµ
        if (state.customLength) {
            document.getElementById('customLength').value = state.customLength;
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ
        calculateWeightPerMeter();
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø±Ø¹Ø© ÙˆØ§Ù„Ø­Ø±Ø§Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        updateSpeedAutomatically();
        calculateOptimalTemperature();
        
        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©');
        
    } catch (e) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©:', e);
    }
}

// ===== ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ø¨ÙŠÙƒØ© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ²Ù† =====
function applyAlloyToWeight() {
    const alloy = document.getElementById('alloy').value;
    const billetDiameter = document.getElementById('billetDiameter').value;
    const factor = alloyFactor[alloy] || 1.0;
    const baseWeight = baseBilletWeights[billetDiameter] || 0.670;
    const adjustedWeight = (baseWeight * factor).toFixed(3);
    
    document.getElementById('weightPerCm').value = adjustedWeight;
    updateExtrusionRatio();
    saveState();
}

// ===== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ =====
document.addEventListener('DOMContentLoaded', function() {
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
    loadState();
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    document.getElementById('calculateBtn').addEventListener('click', calculateBilletLength);
    document.getElementById('resetBtn').addEventListener('click', function() {
        if (confirm('âš ï¸ Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ØŸ')) {
            localStorage.removeItem('billetCalculatorState');
            location.reload();
        }
    });
    document.getElementById('printBtn').addEventListener('click', function() {
        window.print();
    });
    
    // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    document.getElementById('rodWeight').addEventListener('input', updateMeterFromRod);
    document.getElementById('weightPerMeter').addEventListener('input', updateRodFromMeter);
    document.getElementById('numOpenings').addEventListener('input', updateExtrusionRatio);
    document.getElementById('billetDiameter').addEventListener('change', applyAlloyToWeight);
    document.getElementById('alloy').addEventListener('change', applyAlloyToWeight);
    document.getElementById('inputBilletLength').addEventListener('input', computeFromBilletLength);
    
    // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    document.getElementById('numCuts').addEventListener('input', recalculateBedLengthFromCuts);
    document.getElementById('desiredBedLength').addEventListener('input', recalculateCutsFromBedLength);
    document.getElementById('bedScrapLength').addEventListener('input', function() {
        recalculateBedLengthFromCuts();
        recalculateCutsFromBedLength();
    });
    
    // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨
    document.getElementById('saveMoldBtn').addEventListener('click', saveMoldData);
    document.getElementById('searchMoldBtn').addEventListener('click', searchMold);
    document.getElementById('showMoldsBtn').addEventListener('click', showAllMolds);
    document.getElementById('deleteMoldBtn').addEventListener('click', deleteMold);
    document.getElementById('moldNumber').addEventListener('input', autoSearchMold);
    document.getElementById('moldVersion').addEventListener('input', autoSearchMold);
    
    // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ
    document.getElementById('boxWidth').addEventListener('input', calculateWeightPerMeter);
    document.getElementById('boxHeight').addEventListener('input', calculateWeightPerMeter);
    document.getElementById('boxThickness').addEventListener('input', calculateWeightPerMeter);
    document.getElementById('pipeOuterDiameter').addEventListener('input', calculateWeightPerMeter);
    document.getElementById('pipeThickness').addEventListener('input', calculateWeightPerMeter);
    document.getElementById('angleWidth').addEventListener('input', calculateWeightPerMeter);
    document.getElementById('angleHeight').addEventListener('input', calculateWeightPerMeter);
    document.getElementById('angleThickness').addEventListener('input', calculateWeightPerMeter);
    document.getElementById('applyBoxWeight').addEventListener('click', applyCalculatedWeightToMeter);
    
    // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±Ø© ÙˆØ§Ù„Ø³Ø±Ø¹Ø©
    document.getElementById('extrusionTemperature').addEventListener('input', updateTemperatureWarning);
    document.getElementById('alloy').addEventListener('change', updateTemperatureWarning);
    document.getElementById('autoTemperature').addEventListener('change', calculateOptimalTemperature);
    document.getElementById('weightPerMeter').addEventListener('input', updateSpeedAutomatically);
    document.getElementById('numOpenings').addEventListener('input', updateSpeedAutomatically);
    document.getElementById('alloy').addEventListener('change', updateSpeedAutomatically);
    document.getElementById('moldType').addEventListener('change', updateSpeedAutomatically);
    document.getElementById('extrusionRatio').addEventListener('input', updateExtrusionRatioWarning);
    
    // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ©
    document.getElementById('materialThickness').addEventListener('input', calculateHeatTreatmentTimes);
    document.getElementById('alloy').addEventListener('change', calculateHeatTreatmentTimes);
    document.getElementById('calculateAverageThickness').addEventListener('click', calculateAverageThickness);
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
    initializeWeightCalculatorToggle();
    initializeProfileTypeToggle();
    initializeLengthSystem();
    initializeHeatTreatmentToggle();
    initializeAlloySettingsToggle();
    initializeTemperatureTableToggle();
    initializeQualityStandardsToggle();
    initializeMoldTypeSystem();
    initializeResultsToggle();
    initializeCompanyToggle();
    initializeLoginToggle();
    
    // Ø¥ØµÙ„Ø§Ø­ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù…ØªØ±ÙŠ
    setTimeout(() => {
        fixWeightUpdateLogic();
        console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø¥ØµÙ„Ø§Ø­ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙˆØ²Ø§Ù†');
    }, 1000);
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
    document.getElementById('modalConfirm').addEventListener('click', function() {
        if (userManager.currentUser.isLoggedIn) {
            userManager.handleModalConfirm();
        } else {
            companyManager.handleModalConfirm();
        }
    });
    
    document.getElementById('modalCancel').addEventListener('click', function() {
        document.getElementById('companyModal').style.display = 'none';
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('companyModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
    
    // Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª
    let deferredPrompt;
    const installButton = document.getElementById('installButton');
    
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installButton.style.display = 'block';
    });
    
    installButton.addEventListener('click', async () => {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                installButton.style.display = 'none';
            }
            deferredPrompt = null;
        }
    });
    
    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­');
});

// ===== Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ =====
setInterval(saveState, 10000); // Ø­ÙØ¸ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
</script>
</body>
</html>
